import{s as ue,c as te,u as ae,a3 as he,a4 as Qe,a5 as me,j as e,G as o,T as G,e as be,B as W,C as fe,d as pe,L as Ce,I as De,J as Ge,a6 as Pe,M as ke}from"./index-CCiAG5C1.js";import{r as s,R as E}from"./vendor-BXCbSo2_.js";import{d as Re}from"./CategoryOutlined-BCVSmA5u.js";import{d as O}from"./AssignmentOutlined-GokGPIwe.js";import{d as Y}from"./Close-CbUD_sON.js";import"./ReceivingDetails-Cb-Lrswc.js";import{u as ge,D as Be,R as M,a as q,b as _,c as K,d as J,B as xe}from"./ReuseableDataGrid-C7a_wyFC.js";import{S as Z}from"./StatusChip-BGjKR3Q3.js";import{B as H,a as we,I as ee}from"./axios-CLUzUAy4.js";import"./Receive-DXTuNdmT.js";import{T as I}from"./TextField-bTJ-RHX7.js";import Ae from"./Reports-bC7wit9n.js";import{T as Le,a as ze,b as w,c as C}from"./TabPanel-DzXrDXvS.js";import{M as ce}from"./MenuItem-BJQIokW6.js";import"./Skeleton-CxVgYQtC.js";const D=ue(I)(({theme:n})=>({"& .MuiInputBase-input":{fontSize:"0.875rem",padding:"4px 6px"},width:"auto",height:"auto",minWidth:"100px",minHeight:"30px"})),Te=({rData:n,handleClose:A,refetch:y})=>{const[m,f]=s.useState({inspectionId:0,...n}),S=ge(),{enqueueSnackbar:p}=te(),{user:v}=ae(),[h,d]=s.useState([]),{data:P,refetch:N}=he({poId:m.poId,processTypename:"Dyeing",status:4},{skip:!m.poId}),{data:g,refetch:i}=Qe(n.receivingId,{skip:!n.receivingId}),{data:k,refetch:re}=me(n.poId,{skip:!n.poId});s.useEffect(()=>{if((g==null?void 0:g.result)===null){d([]);return}g&&d(g.result.map((t,r)=>({id:r+1,...t,gradeAQty:0,gradeBQty:0,gradeCPQty:0,others1Qty:0,rejectedQty:0,remarks:""})))},[g,i]),console.log("rData",n);const j=t=>{const{id:r,field:l,value:T}=t;console.log("Editing cell:",t),d(V=>V.map(c=>{if(c.id===r){const B=(c.issuanceQuantity*100/(100+c.shrinkage+c.wastage)).toFixed(2),F=Math.max(c.receivedQty-((c.gradeAQty||0)+(c.gradeBQty||0)+(c.gradeCPQty||0)+(c.rejectedQty||0)+(c.others1Qty||0)),0),x={...c,[l]:T,inspectionId:0,inspectiondetId:0,expectedQty:Number(B),shortageQty:F,appId:v.appId,createdOn:new Date().toISOString(),createdBy:v.empId,lastUpdatedOn:new Date().toISOString(),lastUpdatedBy:v.empId};return(l==="gradeAQty"||l==="gradeBQty"||l==="gradeCPQty"||l==="rejectedQty"||l==="others1Qty")&&(x.shortageQty=Math.max(x.receivedQty-((x.gradeAQty||0)+(x.gradeBQty||0)+(x.gradeCPQty||0)+(x.rejectedQty||0)+(x.others1Qty||0)),0)),x}return c}))};E.useEffect(()=>{f({...m,inspectionTransactionsDetailsModelList:h})},[h,d]),console.log("formData",m),console.log("receiveDetails",h);const Q=h.reduce((t,r)=>t+(r.gradeAQty??0),0).toFixed(2);console.log("Quantity",Q);const $=[{field:"id",headerName:"Sr#"},{field:"designNo",headerName:"Design"},{field:"colorName",headerName:"Color"},{field:"fabricName",headerName:"Fabric"},{field:"issuanceQuantity",headerName:"Quantity Issued",valueGetter:t=>t?Number(t.toFixed(2)).toLocaleString():"0"},{field:"expectedQty",headerName:"Expected",valueGetter:(t,r)=>Number((r.issuanceQuantity*100/(100+r.shrinkage+r.wastage)).toFixed(2)).toLocaleString()},{field:"receivedQty",headerName:"Received",valueGetter:t=>t?Number(t.toFixed(2)).toLocaleString():"0"},{field:"gradeAQty",headerName:"Grade A",renderCell:t=>e.jsx(D,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:t.row.gradeAQty||0,onChange:r=>j({id:t.id,field:"gradeAQty",value:Number(r.target.value)}),type:"number",error:t.row.gradeAQty>t.row.recA,InputProps:{style:{fontSize:"0.875rem"}}})},{field:"gradeBQty",headerName:"Grade B",renderCell:t=>e.jsx(D,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:t.row.gradeBQty||0,onChange:r=>j({id:t.id,field:"gradeBQty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"gradeCPQty",headerName:"Cut Pc",renderCell:t=>e.jsx(D,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:t.row.gradeCPQty||0,onChange:r=>j({id:t.id,field:"gradeCPQty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"others1Qty",headerName:"Others",renderCell:t=>e.jsx(D,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:t.row.others1Qty||0,onChange:r=>j({id:t.id,field:"others1Qty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"shortageQty",headerName:"Short Stock",valueGetter:(t,r)=>{r.expectedQty,r.receivedQty;const l=r.receivedQty-((r.gradeAQty||0)+(r.gradeBQty||0)+(r.gradeCPQty||0)+(r.rejectedQty||0)+(r.others1Qty||0));return l>0?l.toLocaleString():0},valueSetter:(t,r)=>{r.expectedQty,r.receivedQty;const l=r.receivedQty-((r.gradeAQty||0)+(r.gradeBQty||0)+(r.gradeCPQty||0)+(r.rejectedQty||0)+(r.others1Qty||0));return l>0?l.toLocaleString():0}},{field:"rejectedQty",headerName:"Rejected",renderCell:t=>e.jsx(D,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:t.row.rejectedQty||0,onChange:r=>j({id:t.id,field:"rejectedQty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"remarks",headerName:"Remarks",renderCell:t=>e.jsx(D,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:t.row.remarks||"",onKeyDown:r=>{console.log("Key down: ",r.key),r.stopPropagation()},onChange:r=>j({id:t.id,field:"remarks",value:r.target.value}),InputProps:{style:{fontSize:"0.875rem"}}})}],R=[{field:"id",headerName:"Sr#"},{field:"designNo",headerName:"Design"},{field:"colorName",headerName:"Color"},{field:"fabricName",headerName:"Fabric"},{field:"issuanceQuantity",headerName:"Quantity Issued",valueGetter:t=>t?Number(t.toFixed(2)).toLocaleString():"0"},{field:"receivedQty",headerName:"Received",valueGetter:t=>t?Number(t.toFixed(2)).toLocaleString():"0"},{field:"expectedQty",headerName:"Expected",valueGetter:(t,r)=>Number((r.issuanceQuantity*100/(100+r.shrinkage+r.wastage)).toFixed(2)).toLocaleString()},{field:"recA",headerName:"Grade A",valueGetter:t=>t?t.toLocaleString():"0"},{field:"recB",headerName:"Grade B ",valueGetter:t=>t?t.toLocaleString():"0"},{field:"recCp",headerName:"Grade CP",valueGetter:t=>t?t.toLocaleString():"0"},{field:"recOthers1",headerName:"Others",valueGetter:t=>t?t.toLocaleString():"0"}],L=()=>{S.current.autosizeColumns({includeHeaders:!0,includeOutliers:!0})};E.useEffect(()=>{L()});const z=async()=>{for(let t of h)if(t.receivedQty<(t.gradeAQty||0)+(t.gradeBQty||0)+(t.gradeCPQty||0)+(t.rejectedQty||0)+(t.others1Qty||0)){p("Error: Received quantity cannot be greater than issuance quantity!",{variant:"error",autoHideDuration:5e3});return}try{const t=await we.post("http://100.42.177.77:83/api/Receiving/SaveInspection",m);t.data.success?p(`${t.data.message} !`,{variant:"success",autoHideDuration:5e3}):(p(`${t.data.message} !`,{variant:"error",autoHideDuration:5e3}),console.log("response.message",t.data.message)),y(),re(),N(),console.log("Save response:",t.data),A()}catch(t){console.error("Error saving data:",t),p("FAILED: Unable to start Process",{variant:"error",autoHideDuration:5e3})}};return e.jsxs("div",{children:[e.jsxs(o,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(I,{fullWidth:!0,disabled:!0,label:"IGP Number",name:"igpNumber",value:n.igpNumber,size:"small"})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(I,{fullWidth:!0,disabled:!0,label:"Process Type",name:"processTypename",value:n.processTypename,size:"small"})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(I,{fullWidth:!0,disabled:!0,label:"Vendor",name:"vendorId",value:n.vendorName,size:"small"})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(I,{size:"small",label:"IGP Creation Date ",name:"igpDate",value:new Date(n.igpDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"}),fullWidth:!0,disabled:!0,InputLabelProps:{shrink:!0,sx:{color:"black"}}})}),e.jsx(o,{item:!0,xs:12,textAlign:"right",children:e.jsxs(G,{variant:"subtitle1",sx:{display:"block",fontWeight:"bold",fontSize:15},children:["GradeA Sum"," ",e.jsx(be,{label:Q.toLocaleString(),sx:{backgroundColor:"#90caf9",color:"#FFFFFF"}})]})})]}),e.jsxs(o,{container:!0,spacing:2,width:"Inherit",children:[e.jsx(o,{item:!0,xs:12,children:e.jsx(G,{variant:"h2",children:"Details"})}),e.jsx(o,{item:!0,xs:12,children:e.jsx(W,{sx:{height:"auto",width:"inherit","& .actions":{color:"text.secondary"},"& .textPrimary":{color:"text.primary"},"& .bold":{fontWeight:600}},children:e.jsx(Be,{rows:h,columns:$,apiRef:S,disableRowSelectionOnClick:!0})})}),e.jsx(o,{item:!0,xs:12,textAlign:"right",sx:{mt:2},children:e.jsx(H,{variant:"contained",size:"small",onClick:z,children:"Save"})}),e.jsx(o,{item:!0,xs:12,children:e.jsx(G,{variant:"h2",children:"Received"})}),e.jsx(o,{item:!0,xs:12,children:e.jsx(M,{initialRows:h,iColumns:R,hideAction:!0})})]})]})};ue(I)(({theme:n})=>({"& .MuiInputBase-input":{fontSize:"0.875rem",padding:"4px 6px"},width:"auto",height:"auto",minWidth:"100px",minHeight:"30px"}));const Fe=({formData:n,refetch:A})=>{ge(),te(),ae();const[y,m]=s.useState([]),{data:f,refetch:S}=me(n.poId,{skip:!n.poId});s.useEffect(()=>{if((f==null?void 0:f.result)===null){m([]);return}f&&m(f.result.map((i,k)=>({id:k+1,...i})))},[f,S]);const[p,v]=E.useState(!1),[h,d]=E.useState(!1),P=async i=>{d(i),v(!0)},N=()=>{v(!1)};console.log("iss",h);const g=[{field:"id",headerName:"Sr #"},{field:"collectionName",headerName:"Collection Name"},{field:"poName",headerName:"PO"},{field:"igpNumber",headerName:"IGP Number"},{field:"igpDate",headerName:"IGP Date",valueGetter:i=>new Date(i).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"inspectionDate",headerName:"Receiving Date",valueGetter:i=>new Date(i).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"receivedQty",headerName:"Received",valueGetter:i=>i?Number(i.toFixed(2)).toLocaleString():"0"},{field:"processTypeName",headerName:"Process Type"},{field:"statusName",headerName:"Status",renderCell:i=>e.jsx(Z,{label:i.value,status:i.value})},{field:"Actions",headerName:"Actions",renderCell:i=>e.jsx("div",{style:{display:"flex",justifyContent:"space-around"},children:e.jsx(xe,{variant:"text",size:"small",sx:{mt:1},children:e.jsx(H,{size:"small",color:"primary",onClick:()=>P(i.row),children:"Inspection"})})})}];return e.jsxs(fe,{variant:"outlined",sx:{marginTop:2},children:[e.jsx(pe,{className:"css-4rfrnx-MuiCardHeader-root",title:"Completed Inspections",titleTypographyProps:{style:{color:"white"}}}),e.jsx(o,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:e.jsxs(o,{item:!0,xs:12,children:[e.jsx(M,{initialRows:y,iColumns:g,hideAction:!0}),e.jsxs(q,{open:p,onClose:N,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(_,{sx:{backgroundColor:"#A11F23",color:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",paddingX:"24px",paddingY:"4px",mb:2.5},children:[e.jsx(G,{variant:"h4",component:"div",color:"#ffffff",gutterBottom:!0,fontSize:20,fontWeight:2,fontStyle:"normal",children:"Inspection"}),e.jsx(ee,{onClick:N,sx:{color:"#ffffff"},children:e.jsx(Y,{})})]}),e.jsxs(K,{children:[e.jsx(J,{id:"alert-dialog-slide-description"}),e.jsx(Ae,{rId:17,inspection:{ParamInspectionId:h.inspectionId}})]})]})]})})]})},et=()=>{var ne,oe,de;const n=Ce(),A=(ne=n.state)==null?void 0:ne.data,y=(de=(oe=n.state)==null?void 0:oe.tab)==null?void 0:de.toString();console.log("rowData",A),console.log("tab",y);const[m,f]=s.useState("1"),S=(a,u)=>{f(u),console.log("value",m)};s.useEffect(()=>{y&&f(y)},[y]),te();const{user:p}=ae();s.useState([]);const[v,h]=s.useState(!1),[d,P]=s.useState({issuanceId:"",poId:"",productionId:"",appId:p.appId,createdOn:new Date().toISOString(),createdBy:p.empId,lastUpdatedOn:new Date().toISOString(),LastUpdatedBy:p.empId}),[N,g]=s.useState([]),{data:i,error:k,isLoading:re,refetch:j}=De(d.productionId,{skip:!d.productionId}),{data:Q,refetch:$}=Ge(),{data:R,refetch:L}=he({poId:d.poId,status:8,processTypename:"Dyeing"},{skip:!d.poId}),[z,t]=s.useState([]);s.useState(!1),console.log("initialRows",z);const[r,l]=s.useState([]);s.useEffect(()=>{R&&t(R.result.map((a,u)=>({id:u+1,...a})))},[R,L]),s.useEffect(()=>{Q&&l(Q.result.map((a,u)=>({id:u,...a})))},[Q,$]),s.useEffect(()=>{i&&g(i.result.map((a,u)=>({id:u+1,...a})))},[i,j]);const T=a=>{const{name:u,value:X}=a.target;if(u==="poId"){const le=N.find(Se=>Se.poId===parseInt(X));P({...d,poId:X,issuanceId:le?le.issuanceId:""})}else P({...d,[u]:X})},[V,c]=s.useState(!1),[B,F]=s.useState({}),[x,ie]=s.useState({}),{data:b,refetch:ye}=Pe(B.receivingId,{skip:!B.receivingId});s.useEffect(()=>{if((b==null?void 0:b.result)===null){ie([]);return}b&&ie(b.result.map((a,u)=>({id:u+1,...a})))},[b,ye]);const ve=async a=>{F(a),h(!0)},je=async a=>{F(a)},U=()=>{h(!1)},se=()=>{c(!1)},Ie=[{field:"id",headerName:"Sr #"},{field:"collectionName",headerName:"Collection Name"},{field:"poName",headerName:"PO"},{field:"igpNumber",headerName:"IGP Number"},{field:"igpDate",headerName:"IGP Date",valueGetter:a=>new Date(a).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"receivingDate",headerName:"Receiving Date",valueGetter:a=>new Date(a).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"receivedQty",headerName:"Received",renderCell:a=>e.jsx(Z,{label:a.row.receivedQty,status:"Received"})},{field:"processTypename",headerName:"Process Type"},{field:"statusName",headerName:"Status",renderCell:a=>e.jsx(Z,{label:a.value,status:a.value})},{field:"Actions",headerName:"Actions",renderCell:a=>e.jsx("div",{style:{display:"flex",justifyContent:"space-around"},children:e.jsxs(xe,{variant:"text",size:"small",sx:{mt:1},children:[e.jsx(H,{size:"small",color:"primary",onClick:()=>ve(a.row),disabled:a.row.status===4,children:"Inspection"}),e.jsx(H,{size:"small",color:"primary",onClick:()=>je(a.row),children:"View"})]})})}],Ne=[{field:"id",headerName:"Sr#"},{field:"designNo",headerName:"Design"},{field:"colorName",headerName:"Color"},{field:"fabricName",headerName:"Fabric"},{field:"issuanceQuantity",headerName:"Quantity Issued",valueGetter:a=>a.toLocaleString()},{field:"receivedQty",headerName:"Received",valueGetter:a=>a.toLocaleString()},{field:"gradeAQty",headerName:"Grade A",valueGetter:a=>a.toLocaleString()},{field:"gradeBQty",headerName:"Grade B",valueGetter:a=>a?a.toLocaleString():"0"},{field:"gradeCPQty",headerName:"Cut Pc",valueGetter:a=>a?a.toLocaleString():"0"},{field:"others1Qty",headerName:"Others",valueGetter:a=>a?a.toLocaleString():"0"},{field:"shortStock",headerName:"Short Stock",valueGetter:a=>a?a.toLocaleString():"0"},{field:"remarks",headerName:"Remarks"},{field:"statusName",headerName:"Status"}];return e.jsx(ke,{style:{borderWidth:1,borderStyle:"dotted",borderColor:"#a11f23",width:"auto",maxHeight:{xs:"80vh",md:"auto"},overflow:"auto"},children:e.jsx(W,{sx:{width:"100%",typography:"body1"},children:e.jsxs(Le,{value:m,children:[e.jsx(W,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(ze,{onChange:S,children:[e.jsx(w,{icon:e.jsx(Re,{}),label:"Dyeing Inspection",value:"1",sx:a=>({"& .MuiTouchRipple-child":{backgroundColor:`${a.palette.primary.main} !important`}})}),e.jsx(w,{icon:e.jsx(O,{}),label:"Embroidery Inspection",value:"2",sx:a=>({"& .MuiTouchRipple-child":{backgroundColor:`${a.palette.primary.main} !important`}})}),e.jsx(w,{icon:e.jsx(O,{}),label:"Schiffili Inspection",value:"3",sx:a=>({"& .MuiTouchRipple-child":{backgroundColor:`${a.palette.primary.main} !important`}})}),e.jsx(w,{icon:e.jsx(O,{}),label:"Additional Process Inspection",value:"4",sx:a=>({"& .MuiTouchRipple-child":{backgroundColor:`${a.palette.primary.main} !important`}})}),e.jsx(w,{icon:e.jsx(O,{}),label:"Additional Services Inspection",value:"5",sx:a=>({"& .MuiTouchRipple-child":{backgroundColor:`${a.palette.primary.main} !important`}})})]})}),e.jsx(C,{value:"1",children:e.jsxs(W,{sx:{width:"100%",typography:"body1"},children:[e.jsxs(fe,{variant:"outlined",children:[e.jsx(pe,{className:"css-4rfrnx-MuiCardHeader-root",title:"Pending Inspections",titleTypographyProps:{style:{color:"white"}}}),e.jsxs(o,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(I,{fullWidth:!0,select:!0,label:"Production",name:"productionId",value:d.productionId,onChange:T,size:"small",children:r.map(a=>e.jsx(ce,{value:a.productionId,children:a.collectionName},a.productionId))})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(I,{fullWidth:!0,select:!0,label:"PO#",name:"poId",value:d.poId,onChange:T,size:"small",children:N.map(a=>e.jsx(ce,{value:a.poId,children:a.poIdName},a.poId))})}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx(M,{initialRows:z,iColumns:Ie,height:!0,hideAction:!0}),e.jsxs(q,{open:v,onClose:U,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(_,{sx:{backgroundColor:"#A11F23",color:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",paddingX:"24px",paddingY:"4px"},children:[e.jsx(G,{variant:"h4",component:"div",color:"#ffffff",gutterBottom:!0,fontSize:20,fontWeight:2,fontStyle:"normal",children:"Start Inspection"}),e.jsx(ee,{onClick:U,sx:{color:"#ffffff"},children:e.jsx(Y,{})})]}),e.jsxs(K,{children:[e.jsx(J,{id:"alert-dialog-slide-description"}),e.jsx(Te,{rData:B,handleClose:U,refetch:L})]})]}),e.jsxs(q,{open:V,onClose:se,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(_,{sx:{backgroundColor:"#A11F23",color:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",paddingX:"24px",paddingY:"4px",mb:2.5},children:[e.jsx(G,{variant:"h4",component:"div",color:"#ffffff",gutterBottom:!0,fontSize:20,fontWeight:2,fontStyle:"normal",children:"View Inspection"}),e.jsx(ee,{onClick:se,sx:{color:"#ffffff"},children:e.jsx(Y,{})})]}),e.jsxs(K,{children:[e.jsx(J,{id:"alert-dialog-slide-description"}),e.jsx(M,{initialRows:x,iColumns:Ne,hideAction:!0})]})]})]})]})]}),e.jsx(Fe,{formData:d})]})}),e.jsx(C,{value:"2"}),e.jsx(C,{value:"3"}),e.jsx(C,{value:"4"}),e.jsx(C,{value:"5"}),e.jsx(C,{value:"6"})]})})})};export{et as default};
