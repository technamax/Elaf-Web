import{r as Z,i as ee,j as e,A as V,_ as q,N as le,u as te,B as O,a as ie,e as re,c as de,M as ce,C as U,d as Q,G as c,D as X}from"./index-D_mF4B5t.js";import{r as l}from"./vendor-BXCbSo2_.js";import{B as oe,a as j}from"./axios-DMod4shj.js";import{u as ue,G as E,d as he,a as me,D as pe,b as ge,E as xe,c as fe}from"./ExcelExport-COFPiD_X.js";import{d as Ce}from"./Close-Dpiuv4c2.js";import"./dayjs.min-DO4_1a-m.js";import{M as D}from"./Skeleton-0kTGRzah.js";import{d as Ie,a as be}from"./AddCircle-p_5yTfPx.js";import{T as je,a as ve,b as Y,c as J}from"./TabPanel-DRxCH0vW.js";import{T as R}from"./TextField-9z7gW76p.js";var F={},we=ee;Object.defineProperty(F,"__esModule",{value:!0});var ne=F.default=void 0,ye=we(Z()),Pe=e;ne=F.default=(0,ye.default)((0,Pe.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add");var A={},De=ee;Object.defineProperty(A,"__esModule",{value:!0});var ae=A.default=void 0,Me=De(Z()),Se=e;ae=A.default=(0,Me.default)((0,Se.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save");const ke=["label","icon","showInMenu","onClick"],Ee=["label","icon","showInMenu","onClick","closeMenuOnClick","closeMenu"],T=l.forwardRef((i,f)=>{var u;const g=ue();if(!i.showInMenu){const{label:r,icon:h,onClick:d}=i,m=V(i,ke),M=S=>{d==null||d(S)};return e.jsx(g.slots.baseIconButton,q({ref:f,size:"small",role:"menuitem","aria-label":r},m,{onClick:M},(u=g.slotProps)==null?void 0:u.baseIconButton,{children:l.cloneElement(h,{fontSize:"small"})}))}const{label:v,icon:w,onClick:x,closeMenuOnClick:B=!0,closeMenu:C}=i,y=V(i,Ee),a=r=>{x==null||x(r),B&&(C==null||C())};return e.jsxs(D,q({ref:f},y,{onClick:a,children:[w&&e.jsx(le,{children:w}),v]}))});function K({initialRows:i,ncolumns:f,formData:g,deleteApi:v,disableDelete:w,deleteBy:x,editAPi:B,disableEdit:C,disableAddRecord:y,refetch:a}){const{user:u}=te(),[r,h]=l.useState(i),[d,m]=l.useState({});l.useEffect(()=>{h(i)},[i]);function M(n){const{setRows:t,setRowModesModel:o}=n,s=()=>{const p=r.length+1,k={id:p,...g,isNew:!0};t(P=>[...P,k]),o(P=>({...P,[p]:{mode:E.Edit,fieldToFocus:"collectionName"}}))};return e.jsxs(ge,{sx:{justifyContent:"space-between"},children:[e.jsx(oe,{color:"primary",startIcon:e.jsx(ne,{}),onClick:s,disabled:y,disab:!0,children:"Add record"}),e.jsx(xe,{data:i,fileName:"collection"})]})}const S=(n,t)=>{n.reason===fe.rowFocusOut&&(t.defaultMuiPrevented=!0)},N=n=>()=>{m({...d,[n]:{mode:E.Edit}})},G=n=>async()=>{const o=r.find(s=>s.id===n)[x];try{await j.delete(`${v}${o}`),h(r.filter(s=>s.id!==n))}catch(s){console.error("Error deleting data:",s)}},H=n=>()=>{m({...d,[n]:{mode:E.View,ignoreModifications:!0}}),r.find(o=>o.id===n).isNew&&h(r.filter(o=>o.id!==n))},L=async(n,t)=>{console.log("newRow",n);try{const{id:o,...s}=n;console.log("formattedRow",s);const p={lastUpdatedBy:u.empId,lastUpdatedOn:new Date().toISOString()},k={...s,...p},P=await j.post(B,k),z={...P.data.result,id:n.id};return h(se=>se.map(W=>W.id===n.id?z:W)),console.log("response.data:",P.data),z;a()}catch(o){throw console.error("Error updating data:",o),o}},I=n=>{m(n)},_=n=>async()=>{m(t=>({...t,[n]:{mode:E.View}}))},$=[...f,{field:"actions",type:"actions",headerName:"Actions",width:100,cellClassName:"actions",getActions:({id:n})=>{var o;return((o=d[n])==null?void 0:o.mode)===E.Edit?[e.jsx(T,{icon:e.jsx(ae,{}),label:"Save",sx:{color:"primary.main"},onClick:_(n)}),e.jsx(T,{icon:e.jsx(Ce,{}),label:"Cancel",className:"textPrimary",onClick:H(n),color:"inherit",sx:{color:"error.dark"}})]:[e.jsx(T,{icon:e.jsx(he,{}),label:"Edit",className:"textPrimary",onClick:N(n),color:"inherit",sx:{color:"secondary.dark"},disabled:C}),e.jsx(T,{icon:e.jsx(me,{}),label:"Delete",onClick:G(n),color:"inherit",sx:{color:"error.dark"},disabled:w})]}}],b=(n,t)=>{t.defaultMuiPrevented=!0};return e.jsx(O,{sx:{height:500,width:"inherit","& .actions":{color:"text.secondary"},"& .textPrimary":{color:"text.primary"}},children:e.jsx(pe,{sx:{"--DataGrid-rowBorderColor":"rgb(255 255 255)"},rows:r,columns:$,editMode:"row",rowModesModel:d,onRowModesModelChange:I,onRowEditStop:S,processRowUpdate:L,slots:{toolbar:M},slotProps:{toolbar:{setRows:h,setRowModesModel:m}},getRowId:n=>n.id,onCellDoubleClick:b})})}const Fe=()=>{const{data:i,refetch:f}=ie(),{data:g,refetch:v}=re(),{user:w}=te(),{enqueueSnackbar:x}=de(),[B,C]=l.useState([]);l.useEffect(()=>{g&&(C(g.result),v())},[g]);const y=(i==null?void 0:i.result)||[],[a,u]=l.useState({collectionName:"",collectionId:"",plannedCollectionId:"",plannedDesignedId:"",designId:"",poPcs:"",batchNo:"",createdBy:w.empId,createdOn:new Date().toISOString()}),[r,h]=l.useState([]),[d,m]=l.useState([]),[M,S]=l.useState([]),[N,G]=l.useState([]),[H,L]=l.useState("1"),I=l.useCallback(async()=>{try{if(a.plannedDesignedId){const o=(await j.get(`https://gecxc.com:4041/api/PrePlanning/GetPlanningHeaderListByDesignId?designId=${a.plannedDesignedId}`)).data.result.map((s,p)=>({...s,id:p+1}));G(o),v()}}catch(t){console.error("Error fetching data:",t),G([])}},[a.plannedDesignedId]);l.useEffect(()=>{I()},[I]);const _=[{field:"collectionName",headerName:"Collection",editable:!0,flex:2},{field:"batchNo",headerName:"Batch#",flex:1,editable:!0},{field:"designNo",headerName:"Design Number",flex:1,editable:!0},{field:"Status",headerName:"Status",flex:1,editable:!0}],$=(t,o)=>{L(o)},b=async t=>{const{name:o,value:s}=t.target;if(o==="collectionId"){const p=y.find(k=>k.collectionId===parseInt(s));u({...a,collectionId:s,poPcs:p?p.poPcs:""})}else u(o==="designId"?{...a,designId:s,plannedDesignedId:s}:{...a,[o]:s})},n=async()=>{try{const t=await j.post("https://gecxc.com:4041/api/PrePlanning/SavePrePlanningHeader",a);x("Planning Batch saved successfully!",{variant:"success",autoHideDuration:5e3}),u({...a,designId:"",poPcs:"",batchNo:""}),await f(),await I()}catch(t){console.error("Error saving data:",t),x("Planning Batch not saved successfully!",{variant:"error",autoHideDuration:5e3})}};return l.useEffect(()=>{(async()=>{if(a.collectionId)try{const o=await j.get(`https://gecxc.com:4041/API/DesignRegistration/GetDesignListByCollectionId?CollectionId=${a.collectionId}`);h(o.data.result)}catch(o){console.error("Error fetching design options:",o)}})()},[a.collectionId]),l.useEffect(()=>{(async()=>{try{const o=await j.get("https://gecxc.com:4041/api/PrePlanning/GetCollectionListFromPlanningHeader");m(o.data.result)}catch(o){console.error("Error fetching planned collections:",o)}})()},[]),l.useEffect(()=>{(async()=>{if(a.plannedCollectionId)try{const o=await j.get(`https://gecxc.com:4041/api/PrePlanning/GetDesignFromPlanningHeaderByCollectionId?collectionid=${a.plannedCollectionId}`);S(o.data.result)}catch(o){console.error("Error fetching planned designs:",o)}})()},[a.plannedCollectionId]),e.jsx(ce,{style:{borderWidth:1,borderStyle:"dotted",borderColor:"#a11f23",width:"auto",maxHeight:{xs:"80vh",md:"auto"},overflow:"auto"},children:e.jsx(O,{sx:{width:"100%",typography:"body1"},children:e.jsxs(je,{value:H,children:[e.jsx(O,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(ve,{onChange:$,"aria-label":"lab API tabs example",children:[e.jsx(Y,{icon:e.jsx(Ie,{}),label:"Add Collection",value:"1",sx:t=>({"& .MuiTouchRipple-child":{backgroundColor:`${t.palette.primary.main} !important`}})}),e.jsx(Y,{icon:e.jsx(be,{}),label:"Search Collection",value:"2",sx:t=>({"& .MuiTouchRipple-child":{backgroundColor:`${t.palette.primary.main} !important`}})})]})}),e.jsx(J,{value:"1",children:e.jsxs(U,{variant:"outlined",children:[e.jsx(Q,{className:"css-4rfrnx-MuiCardHeader-root",title:"Create Batch Planning",titleTypographyProps:{style:{color:"white"}}}),e.jsxs(c,{container:!0,spacing:2,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(c,{item:!0,xs:12,md:4,children:e.jsx(R,{fullWidth:!0,select:!0,label:"Select Collection",name:"collectionId",value:a.collectionId,onChange:b,size:"small",InputLabelProps:{sx:{color:"black"}},children:y.map(t=>e.jsx(D,{value:t.collectionId,children:t.collectionName},t.collectionId))})}),e.jsx(c,{item:!0,xs:12,md:4,children:e.jsx(R,{fullWidth:!0,select:!0,label:"Select Design",name:"designId",value:a.designId,onChange:b,size:"small",InputLabelProps:{sx:{color:"black"}},children:r.map(t=>e.jsx(D,{value:t.designId,children:t.designNo},t.designId))})}),e.jsx(c,{item:!0,xs:12,md:4,children:e.jsx(R,{label:"Po PCs",fullWidth:!0,size:"small",name:"poPcs",value:a.poPcs,onChange:b,sx:t=>({...a.poPcs!==""&&{".css-4a5t8g-MuiInputBase-input-MuiOutlinedInput-input":{backgroundColor:"#c9c9c9 !important"}},"& .MuiInputBase-input.Mui-disabled":{WebkitTextFillColor:"black"},"& .MuiInputBase-root.Mui-disabled":{backgroundColor:"#f9f9f9"},"& .MuiOutlinedInput-root.Mui-disabled .MuiOutlinedInput-notchedOutline":{},"& .MuiInputLabel-root.Mui-disabled":{color:"rgba(0, 0, 0, 0.87)"}}),InputLabelProps:{sx:{color:"black"}}})}),e.jsx(c,{item:!0,xs:12,md:12,textAlign:"right",sx:{marginBottom:2},children:e.jsx(oe,{variant:"contained",size:"small",onClick:n,children:"Save"})}),e.jsx(X,{color:"#cc8587",sx:{height:2,width:"100%",mt:2}}),e.jsx(c,{item:!0,xs:12,paddingTop:1,children:e.jsx(K,{initialRows:N,ncolumns:_,formData:a,fetchData:I,refetch:f})})]})]})}),e.jsx(J,{value:"2",children:e.jsxs(U,{variant:"outlined",children:[e.jsx(Q,{className:"css-4rfrnx-MuiCardHeader-root",title:"Searc Batch Planning",titleTypographyProps:{style:{color:"white"}}}),e.jsxs(c,{container:!0,spacing:2,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(c,{item:!0,xs:12,md:4,children:e.jsx(R,{fullWidth:!0,select:!0,label:"Select Collection",name:"plannedCollectionId",value:a.plannedCollectionId,onChange:b,size:"small",children:d.length>0?d.map(t=>e.jsx(D,{id:"ddlCollection",value:t.collectionId,children:t.collectionName},t.planningHeaderId)):e.jsx(D,{disabled:!0,children:"No Collections Available"})})}),e.jsx(c,{item:!0,xs:12,md:4,children:e.jsx(R,{fullWidth:!0,select:!0,label:"Design",name:"plannedDesignedId",value:a.plannedDesignedId,onChange:b,size:"small",children:M.map(t=>e.jsx(D,{value:t.designId,children:t.designNo},t.planningHeaderId))})}),e.jsx(X,{color:"#cc8587",sx:{height:2,width:"100%",mt:2}}),e.jsx(c,{item:!0,xs:12,paddingTop:1,children:e.jsx(K,{initialRows:N,ncolumns:_,formData:a,fetchData:I})})]})]})})]})})})};export{Fe as default};
