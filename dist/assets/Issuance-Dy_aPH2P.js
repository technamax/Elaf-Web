import{c as le,u as oe,a6 as ze,j as e,G as l,T as $,s as Ee,a7 as K,a8 as We,a9 as Oe,aa as Fe,ab as Me,ac as Ae,ad as $e,B as H,C as Z,d as ee,D as He,l as Ve,M as qe}from"./index-CFVVvMCv.js";import{r as n}from"./vendor-BXCbSo2_.js";import{d as Ue}from"./CategoryOutlined-aciTGmNr.js";import{d as D}from"./AssignmentOutlined-BrwFvefQ.js";import{B as Q,a as de,I as te}from"./axios-qW6zj_I1.js";import{d as se}from"./Close-2KGTeAX4.js";import Xe from"./Reports-BlSSelKc.js";import{d as Ye}from"./VisibilityOutlined-J7s5itFi.js";import{R as ce,u as _e,D as we,a as ae,b as ne,c as ie,d as re,B as Je}from"./ReuseableDataGrid-CFuFh_7m.js";import{T as o}from"./TextField-BrYEIcy4.js";import{M as Ke}from"./MenuItem-DgPC5BfG.js";import{T as Ze,a as et,b as N,c as S}from"./TabPanel-CgnMXqCJ.js";import"./Skeleton-CkF-SxFD.js";const tt=({iss:s,handleClose:g,refetchIssuanceData:y})=>{n.useState({});const{enqueueSnackbar:c}=le(),{user:b}=oe(),[h,j]=n.useState([]),{data:p,refetch:u}=ze({poId:s.poId,issuanceId:s.issuanceId},{skip:!s.poId||!s.issuanceId});n.useEffect(()=>{if((p==null?void 0:p.result)===null){j([]);return}p&&j(p.result.map((m,P)=>({id:P+1,...m})))},[p,u]),console.log("iss",s);const d=[{field:"id",headerName:"Sr#"},{field:"fabricName",headerName:"Fabric"},{field:"colorName",headerName:"Color"},{field:"issuanceQuantity",headerName:"Issuance Quantity",valueGetter:m=>m.toLocaleString()},{field:"rate",headerName:"Rate"},{field:"uomName",headerName:"UOM"},{field:"vendorName",headerName:"Fabric"}],x=async()=>{try{const m=await de.get(`http://100.42.177.77:81/api/Issuance/GenerateOGP?poId=${s.poId}&issuanceId=${s.issuanceId}&processTypeId=${s.processTypeId}&createdBy=${b.empId}`);y(),m.data.success?c(`${m.data.message} !`,{variant:"success",autoHideDuration:5e3}):(c(`${m.data.message} !`,{variant:"error",autoHideDuration:5e3}),console.log("response.message",m.data.message)),console.log("Save response:",m.data),g()}catch(m){console.error("Error saving data:",m),c("FAILED: Unable to start Process",{variant:"error",autoHideDuration:5e3})}};return e.jsxs("div",{children:[e.jsxs(l,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(o,{fullWidth:!0,disabled:!0,label:"Production",name:"productionId",value:s.collectionName,size:"small"})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(o,{fullWidth:!0,disabled:!0,label:"Process Type",name:"productionId",value:s.processTypeName,size:"small"})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(o,{size:"small",label:"Issuance Date",name:"issuanceDate",value:new Date(s.issuanceDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"}),fullWidth:!0,disabled:!0,InputLabelProps:{shrink:!0,sx:{color:"black"}}})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(o,{size:"small",label:"ExpectedReturn Date",name:"expectedReturnDate",value:new Date(s.expectedReturnDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"}),fullWidth:!0,disabled:!0,InputLabelProps:{shrink:!0,sx:{color:"black"}}})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(o,{fullWidth:!0,disabled:!0,label:"Vendor",name:"vendorId",value:s.vendorName,size:"small"})})]}),e.jsxs(l,{container:!0,spacing:2,width:"Inherit",children:[e.jsx(l,{item:!0,xs:12,children:e.jsx($,{variant:"h2",children:"Details"})}),e.jsx(l,{item:!0,xs:12,children:e.jsx(ce,{initialRows:h,iColumns:d,hideAction:!0})}),e.jsx(l,{item:!0,xs:12,textAlign:"right",sx:{mt:2},children:e.jsx(Q,{variant:"contained",size:"small",onClick:x,disabled:s.status===9,children:"Generate OGP"})})]})]})},st=Ee(o)(({theme:s})=>({"& .MuiInputBase-input":{fontSize:"0.875rem",padding:"4px 6px"},width:"auto",height:"auto",minWidth:"100px",minHeight:"30px"})),at=({rowData:s})=>{const[g,y]=n.useState([]),c=_e(),{enqueueSnackbar:b}=le(),{user:h}=oe(),[j,p]=n.useState([]),[u,d]=n.useState([]),[x,m]=n.useState([]),[P,ue]=n.useState([]),V=u.reduce((t,a)=>t+(a.quantity??0),0).toFixed(2);console.log("Quantity",V);const q=u.reduce((t,a)=>t+(a.issuanceQuantity??0),0).toFixed(2);console.log("quantities",x);const[i,C]=n.useState({issuanceId:0,poId:(s==null?void 0:s.poId)||0,productionId:(s==null?void 0:s.productionId)||"",issuanceDate:(s==null?void 0:s.issuanceDate)||null,expectedReturnDate:(s==null?void 0:s.expectedReturnDate)||"",processTypeId:1223,fabricId:(s==null?void 0:s.fabricId)||"",fabricName:(s==null?void 0:s.fabricName)||"",vendorId:(s==null?void 0:s.vendorId)||"",vendorName:(s==null?void 0:s.vendorName)||"",shrinkage:(s==null?void 0:s.shrinkage)||"",wastage:(s==null?void 0:s.wastage)||"",locationId:(s==null?void 0:s.locationId)||"",fullLocation:(s==null?void 0:s.fullLocation)||"",poQuantity:0,assignQuantity:0,stockReceived:0,remainingQuantity:0,appId:h.appId,createdOn:new Date().toISOString(),createdBy:h.empId,lastUpdatedOn:new Date().toISOString(),LastUpdatedBy:h.empId});n.useEffect(()=>{C(t=>({...i,poQuantity:V||0,productionHeaderId:x.productionHeaderId||0,assignQuantity:x.itpQuantity||0,stockReceived:x.stockReceived||0,remainingQuantity:t.stockReceived-q||0}))},[s,u,x]);const[it,me]=n.useState([]),[rt,he]=n.useState([]),[lt,fe]=n.useState([]),[pe,xe]=n.useState([]),{data:L,refetch:ge}=K(),{data:v,refetch:Ie}=We(i.poId,{skip:!i.poId}),{data:G,refetch:k}=Oe(i.poId,{skip:!i.poId}),{data:T,refetch:ye}=K(),{data:B,refetch:ot}=Fe(),{data:z,refetch:be}=Me(i.productionId,{skip:!i.productionId}),{data:E,refetch:je}=Ae(i.fabricId,{skip:!i.fabricId}),{data:W,refetch:ve}=$e({productionId:i.productionId,fabricId:i.fabricId},{skip:!i.fabricId||!i.productionId}),[O,Se]=n.useState([]);n.useEffect(()=>{if((v==null?void 0:v.result)===null){d([]);return}v&&d(v.result.map((t,a)=>({id:a+1,...t})))},[v,Ie]),n.useEffect(()=>{T&&p(T.result.map((t,a)=>({id:a+1,...t})))},[T,ye]),n.useEffect(()=>{G&&xe(G.result.map((t,a)=>({id:a+1,...t})))},[G,k]),n.useEffect(()=>{z&&me(z.result.map((t,a)=>({id:a+1,...t})))},[z,be]),n.useEffect(()=>{W&&m(W.result[0])},[W,ve]),n.useEffect(()=>{E&&he(E.result.map((t,a)=>({id:a+1,...t})))},[E,je]),n.useEffect(()=>{B&&fe(B.result.map((t,a)=>({id:a+1,...t})))},[B]),n.useEffect(()=>{L&&Se(L.result.map((t,a)=>({id:a,...t})))},[L,ge]),console.log("quantities",x);const f=t=>{const{name:a,value:I}=t.target;if(a==="poId"){const r=O.find(M=>M.poId===parseInt(I));C({...i,poId:I,shrinkage:r?r.shrinkage:"",productionId:r?r.productionId:"",issuanceDate:r?r.issuanceDate:null,expectedReturnDate:r?r.expectedReturnDate:"",fabricId:r?r.fabricId:"",vendorId:r?r.vendorId:"",locationId:r?r.locationId:"",fullLocation:r?r.fullLocation:"",fabricName:r?r.fabricName:"",vendorName:r?r.vendorName:"",wastage:r?r.wastage:""})}else C({...i,[a]:I})},Ce=async()=>{if(g.length!==u.length){b("Please select all rows before saving.",{variant:"warning"});return}console.log("formData",i);try{const t=await de.post("http://100.42.177.77:81/api/Issuance/IssuanceToVendor",i);console.log("Save response:",t.data),b("Data saved successfully!",{variant:"success"}),ue(a=>[...a,...i.issuanceTransactionDetails]),k()}catch(t){console.error("Error saving data:",t),b("Error saving data!",{variant:"error"})}};console.log("formData",i),console.log("productions",O);const U=n.useCallback(t=>{const{id:a,field:I,value:r}=t;console.log("Editing cell:",t),d(M=>M.map(A=>A.id===a?{...A,[I]:r,issuanceId:0,issuanceDetId:0,appId:h.appId,createdOn:new Date().toISOString(),createdBy:h.empId,lastUpdatedOn:new Date().toISOString(),lastUpdatedBy:h.empId}:A))},[d,h.appId,h.empId]);n.useEffect(()=>{C(t=>({...i,remainingQuantity:t.stockReceived-q||0}))},[U]);const Ne=[{field:"id",headerName:"Sr#"},{field:"designNo",headerName:"Design"},{field:"colorName",headerName:"Color"},{field:"quantity",headerName:"Total Qty",valueGetter:t=>t.toLocaleString()},{field:"issuanceQuantity",headerName:"Issuance Qty",renderCell:t=>e.jsx(st,{variant:"outlined",size:"small",sx:{mt:1,width:"100%"},value:t.row.issuanceQuantity||"",onChange:a=>U({id:t.id,field:"issuanceQuantity",value:Number(a.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})}],ke=()=>{c.current.autosizeColumns({includeHeaders:!0,includeOutliers:!0})};n.useEffect(()=>{ke()});const[dt,Re]=n.useState([]),De=n.useCallback(t=>{y(t);const a=t.map(I=>{const r=c.current.getRow(I);return console.log("rowData",r),r?{...r}:null}).filter(I=>I!==null);console.log("selectedDesigns",a),Re(a)},[c]);n.useEffect(()=>{const t=u.filter(a=>g.includes(a.id));C(a=>({...a,issuanceTransactionDetails:t}))},[u,g]);const Qe=t=>!P.some(a=>a.id===t.id);console.log("poDetails",u),n.useEffect(()=>{c.current&&console.log("API ref is ready:",c.current)},[c]);const[Pe,X]=n.useState(!1),[Le,Y]=n.useState(!1),[_,w]=n.useState(!1),Ge=async t=>{w(t),X(!0)},Te=async t=>{Y(!0),w(t)},F=()=>{X(!1)},J=()=>{Y(!1)},R=t=>t==null||isNaN(t)?"":new Intl.NumberFormat().format(t),Be=[{field:"id",headerName:"Sr#"},{field:"issuanceId",headerName:"Issuance"},{field:"vendorName",headerName:"Vendor"},{field:"issuanceQuantity",headerName:"Issuance"},{field:"issuanceDate",headerName:"Issuance Date",valueGetter:t=>new Date(t).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"expectedReturnDate",headerName:"Expected Return Date",valueGetter:t=>new Date(t).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"fabricCount",headerName:"Fabrics"},{field:"statusName",headerName:"Status"},{field:"Actions",headerName:"Actions",renderCell:t=>e.jsx("div",{style:{display:"flex",justifyContent:"space-around"},children:e.jsxs(Je,{variant:"text",size:"small",children:[e.jsx(Q,{size:"small",color:"primary",onClick:()=>Ge(t.row),children:"View Details"}),e.jsx(Q,{size:"small",color:"primary",onClick:()=>Te(t.row),children:"OGP"})]})})}];return e.jsxs(H,{sx:{width:"100%",typography:"body1"},children:[e.jsxs(Z,{variant:"outlined",children:[e.jsx(ee,{className:"css-4rfrnx-MuiCardHeader-root",title:"Dyeing Issuance",titleTypographyProps:{style:{color:"white"}}}),e.jsxs(l,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(o,{fullWidth:!0,select:!0,label:"Production",name:"poId",value:i.poId,onChange:f,size:"small",children:O.map(t=>e.jsx(Ke,{value:t.poId,children:t.poIdName},t.poId))})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(o,{size:"small",label:"Issuance Date",name:"issuanceDate",value:i.issuanceDate?new Date(i.issuanceDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"}):null,onChange:f,fullWidth:!0,InputLabelProps:{shrink:!0,sx:{color:"black"}}})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(o,{size:"small",label:"Planning Date",name:"expectedReturnDate",value:i.issuanceDate?new Date(i.expectedReturnDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"}):null,onChange:f,fullWidth:!0,InputLabelProps:{shrink:!0,sx:{color:"black"}}})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(o,{fullWidth:!0,label:"Select Fabric",name:"fabricName",value:i.fabricName,onChange:f,size:"small"})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(o,{label:"Vendor",fullWidth:!0,size:"small",name:"vendorName",onChange:f,value:i.vendorName,required:!0})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(o,{label:"Shrinkage",fullWidth:!0,size:"small",name:"shrinkage",onChange:f,value:i.shrinkage,required:!0})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(o,{label:"Wastage",fullWidth:!0,size:"small",name:"wastage",onChange:f,value:i.wastage,required:!0})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(o,{fullWidth:!0,label:"Select Location",name:"fullLocation",value:i.fullLocation,onChange:f,size:"small"})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(o,{fullWidth:!0,label:"PO Quantity",name:"poQuantity",value:R(i.poQuantity),onChange:f,size:"small",disabled:!0})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(o,{fullWidth:!0,label:"Total Quantity",name:"assignQuantity",value:R(i.assignQuantity),onChange:f,size:"small",disabled:!0})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(o,{fullWidth:!0,label:"Available Quantity",name:"stockReceived",value:R(i.stockReceived),onChange:f,size:"small",disabled:!0})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(o,{fullWidth:!0,label:"Remaining Quantity",name:"remainingQuantity",value:R(i.remainingQuantity),onChange:f,size:"small",disabled:!0})}),e.jsx(l,{item:!0,xs:12,children:e.jsx(we,{rows:u,columns:Ne,apiRef:c,disableRowSelectionOnClick:!0,checkboxSelection:!0,isRowSelectable:Qe,onRowSelectionModelChange:De,rowSelectionModel:g})}),e.jsx(l,{item:!0,xs:12,textAlign:"right",sx:{mt:2},children:e.jsx(Q,{variant:"contained",size:"small",onClick:Ce,children:"Save"})})]})]}),e.jsx(He,{color:"#cc8587",sx:{height:1,width:"100%",mt:2}}),e.jsxs(Z,{variant:"outlined",children:[e.jsx(ee,{className:"css-4rfrnx-MuiCardHeader-root",avatar:e.jsx(Ye,{}),title:"View Issuance",titleTypographyProps:{style:{color:"white"}}}),e.jsx(l,{container:!0,spacing:2,width:"Inherit",children:e.jsxs(l,{item:!0,xs:12,children:[e.jsx(ce,{initialRows:pe,iColumns:Be,hideAction:!0,refetchIssuanceData:k}),e.jsxs(ae,{open:Pe,onClose:F,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(ne,{sx:{backgroundColor:"#A11F23",color:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",paddingX:"24px",paddingY:"4px"},children:[e.jsx($,{variant:"h4",component:"div",color:"#ffffff",gutterBottom:!0,fontSize:20,fontWeight:2,fontStyle:"normal",children:"View Issuance Details"}),e.jsx(te,{onClick:F,sx:{color:"#ffffff"},children:e.jsx(se,{})})]}),e.jsxs(ie,{children:[e.jsx(re,{id:"alert-dialog-slide-description"}),e.jsx(tt,{iss:_,handleClose:F,refetchIssuanceData:k})]})]}),e.jsxs(ae,{open:Le,onClose:J,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(ne,{sx:{backgroundColor:"#A11F23",color:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",paddingX:"24px",paddingY:"4px",mb:2.5},children:[e.jsx($,{variant:"h4",component:"div",color:"#ffffff",gutterBottom:!0,fontSize:20,fontWeight:2,fontStyle:"normal",children:"Create OGP"}),e.jsx(te,{onClick:J,sx:{color:"#ffffff"},children:e.jsx(se,{})})]}),e.jsxs(ie,{children:[e.jsx(re,{id:"alert-dialog-slide-description"}),e.jsx(Xe,{rId:13,paramIssuanceId:_.issuanceId})]})]})]})})]})]})},nt=()=>e.jsx("div",{children:e.jsx("h1",{children:"SSRS Report Viewer"})}),Ct=()=>{var j,p,u;const s=Ve(),g=(j=s.state)==null?void 0:j.data,y=(u=(p=s.state)==null?void 0:p.tab)==null?void 0:u.toString();console.log("rowData",g),console.log("tab",y);const[c,b]=n.useState("1"),h=(d,x)=>{b(x),console.log("value",c)};return n.useEffect(()=>{y&&b(y)},[y]),e.jsx(qe,{style:{borderWidth:1,borderStyle:"dotted",borderColor:"#a11f23",width:"auto",maxHeight:{xs:"80vh",md:"auto"},overflow:"auto"},children:e.jsx(H,{sx:{width:"100%",typography:"body1"},children:e.jsxs(Ze,{value:c,children:[e.jsx(H,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(et,{onChange:h,children:[e.jsx(N,{icon:e.jsx(Ue,{}),label:"Dyeing Issuance",value:"1",sx:d=>({"& .MuiTouchRipple-child":{backgroundColor:`${d.palette.primary.main} !important`}})}),e.jsx(N,{icon:e.jsx(D,{}),label:"Embroidery Issuance",value:"2",sx:d=>({"& .MuiTouchRipple-child":{backgroundColor:`${d.palette.primary.main} !important`}})}),e.jsx(N,{icon:e.jsx(D,{}),label:"Schiffili Issuance",value:"3",sx:d=>({"& .MuiTouchRipple-child":{backgroundColor:`${d.palette.primary.main} !important`}})}),e.jsx(N,{icon:e.jsx(D,{}),label:"Additional Process Issuance",value:"4",sx:d=>({"& .MuiTouchRipple-child":{backgroundColor:`${d.palette.primary.main} !important`}})}),e.jsx(N,{icon:e.jsx(D,{}),label:"Additional Services Issuance",value:"5",sx:d=>({"& .MuiTouchRipple-child":{backgroundColor:`${d.palette.primary.main} !important`}})})]})}),e.jsx(S,{value:"1",children:e.jsx(at,{rowData:g})}),e.jsx(S,{value:"2",children:e.jsx(nt,{})}),e.jsx(S,{value:"3"}),e.jsx(S,{value:"4"}),e.jsx(S,{value:"5"}),e.jsx(S,{value:"6"})]})})})};export{Ct as default};
