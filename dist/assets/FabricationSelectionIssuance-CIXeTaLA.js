import{F as Ae,H as Ge,j as e,s as xe,u as ne,c as ge,G as c,b as Ie,au as ze,av as Ee,o as ye,C as Se,d as ve,T as re,aw as Pe,z as Fe,t as ke,ax as Qe,B as le,D as Te,ad as qe,n as Ue,M as We}from"./index-BQnKJm_U.js";import{r as t}from"./vendor-BXCbSo2_.js";import{B as Y,a as $,I as te}from"./axios-CIHeZEXI.js";import{d as Me}from"./AddCircleOutlineOutlined--UbPWSAk.js";import{d as Ve}from"./CategoryOutlined-Bcv7mrwf.js";import{u as be,D as Le,R as ie,a as ue,b as pe,c as me,d as fe,B as Re}from"./ReuseableDataGrid-DM_ExMFu.js";import{d as he}from"./Close-BQnbGXeb.js";import{d as we}from"./VisibilityOutlined-DhBBgDuL.js";import{T as b}from"./TextField-B9bDqCXW.js";import{M as _}from"./MenuItem-CqoynPPu.js";import{T as $e,a as Xe,b as De,c as Ce}from"./TabPanel-eD93EyWL.js";import"./Skeleton-B93ZyZJN.js";var je={},Ye=Ge;Object.defineProperty(je,"__esModule",{value:!0});var Be=je.default=void 0,_e=Ye(Ae()),Je=e;Be=je.default=(0,_e.default)((0,Je.jsx)("path",{d:"M19 3H4.99c-1.11 0-1.98.9-1.98 2L3 19c0 1.1.88 2 1.99 2H19c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 12h-4c0 1.66-1.35 3-3 3s-3-1.34-3-3H4.99V5H19zm-3-5h-2V7h-4v3H8l4 4z"}),"MoveToInbox");const ee=xe(b)(({theme:a})=>({"& .MuiInputBase-input":{fontSize:"0.875rem",padding:"4px 6px"},width:"auto",height:"auto",minWidth:"100px",minHeight:"30px"})),Ke=({fabrics:a,setFabrics:g,stockId:i,handleClose:H,refetchStockData:F})=>{const{user:O}=ne(),{enqueueSnackbar:w}=ge();t.useState([]);const[P,k]=t.useState({stockId:i});console.log("receiveFormData",P),t.useState({});const m=be(),j=a.filter(n=>n.itpQuantity>0);console.log("fabrics",a),console.log("fFabrics",j);const D=n=>{const{id:r,field:x,value:I}=n;console.log("Editing cell:",n),g(N=>N.map(C=>{if(C.id===r){const S={...C,[x]:I,quantity:C.itpQuantity,productName:C.fabricName,appId:O.appId,createdOn:new Date().toISOString(),createdBy:O.empId,lastUpdatedOn:new Date().toISOString(),lastUpdatedBy:O.empId};return(x==="rate"||x==="quantity")&&(S.amount=S.rate*S.quantity),(x==="tax"||x==="rate"||x==="quantity")&&(S.amountAfterTax=S.amount+S.amount*(S.tax/100)),S}return C}))};t.useEffect(()=>{k({...P,stockReceivingDetails:a.filter(n=>n.itpQuantity>0)})},[a,g]),console.log("fabrics",a);const A=[{field:"id",headerName:"Sr#"},{field:"fabricName",headerName:"Fabric"},{field:"barcode",headerName:"Barcode"},{field:"uomName",headerName:"UOM"},{field:"assignQty",headerName:"Assigned Qty",valueGetter:n=>n.toLocaleString()},{field:"itpQuantity",headerName:"itp Qty Received",valueGetter:n=>n.toLocaleString()},{field:"quantity",headerName:"add qty",renderCell:n=>e.jsx(ee,{variant:"outlined",disabled:!0,size:"small",sx:{mt:1,width:"100%"},value:n.row.itpQuantity||"",onChange:r=>D({id:n.id,field:"quantity",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"rate",headerName:"Rate",renderCell:n=>e.jsx(ee,{variant:"outlined",size:"small",sx:{mt:1,width:"100%"},value:n.row.rate||"",onChange:r=>D({id:n.id,field:"rate",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"tax",headerName:"Tax",renderCell:n=>e.jsx(ee,{variant:"outlined",size:"small",sx:{mt:1,width:"100%"},value:n.row.tax||"",onChange:r=>D({id:n.id,field:"tax",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"amount",headerName:"Amount",renderCell:n=>{const x=(n.row.rate*n.row.quantity||0).toLocaleString();return e.jsx(ee,{variant:"outlined",size:"small",sx:{mt:1,width:"100%"},value:x,type:"text",InputProps:{style:{fontSize:"0.875rem"}}})}},{field:"amountAfterTax",headerName:"Amount After Tax",renderCell:n=>{const x=(n.row.amountAfterTax||0).toLocaleString();return e.jsx(ee,{variant:"outlined",size:"small",sx:{mt:1,width:"100%"},value:x,onChange:I=>{const N=Number(I.target.value.replace(/,/g,""));D({id:n.id,field:"amountAfterTax",value:N})},type:"text",InputProps:{style:{fontSize:"0.875rem"}}})}}],G=()=>{m.current.autosizeColumns({includeHeaders:!0,includeOutliers:!0})};t.useEffect(()=>{G()});const l=async()=>{if(j.some(r=>r.rate===void 0||r.rate===0)){w("Please enter rate for all fabrics before saving!",{variant:"warning",autoHideDuration:5e3});return}try{const r=await $.post("http://100.42.177.77:83/api/StockReceiving/SaveStockReceivingDetails",P);console.log("Save response:",r.data),r.data.success?w(`${r.data.message} !`,{variant:"success",autoHideDuration:5e3}):(w(`${r.data.message} !`,{variant:"error",autoHideDuration:5e3}),console.log("response.message",r.data.message)),F(),H()}catch(r){console.error("Error saving data:",r),w("FAILED: Unable to save",{variant:"error",autoHideDuration:5e3})}};return e.jsxs(c,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(c,{item:!0,xs:12,children:e.jsx("div",{style:{height:400,width:"100%"},children:e.jsx(Le,{rows:j,columns:A,pageSize:10,apiRef:m,disableRowSelectionOnClick:!0})})}),e.jsx(c,{item:!0,xs:12,textAlign:"right",sx:{mt:2},children:e.jsx(Y,{variant:"contained",size:"small",onClick:l,children:"Receive"})})," "]})};xe(b)(({theme:a})=>({"& .MuiInputBase-input":{fontSize:"0.875rem",padding:"4px 6px"},width:"auto",height:"auto",minWidth:"100px",minHeight:"30px"}));const Ze=()=>{const{enqueueSnackbar:a}=ge(),{user:g}=ne(),[i,H]=t.useState([]),[F,O]=t.useState([]);t.useState([]),be();const[w,P]=t.useState(!1),[k,m]=t.useState([]),[j,D]=t.useState([]);t.useState(!1);const[A,G]=t.useState([]),[l,n]=t.useState([]);console.log("responseData",l);const[r,x]=t.useState({productionId:0,productionHeaderId:0,processTypeId:1222,itpId:"",status:2,startDate:new Date().toISOString(),appId:g.appId,createdOn:new Date().toISOString(),createdBy:g.empId,lastUpdatedOn:new Date().toISOString(),lastUpdatedBy:g.empId}),[I,N]=t.useState({issuanceNo:i.issuanceNo||0,issuanceName:i.issuanceName||"",barcode:i.barcode||"",itpQuantity:l.itpQuantity||"",requiredQuantity:i.quantity||"",uom:l.uomName||"",issuanceDate:i.issuanceDate||"",fabricName:i.fabricName||"",rate:l.rate||"",tax:l.tax||"",amount:l.amount||"",amountAfterTax:"",remarks:"",createdOn:new Date().toISOString(),createdBy:g.empId,lastUpdatedOn:new Date().toISOString(),lastUpdatedBy:g.empId});t.useEffect(()=>{N({stockId:i.stockId||0,itpDetId:l.itpDetId,issuanceNo:i.issuanceNo||0,issuanceName:i.issuanceName||"",barcode:i.barcode||"",quantity:l.itpQuantity||"",requiredQuantity:i.quantity||"",uom:l.uomName||"",uomId:l.uomId||"",issuanceDate:i.issuanceDate||"",productName:i.fabricName||"",fabricId:i.fabricId||"",rate:l.rate||"",tax:l.tax||"",amount:l.amount||"",amountAfterTax:"",remarks:"",createdOn:new Date().toISOString(),createdBy:g.empId,lastUpdatedOn:new Date().toISOString(),lastUpdatedBy:g.empId})},[i,l]),console.log("addForm:",I);const[C,S]=t.useState([]);t.useState([]),t.useState(!1);const{data:T}=Ie();t.useEffect(()=>{if(T){const s=T.result[0];m(s.productionProcessList),D(s.vendorList)}},[T]);const[z,Q]=t.useState([]),{data:E}=ze(r.collectionId,{skip:!r.collectionId}),{data:X,refetch:q}=Ee(r.productionHeaderId,{skip:!r.productionHeaderId});t.useEffect(()=>{if(E){const s=E.result;Q(s)}},[E]);const{data:L}=ye(),[W,J]=t.useState([]);t.useEffect(()=>{L&&(L.result[0],J(L.result.map((s,u)=>({id:u+1,...s}))))},[L]),t.useEffect(()=>{X&&S(X.result.map((s,u)=>({id:u+1,...s})))},[X,q,r.productionHeaderId]);const d=s=>{const{name:u,value:h}=s.target;if(u==="productionId"){const v=W.find(V=>V.productionId===parseInt(h));x({...r,productionId:h,productionHeaderId:v?v.productionHeaderId:""})}else if(u==="itpId"){const v=A.find(V=>V.itpId===parseInt(h));x({...r,itpId:h,noOfItems:v?v.noOfItems:"",issuanceDate:v?v.issuanceDate:"",issuanceName:v?v.issuanceName:""})}else x({...r,[u]:h}),N({...I,[u]:h})};console.log("formData",r),console.log("productioncollectionList",W),t.useEffect(()=>{const s=()=>{const Z=parseFloat(I.rate)||0,ce=parseFloat(I.quantity)||0;return(Z*ce).toFixed(2)},u=(Z,ce)=>(Z*(1+ce/100)).toFixed(2),h=s(),v=parseFloat(I.tax)||0,V=u(h,v);N(Z=>({...Z,amount:h,amountAfterTax:V}))},[I.rate,I.itpQuantity,I.tax]);const y=async()=>{try{const s=await $.get("http://100.42.177.77:83/api/StockReceiving/FetchItpByAppIdList?appId=1");G(s.data.result.map((u,h)=>({id:h+1,...u})))}catch(s){console.error("Error fetching ITP:",s)}},R=async()=>{try{const s=await $.post("http://100.42.177.77:83/api/StockReceiving/SaveStockReceivingHeader",r);console.log("Save response:",s.data),q(),S(s.data.result.map((u,h)=>({id:h+1,...u}))),s.data.success?a(`${s.data.message} !`,{variant:"success",autoHideDuration:5e3}):(a(`${s.data.message} !`,{variant:"error",autoHideDuration:5e3}),console.log("response.message",s.data.message))}catch(s){console.error("Error saving data:",s),a("FAILED: Unable to start Process",{variant:"error",autoHideDuration:5e3})}};console.log("itps",A);const[K,ae]=t.useState(!1),[de,se]=t.useState(!1),[o,p]=t.useState(null),[f,B]=t.useState(null),U=async s=>{H(s),p(s.stockId);try{const u=await $.get(`http://100.42.177.77:83/api/Production/GetProductionFabricDetailByProductionHeaderId?productionHeaderId=${s.productionHeaderId}&status=2`);O(u.data.result.map((h,v)=>({id:v+1,...h})))}catch(u){console.error("Error fetching ITP:",u)}ae(!0)},M=async s=>{console.log("rowdata",s);try{const u=await $.get(`http://100.42.177.77:83/api/StockReceiving/GetStockByStatusList?productionId=${s.productionId}&status=8`);console.log("response",u);const h=u.data.result;console.log("API Data Result:",h),B(h.map((v,V)=>({id:V+1,...v})))}catch(u){console.error("Error fetching ITP:",u)}se(!0)};console.log("stockView",f);const oe=()=>{ae(!1),H({})},Ne=()=>{se(!1)},He=[{field:"id",headerName:"Sr#"},{field:"collectionName",headerName:"Production"},{field:"issuanceDate",headerName:"Issuance Date",valueGetter:s=>new Date(s).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"issuanceName",headerName:"ITP"},{field:"statusDesc",headerName:"Status"},{field:"View",headerName:"View Details",renderCell:s=>e.jsx("div",{style:{display:"flex",justifyContent:"space-around"},children:e.jsxs(Re,{variant:"text",size:"small",children:[e.jsx(te,{color:"primary",onClick:()=>U(s.row),disabled:s.row.statusId===8,children:e.jsx(Be,{})}),e.jsx(te,{color:"primary",onClick:()=>M(s.row),children:e.jsx(we,{})})]})})}],Oe=[{field:"id",headerName:"Sr#"},{field:"fabricName",headerName:"Fabric"},{field:"barcode",headerName:"Barcode"},{field:"uomName",headerName:"UOM"},{field:"quantity",headerName:"Quantity Received",valueGetter:s=>s.toLocaleString()},{field:"rate",headerName:"Rate",valueGetter:s=>s.toLocaleString()},{field:"tax",headerName:"Tax"},{field:"amount",headerName:"Amount",valueGetter:s=>s.toLocaleString()},{field:"amountAfterTax",headerName:"Amount After Tax",valueGetter:s=>s.toLocaleString()}];return e.jsxs(Se,{variant:"outlined",children:[e.jsx(ve,{className:"css-4rfrnx-MuiCardHeader-root",avatar:e.jsx(we,{}),title:"Fabric Receiving from ITP",titleTypographyProps:{style:{color:"white"}}}),e.jsxs(c,{container:!0,spacing:2,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(c,{item:!0,xs:12,textAlign:"right",sx:{mt:1},children:e.jsx(Y,{variant:"contained",size:"small",onClick:y,color:"success",children:"Fetch ITP"})}),e.jsx(c,{item:!0,xs:12,md:3,children:e.jsx(b,{label:"Production",fullWidth:!0,select:!0,size:"small",name:"productionId",onChange:d,value:r.productionId,required:!0,disabled:w,InputLabelProps:{shrink:!0,sx:{color:"black"}},children:W.map(s=>e.jsx(_,{value:s.productionId,children:s.collectionName},s.id))})}),e.jsx(c,{item:!0,xs:12,md:3,children:e.jsx(b,{size:"small",type:"date",label:"Start Date",name:"startDate",value:r.startDate,onChange:d,fullWidth:!0,InputLabelProps:{shrink:!0,sx:{color:"black"}}})}),e.jsx(c,{item:!0,xs:12,md:3,children:e.jsx(b,{fullWidth:!0,select:!0,label:"Select ITP",name:"itpId",value:r.itpId,onChange:d,size:"small",InputLabelProps:{shrink:!0,sx:{color:"black"}},children:A.map(s=>e.jsx(_,{value:s.itpId,children:s.collectionName},s.id))})}),e.jsx(c,{item:!0,xs:12,textAlign:"right",sx:{mt:2},children:e.jsx(Y,{variant:"contained",size:"small",onClick:R,children:"start Process"})}),e.jsxs(c,{item:!0,xs:12,children:[e.jsx(ie,{initialRows:C,iColumns:He,hideAction:!0}),e.jsxs(ue,{open:K,onClose:oe,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(pe,{sx:{backgroundColor:"#A11F23",color:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",paddingX:"24px",paddingY:"4px"},children:[e.jsx(re,{variant:"h4",component:"div",color:"#ffffff",gutterBottom:!0,fontSize:20,fontWeight:2,fontStyle:"normal",children:"Save Details"}),e.jsx(te,{onClick:oe,sx:{color:"#ffffff"},children:e.jsx(he,{})})]}),e.jsxs(me,{children:[e.jsx(fe,{id:"alert-dialog-slide-description"}),e.jsx(c,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:e.jsx(c,{item:!0,xs:12,children:e.jsx(Ke,{fabrics:F,setFabrics:O,stockId:o,handleClose:oe,refetchStockData:q})})})]})]}),e.jsxs(ue,{open:de,onClose:Ne,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(pe,{sx:{backgroundColor:"#A11F23",color:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",paddingX:"24px",paddingY:"4px"},children:[e.jsx(re,{variant:"h4",component:"div",color:"#ffffff",gutterBottom:!0,fontSize:20,fontWeight:2,fontStyle:"normal",children:"View Stock Receiving Details"}),e.jsx(te,{onClick:Ne,sx:{color:"#ffffff"},children:e.jsx(he,{})})]}),e.jsxs(me,{children:[e.jsx(fe,{id:"alert-dialog-slide-description"}),e.jsx(c,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:e.jsx(c,{item:!0,xs:12,children:e.jsx(ie,{initialRows:f,iColumns:Oe,hideAction:!0})})})]})]})]})]})]})},et=()=>{ne(),t.useState([]),t.useState(!1);const[a,g]=t.useState({}),[i,H]=t.useState({productionId:0,processType:"",status:a==null?void 0:a.statusId,collectionName:(a==null?void 0:a.collectionName)||0,processTypeName:(a==null?void 0:a.processTypeName)||"",startDate:new Date(a==null?void 0:a.startDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})||null,statusName:(a==null?void 0:a.statusName)||"",productionHeaderId:(a==null?void 0:a.productionHeaderId)||""});t.useEffect(()=>{H({...i,collectionName:(a==null?void 0:a.collectionName)||0,processTypeName:(a==null?void 0:a.processTypeName)||"",startDate:new Date(a==null?void 0:a.startDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})||null,statusName:(a==null?void 0:a.statusName)||"",productionHeaderId:(a==null?void 0:a.productionHeaderId)||""})},[a,g]);const[F,O]=t.useState([]);t.useState(!1);const{data:w,refetch:P}=Pe({productionId:i.productionId,status:i.status},{skip:!i.productionId||!i.status}),{data:k,refetch:m}=Fe();Ie();const{data:j}=ke(),{data:D,refetch:A}=Qe({productionHeaderId:i.productionHeaderId,status:i.status},{skip:!i.productionHeaderId||!i.status}),{data:G,refetch:l}=ye(),[n,r]=t.useState([]),[x,I]=t.useState([]),[N,C]=t.useState([]),[S,T]=t.useState([]);console.log("processesList",N),t.useEffect(()=>{j&&C(j.result)},[j]),t.useEffect(()=>{D&&I(D.result.map((d,y)=>({id:y+1,...d})))},[D,A]),t.useEffect(()=>{if(G){const d=new Set,y=G.result.filter(R=>d.has(R.collectionName)?!1:(d.add(R.collectionName),!0)).map((R,K)=>({id:K+1,...R}));T(y)}},[G,l]),t.useEffect(()=>{w&&O(w.result.map((d,y)=>({id:y+1,...d})))},[w,P]),t.useEffect(()=>{k&&r(k.result.map((d,y)=>({id:y,...d})))},[k,m]),console.log("initialRows",F);const z=d=>{const{name:y,value:R}=d.target;H({...i,[y]:R})};console.log("formData",i);const[Q,E]=t.useState(!1),X=d=>{g(d),E(!0)},q=()=>{E(!1),g({})},L=()=>{console.log("handleIssuance: route to dyeingIssuance")},W=[{field:"id",headerName:"Sr#"},{field:"collectionName",headerName:"Production Batch"},{field:"processTypeName",headerName:"Process Type"},{field:"orderNumber",headerName:"Order Number"},{field:"startDate",headerName:"Start Date",valueGetter:d=>new Date(d).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"statusName",headerName:"Status"},{field:"action",headerName:"Action",flex:1,renderCell:d=>e.jsxs(Re,{variant:"outlined",size:"small","aria-label":"outlined primary button group",children:[e.jsx(Y,{onClick:()=>X(d.row),children:"View"}),e.jsx(Y,{onClick:L,children:"Issuance"})]}),sortable:!1,filterable:!1}],J=[{field:"id",headerName:"Sr#"},{field:"fabricName",headerName:"Fabric"},{field:"uomName",headerName:"UOM"},{field:"assignQty",headerName:"PX Assigned Qty",valueGetter:d=>d.toLocaleString()},{field:"rate",headerName:"Rate"},{field:"tax",headerName:"Tax"},{field:"totalBeforeTax",headerName:"Total Before Tax"},{field:"totalAfterTax",headerName:"Total After Tax"}];return e.jsxs(le,{sx:{width:"100%",typography:"body1"},children:[e.jsxs(Se,{variant:"outlined",children:[e.jsx(ve,{className:"css-4rfrnx-MuiCardHeader-root",title:"View Production Process ",titleTypographyProps:{style:{color:"white"}}}),e.jsxs(c,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(c,{item:!0,xs:12,md:3,children:e.jsx(b,{fullWidth:!0,select:!0,label:"Production",name:"productionId",value:i.productionId,onChange:z,size:"small",children:S.map(d=>e.jsx(_,{value:d.productionId,children:d.collectionName},d.productionId))})}),e.jsx(c,{item:!0,xs:12,md:3,children:e.jsx(b,{fullWidth:!0,select:!0,label:"status",name:"status",value:i.status,onChange:z,size:"small",children:N.map(d=>e.jsx(_,{value:d.statusId,children:d.statusDesc},d.statusId))})}),e.jsxs(c,{item:!0,xs:12,children:[e.jsx(ie,{initialRows:F,iColumns:W,hideAction:!0}),e.jsxs(ue,{open:Q,onClose:q,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(pe,{sx:{backgroundColor:"#A11F23",color:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",paddingX:"24px",paddingY:"4px"},children:[e.jsx(re,{variant:"h4",component:"div",color:"#ffffff",gutterBottom:!0,fontSize:20,fontWeight:2,fontStyle:"normal",children:"Issuance View"}),e.jsx(te,{onClick:q,sx:{color:"#ffffff"},children:e.jsx(he,{})})]}),e.jsxs(me,{children:[e.jsx(fe,{id:"alert-dialog-slide-description"}),e.jsxs(c,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(c,{item:!0,xs:12,md:3,children:e.jsx(b,{label:"Issuance",fullWidth:!0,size:"small",name:"collectionName",onChange:z,value:i.collectionName,required:!0,disabled:!0})}),e.jsx(c,{item:!0,xs:12,md:3,children:e.jsx(b,{label:"ProcessType",fullWidth:!0,size:"small",name:"processTypeName",onChange:z,value:i.processTypeName,required:!0,disabled:!0})}),e.jsx(c,{item:!0,xs:12,md:3,children:e.jsx(b,{size:"small",label:"Start Date",name:"startDate",value:i.startDate,onChange:z,fullWidth:!0,disabled:!0,InputLabelProps:{shrink:!0,sx:{color:"black"}}})}),e.jsx(c,{item:!0,xs:12,md:3,children:e.jsx(b,{label:"Status",fullWidth:!0,size:"small",name:"statusName",onChange:z,value:i.statusName,required:!0,disabled:!0})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(ie,{initialRows:x,iColumns:J,hideAction:!0})})]})," "]})]})]})]})]}),e.jsx(Te,{color:"#cc8587",sx:{height:1,width:"100%",mt:2}})]})},tt=xe(b)(({theme:a})=>({"& .MuiInputBase-input":{fontSize:"0.875rem",padding:"4px 6px"},width:"auto",height:"auto",minWidth:"100px",minHeight:"30px"})),ft=()=>{const{user:a}=ne();t.useState([]);const[g,i]=t.useState(!1),[H,F]=t.useState([]),[O,w]=t.useState(!1),{enqueueSnackbar:P}=ge(),k=be(),[m,j]=t.useState({productionId:0,collectionId:"",processTypeId:"",status:"",startDate:new Date().toISOString(),appId:a.appId,createdOn:new Date().toISOString(),createdBy:a.empId,lastUpdatedOn:new Date().toISOString(),lastUpdatedBy:a.empId});console.log("Form Data:",m);const[D,A]=t.useState("1"),G=(o,p)=>{A(p)},[l,n]=t.useState([]);t.useState(!1);const{data:r}=ke(),[x,I]=t.useState([]);t.useEffect(()=>{if(r){const o=Array.isArray(r.result[0])?r.result[0]:r.result;I(o)}},[r]);const{data:N}=Ie();t.useEffect(()=>{if(N){const p=N.result[0].productionProcessList.filter(f=>f.lookUpName==="Fabrication");F(p)}},[N]),qe();const[C,S]=t.useState([]),{data:T,refetch:z}=Ue();t.useEffect(()=>{if(T){const o=T.result[0];S(T.result.map((p,f)=>({id:f+1,...p}))),o&&o.productionId&&j(p=>({...p,productionId:o.productionId}))}},[T,z]);const{data:Q,refetch:E}=ye(),[X,q]=t.useState([]);t.useEffect(()=>{Q&&(Q.result[0],q(Q.result.map((o,p)=>({id:p+1,...o}))))},[Q,E]);const L=o=>{const{name:p,value:f}=o.target;if(p==="collectionId"){const B=C.find(U=>U.collectionId===parseInt(f));j({...m,collectionId:f,productionId:B?B.productionId:"",status:B?B.status:""}),W(1,f)}else j({...m,[p]:f})},W=async(o,p)=>{w(!0);try{const f=await $.get(`http://100.42.177.77:83/api/Production/GetFabricForProductionByCollectionId?appId=${o}&collectionid=${p}`);if(f.data.success){const B=f.data.result.map((U,M)=>({...U,id:U.fabricId,sr:M+1}));n(B)}else console.error(f.data.message)}catch(f){console.error("Failed to fetch fabric for production data",f)}finally{w(!1)}},[J,d]=t.useState([]),{data:y,refetch:R}=Pe({productionId:m.productionId,status:m.ViewStatus},{skip:!m.productionId||!m.ViewStatus});t.useEffect(()=>{y&&d(y.result.map((o,p)=>({...o,id:o.productionHeaderId,sr:p+1})))},[y,R]),console.log(J);const K=o=>{const{id:p,field:f,value:B}=o;console.log("Editing cell:",o),n(U=>U.map(M=>M.id===p?{...M,[f]:B,productionHeaderId:0,productionHeaderDetId:0,appId:a.appId,createdOn:new Date().toISOString(),createdBy:a.empId,lastUpdatedOn:new Date().toISOString(),lastUpdatedBy:a.empId}:M))};t.useEffect(()=>{j({...m,productionDetails:l})},[l,n]);const ae=[{field:"sr",headerName:"Sr#"},{field:"collectionName",headerName:"Collection Name"},{field:"fabricName",headerName:"Fabric Name"},{field:"quantity",headerName:"Quantity",valueGetter:o=>o.toLocaleString(),renderCell:o=>e.jsx(re,{sx:{fontWeight:"bold",mt:2},children:o.value})},{field:"assignQty",headerName:"Assign Quantity",renderCell:o=>e.jsx(tt,{variant:"outlined",size:"small",sx:{mt:1,width:50},value:o.row.assignQty||"",onChange:p=>K({id:o.id,field:"assignQty",value:p.target.value}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"bxQuantity",headerName:"BX Quantity",valueGetter:o=>o.toLocaleString()},{field:"uomName",headerName:"UOM"}];console.log("FormData:",m),console.log("Initial Rows:",l);const de=async()=>{for(let o of l)if(!o.assignQty){P("Error: Enter assign quantity!",{variant:"error",autoHideDuration:5e3});return}try{console.log("FormData:",m),console.log("Initial Rows:",l);const o=await $.post("http://100.42.177.77:83/api/Production/StartProductionProcess",m);o.data.success?(P("Production process started successfully!",{variant:"success",autoHideDuration:5e3}),console.log("API saved successfully"),console.log("Response:",o),n([]),j({productionId:0,collectionId:"",processTypeId:"",status:"",startDate:new Date().toISOString(),appId:a.appId,createdOn:new Date().toISOString(),createdBy:a.empId,lastUpdatedOn:new Date().toISOString(),lastUpdatedBy:a.empId}),E()):(console.error(o.data.message),P("Failed to start production process",{variant:"error",autoHideDuration:5e3}))}catch(o){console.error("Error starting production process",o),P("An error occurred while starting the production process",{variant:"error",autoHideDuration:5e3})}},se=o=>{k.current&&k.current.autosizeColumns&&k.current.autosizeColumns({includeOutliers:!0,includeHeaders:!0})};return e.jsx(We,{style:{borderWidth:1,borderStyle:"dotted",borderColor:"#a11f23",width:"auto",maxHeight:{xs:"80vh",md:"auto"},overflow:"auto"},children:e.jsx(le,{sx:{width:"100%",typography:"body1"},children:e.jsxs($e,{value:D,children:[e.jsx(le,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Xe,{onChange:G,"aria-label":"lab API tabs example",children:[e.jsx(De,{icon:e.jsx(Ve,{}),label:"Production Process Fabrication",value:"1",sx:o=>({"& .MuiTouchRipple-child":{backgroundColor:`${o.palette.primary.main} !important`}})}),e.jsx(De,{icon:e.jsx(Me,{}),label:"Fabric Receving",value:"2",sx:o=>({"& .MuiTouchRipple-child":{backgroundColor:`${o.palette.primary.main} !important`}})})]})}),e.jsxs(Ce,{value:"1",children:[e.jsxs(Se,{variant:"outlined",children:[e.jsx(ve,{className:"css-4rfrnx-MuiCardHeader-root",title:"Production Process > Fabrication",titleTypographyProps:{style:{color:"white"}}}),e.jsxs(c,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(c,{item:!0,xs:12,md:3,children:e.jsx(b,{label:"Collection",fullWidth:!0,select:!0,size:"small",name:"collectionId",onChange:L,value:m.collectionId,required:!0,disabled:g,InputLabelProps:{shrink:!0,sx:{color:"black"}},children:C.map(o=>e.jsx(_,{value:o.collectionId,children:o.collectionName},o.collectionId))})}),e.jsx(c,{item:!0,xs:12,md:3,children:e.jsx(b,{fullWidth:!0,select:!0,label:"Select Process",name:"processTypeId",value:m.processTypeId,onChange:L,size:"small",InputLabelProps:{shrink:!0,sx:{color:"black"}},children:H.map(o=>e.jsx(_,{value:o.lookUpId,children:o.lookUpName},o.lookUpId))})}),e.jsx(c,{item:!0,xs:12,md:3,children:e.jsx(b,{size:"small",type:"date",label:"Start Date",name:"startDate",value:m.startDate,onChange:L,fullWidth:!0,InputLabelProps:{shrink:!0,sx:{color:"black"}}})}),e.jsx(c,{item:!0,xs:3,textAlign:"right",sx:{mt:1},children:e.jsx(Y,{variant:"contained",size:"small",onClick:de,color:"success",children:"Start Process"})}),e.jsx(c,{item:!0,xs:12,mt:1,children:e.jsx(Le,{rows:l,columns:ae,getRowId:o=>o.id,disableRowSelectionOnClick:!0,apiRef:k,onStateChange:se,sx:{"--DataGrid-rowBorderColor":"rgb(255 255 255)","& .css-1kyxv1r-MuiDataGrid-root":{color:"white",backgroundColor:"#323232"},"& .MuiDataGrid-container--top [role=row]":{color:"white",backgroundColor:"#323232"},"& .MuiDataGrid-columnSeparator":{color:"white"},"& .MuiDataGrid-iconButtonContainer":{color:"white"},"& .MuiDataGrid-sortIcon":{color:"white"},"& .css-ptiqhd-MuiSvgIcon-root ":{color:"white"},"& .MuiDataGrid-row":{"&.total-summary-row":{backgroundColor:"darkgray"}}}})})]})]}),e.jsx(Te,{color:"#cc8587",sx:{height:1,width:"100%",mt:2}}),e.jsx(et,{})]}),e.jsx(Ce,{value:"2",children:e.jsx(Ze,{})})]})})})};export{ft as default};
