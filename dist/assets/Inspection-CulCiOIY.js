import{s as se,c as Z,u as ee,I as ne,j as e,G as s,T as O,l as le,J as oe,M as de,B as A,C as ce,d as ue}from"./index-CFVVvMCv.js";import{r as i,R as U}from"./vendor-BXCbSo2_.js";import{B as R,a as te,I as V}from"./axios-qW6zj_I1.js";import{d as me}from"./CategoryOutlined-aciTGmNr.js";import{d as k}from"./AssignmentOutlined-BrwFvefQ.js";import{d as X}from"./Close-2KGTeAX4.js";import"./ReceivingDetails-DnSRGB35.js";import{u as he,D as fe,R as Y,a as q,b as _,c as J,d as K,B as pe}from"./ReuseableDataGrid-CFuFh_7m.js";import{T as b}from"./TextField-BrYEIcy4.js";import{T as xe,a as ge,b as C,c as S}from"./TabPanel-CgnMXqCJ.js";import"./MenuItem-DgPC5BfG.js";import"./Skeleton-CkF-SxFD.js";const N=se(b)(({theme:n})=>({"& .MuiInputBase-input":{fontSize:"0.875rem",padding:"4px 6px"},width:"auto",height:"auto",minWidth:"100px",minHeight:"30px"})),ve=({rData:n,handleClose:Q,refetch:x})=>{const[g,D]=i.useState({inspectionId:0,...n}),w=he(),{enqueueSnackbar:m}=Z(),{user:h}=ee(),[v,f]=i.useState([]),{data:l,refetch:B}=ne(n.receivingId,{skip:!n.receivingId});i.useEffect(()=>{if((l==null?void 0:l.result)===null){f([]);return}l&&f(l.result.map((a,r)=>({id:r+1,...a})))},[l,B]),console.log("rData",n);const u=a=>{const{id:r,field:p,value:y}=a;console.log("Editing cell:",a),f(j=>j.map(o=>{if(o.id===r){const c=(o.issuanceQuantity*100/(100+o.shrinkage+o.wastage)).toFixed(2),G=Math.max(c-o.receivedQty,0);return{...o,[p]:y,inspectionId:0,inspectiondetId:0,expectedQty:Number(c),shortStock:Number(G),appId:h.appId,createdOn:new Date().toISOString(),createdBy:h.empId,lastUpdatedOn:new Date().toISOString(),lastUpdatedBy:h.empId}}return o}))};U.useEffect(()=>{D({...g,inspectionTransactionsDetailsModelList:v})},[v,f]),console.log("formData",g),console.log("receiveDetails",v);const P=[{field:"id",headerName:"Sr#"},{field:"designNo",headerName:"Design"},{field:"colorName",headerName:"Color"},{field:"fabricName",headerName:"Fabric"},{field:"issuanceQuantity",headerName:"Quantity Issued",valueGetter:a=>a.toLocaleString()},{field:"receivedQty",headerName:"Received",valueGetter:a=>a.toLocaleString()},{field:"expectedQty",headerName:"Expected",valueGetter:(a,r)=>(r.issuanceQuantity*100/(100+r.shrinkage+r.wastage)).toLocaleString()},{field:"recA",headerName:"Rec. GradeA",valueGetter:a=>a?a.toLocaleString():"0"},{field:"recB",headerName:"Rec. GradeB ",valueGetter:a=>a?a.toLocaleString():"0"},{field:"recCp",headerName:"Rec. GradeCP",valueGetter:a=>a?a.toLocaleString():"0"},{field:"recOthers1",headerName:"Rec. Others",valueGetter:a=>a?a.toLocaleString():"0"},{field:"gradeAQty",headerName:"Grade A",renderCell:a=>e.jsx(N,{variant:"outlined",size:"small",sx:{mt:1,width:"100%"},value:a.row.gradeAQty||0,onChange:r=>u({id:a.id,field:"gradeAQty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"gradeBQty",headerName:"Grade B",renderCell:a=>e.jsx(N,{variant:"outlined",size:"small",sx:{mt:1,width:"100%"},value:a.row.gradeBQty||0,onChange:r=>u({id:a.id,field:"gradeBQty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"gradeCPQty",headerName:"Cut Pc",renderCell:a=>e.jsx(N,{variant:"outlined",size:"small",sx:{mt:1,width:"100%"},value:a.row.gradeCPQty||0,onChange:r=>u({id:a.id,field:"gradeCPQty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"others1Qty",headerName:"Others",renderCell:a=>e.jsx(N,{variant:"outlined",size:"small",sx:{mt:1,width:"100%"},value:a.row.others1Qty||0,onChange:r=>u({id:a.id,field:"others1Qty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"shortStock",headerName:"Short Stock",valueGetter:(a,r)=>{const p=r.expectedQty,y=r.receivedQty,j=p-y;return j>0?j.toLocaleString():0}},{field:"remarks",headerName:"Remarks",renderCell:a=>e.jsx(N,{variant:"outlined",size:"small",sx:{mt:1,width:"100%"},value:a.row.remarks||"",onChange:r=>u({id:a.id,field:"remarks",value:r.target.value}),InputProps:{style:{fontSize:"0.875rem"}}})}],T=()=>{w.current.autosizeColumns({includeHeaders:!0,includeOutliers:!0})};U.useEffect(()=>{T()});const I=async()=>{try{const a=await te.post("http://100.42.177.77:81/api/Receiving/SaveInspection",g);a.data.success?m(`${a.data.message} !`,{variant:"success",autoHideDuration:5e3}):(m(`${a.data.message} !`,{variant:"error",autoHideDuration:5e3}),console.log("response.message",a.data.message)),x(),console.log("Save response:",a.data),Q()}catch(a){console.error("Error saving data:",a),m("FAILED: Unable to start Process",{variant:"error",autoHideDuration:5e3})}};return e.jsxs("div",{children:[e.jsxs(s,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(s,{item:!0,xs:12,md:3,children:e.jsx(b,{fullWidth:!0,disabled:!0,label:"IGP Number",name:"igpNumber",value:n.igpNumber,size:"small"})}),e.jsx(s,{item:!0,xs:12,md:3,children:e.jsx(b,{fullWidth:!0,disabled:!0,label:"Process Type",name:"processTypename",value:n.processTypename,size:"small"})}),e.jsx(s,{item:!0,xs:12,md:3,children:e.jsx(b,{fullWidth:!0,disabled:!0,label:"Vendor",name:"vendorId",value:n.vendorName,size:"small"})}),e.jsx(s,{item:!0,xs:12,md:3,children:e.jsx(b,{size:"small",label:"IGP Creation Date ",name:"igpDate",value:new Date(n.igpDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"}),fullWidth:!0,disabled:!0,InputLabelProps:{shrink:!0,sx:{color:"black"}}})})]}),e.jsxs(s,{container:!0,spacing:2,width:"Inherit",children:[e.jsx(s,{item:!0,xs:12,children:e.jsx(O,{variant:"h2",children:"Details"})}),e.jsx(s,{item:!0,xs:12,children:e.jsx("div",{style:{height:400,width:"100%"},children:e.jsx(fe,{rows:v,columns:P,apiRef:w,disableRowSelectionOnClick:!0})})}),e.jsx(s,{item:!0,xs:12,textAlign:"right",sx:{mt:2},children:e.jsx(R,{variant:"contained",size:"small",onClick:I,children:"Save"})})]})]})},Qe=()=>{var F,M,H;const n=le(),Q=(F=n.state)==null?void 0:F.data,x=(H=(M=n.state)==null?void 0:M.tab)==null?void 0:H.toString();console.log("rowData",Q),console.log("tab",x);const[g,D]=i.useState("1"),w=(t,d)=>{D(d),console.log("value",g)};i.useEffect(()=>{x&&D(x)},[x]);const{enqueueSnackbar:m}=Z(),{user:h}=ee();i.useState([]);const[v,f]=i.useState(!1),[l,B]=i.useState({issuanceId:"",appId:h.appId,createdOn:new Date().toISOString(),createdBy:h.empId,lastUpdatedOn:new Date().toISOString(),LastUpdatedBy:h.empId}),[u,P]=i.useState([]);i.useState(!1),console.log("initialRows",u);const T=t=>{const{name:d,value:L}=t.target;B({...l,[d]:L})},I=async()=>{if(l.issuanceId)try{const t=await te.get("http://100.42.177.77:81/api/Receiving/GetReceivingHeader",{params:{issuanceId:l.issuanceId,processTypename:"Dyeing"}});console.log("API response:",t.data);const d=t.data.result;if(Array.isArray(d)){const L=d.map($=>({...$,id:$.receivingId}));P(L),m("Data fetched successfully!",{variant:"success"})}else throw new Error("Unexpected data format")}catch(t){console.error("Error fetching data:",t),m("Failed to fetch data!",{variant:"error"})}else m("Please enter an issuance ID!",{variant:"warning"})},[a,r]=i.useState(!1),[p,y]=i.useState({}),[j,o]=i.useState({}),{data:c,refetch:G}=oe(p.receivingId,{skip:!p.receivingId});i.useEffect(()=>{if((c==null?void 0:c.result)===null){o([]);return}c&&o(c.result.map((t,d)=>({id:d+1,...t})))},[c,G]);const E=async t=>{y(t),f(!0)},z=()=>{f(!1)},ae=async t=>{r(!0),y(t),G()},W=()=>{r(!1)},re=[{field:"receivingId",headerName:"Receiving ID"},{field:"igpNumber",headerName:"IGP Number"},{field:"igpDate",headerName:"IGP Date",valueGetter:t=>new Date(t).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"receivingDate",headerName:"Receiving Date",valueGetter:t=>new Date(t).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"collectionName",headerName:"Collection Name"},{field:"poName",headerName:"PO Name",width:180},{field:"processTypename",headerName:"Process Type"},{field:"statusName",headerName:"Status"},{field:"Actions",headerName:"Actions",renderCell:t=>e.jsx("div",{style:{display:"flex",justifyContent:"space-around"},children:e.jsxs(pe,{variant:"text",size:"small",sx:{mt:1},children:[e.jsx(R,{size:"small",color:"primary",onClick:()=>E(t.row),disabled:t.row.status===4,children:"Inspection"}),e.jsx(R,{size:"small",color:"primary",onClick:()=>ae(t.row),children:"View"})]})})}],ie=[{field:"id",headerName:"Sr#"},{field:"designNo",headerName:"Design"},{field:"colorName",headerName:"Color"},{field:"fabricName",headerName:"Fabric"},{field:"issuanceQuantity",headerName:"Quantity Issued",valueGetter:t=>t.toLocaleString()},{field:"receivedQty",headerName:"Received",valueGetter:t=>t.toLocaleString()},{field:"gradeAQty",headerName:"Grade A",valueGetter:t=>t.toLocaleString()},{field:"gradeBQty",headerName:"Grade B",valueGetter:t=>t?t.toLocaleString():"0"},{field:"gradeCPQty",headerName:"Cut Pc",valueGetter:t=>t?t.toLocaleString():"0"},{field:"others1Qty",headerName:"Others",valueGetter:t=>t?t.toLocaleString():"0"},{field:"shortStock",headerName:"Short Stock",valueGetter:t=>t?t.toLocaleString():"0"},{field:"remarks",headerName:"Remarks"},{field:"statusName",headerName:"Status"}];return e.jsx(de,{style:{borderWidth:1,borderStyle:"dotted",borderColor:"#a11f23",width:"auto",maxHeight:{xs:"80vh",md:"auto"},overflow:"auto"},children:e.jsx(A,{sx:{width:"100%",typography:"body1"},children:e.jsxs(xe,{value:g,children:[e.jsx(A,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(ge,{onChange:w,children:[e.jsx(C,{icon:e.jsx(me,{}),label:"Dyeing Inspection",value:"1",sx:t=>({"& .MuiTouchRipple-child":{backgroundColor:`${t.palette.primary.main} !important`}})}),e.jsx(C,{icon:e.jsx(k,{}),label:"Embroidery Inspection",value:"2",sx:t=>({"& .MuiTouchRipple-child":{backgroundColor:`${t.palette.primary.main} !important`}})}),e.jsx(C,{icon:e.jsx(k,{}),label:"Schiffili Inspection",value:"3",sx:t=>({"& .MuiTouchRipple-child":{backgroundColor:`${t.palette.primary.main} !important`}})}),e.jsx(C,{icon:e.jsx(k,{}),label:"Additional Process Inspection",value:"4",sx:t=>({"& .MuiTouchRipple-child":{backgroundColor:`${t.palette.primary.main} !important`}})}),e.jsx(C,{icon:e.jsx(k,{}),label:"Additional Services Inspection",value:"5",sx:t=>({"& .MuiTouchRipple-child":{backgroundColor:`${t.palette.primary.main} !important`}})})]})}),e.jsx(S,{value:"1",children:e.jsx(A,{sx:{width:"100%",typography:"body1"},children:e.jsxs(ce,{variant:"outlined",children:[e.jsx(ue,{className:"css-4rfrnx-MuiCardHeader-root",title:"Inspection",titleTypographyProps:{style:{color:"white"}}}),e.jsxs(s,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(s,{item:!0,xs:12,md:3,children:e.jsx(b,{label:"Enter Issuance Number",type:"number",fullWidth:!0,size:"small",name:"issuanceId",onChange:T,onKeyDown:t=>{t.key==="Enter"&&I()},value:l.issuanceId,required:!0})}),e.jsx(s,{item:!0,xs:12,md:3,sx:{mt:.5},children:e.jsx(R,{variant:"contained",size:"small",onClick:I,children:"Search"})}),e.jsxs(s,{item:!0,xs:12,children:[e.jsx(Y,{initialRows:u,iColumns:re,hideAction:!0}),e.jsxs(q,{open:v,onClose:z,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(_,{sx:{backgroundColor:"#A11F23",color:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",paddingX:"24px",paddingY:"4px"},children:[e.jsx(O,{variant:"h4",component:"div",color:"#ffffff",gutterBottom:!0,fontSize:20,fontWeight:2,fontStyle:"normal",children:"Start Inspection"}),e.jsx(V,{onClick:z,sx:{color:"#ffffff"},children:e.jsx(X,{})})]}),e.jsxs(J,{children:[e.jsx(K,{id:"alert-dialog-slide-description"}),e.jsx(ve,{rData:p,handleClose:z,refetch:I})]})]}),e.jsxs(q,{open:a,onClose:W,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(_,{sx:{backgroundColor:"#A11F23",color:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",paddingX:"24px",paddingY:"4px",mb:2.5},children:[e.jsx(O,{variant:"h4",component:"div",color:"#ffffff",gutterBottom:!0,fontSize:20,fontWeight:2,fontStyle:"normal",children:"View Inspection"}),e.jsx(V,{onClick:W,sx:{color:"#ffffff"},children:e.jsx(X,{})})]}),e.jsxs(J,{children:[e.jsx(K,{id:"alert-dialog-slide-description"}),e.jsx(Y,{initialRows:j,iColumns:ie,hideAction:!0})]})]})]})]})]})})}),e.jsx(S,{value:"2"}),e.jsx(S,{value:"3"}),e.jsx(S,{value:"4"}),e.jsx(S,{value:"5"}),e.jsx(S,{value:"6"})]})})})};export{Qe as default};
