import{u as W,c as $,b as A,r as l,j as e,C as M,d as O,B as v,G as s}from"./index-BVF6sje3.js";import{a as c}from"./axios-BInNlfZe.js";import{T as Q,a as X,b as D,d as _,c as q,e as B,F as S}from"./EditAbleDataGrid-tfUtou1M.js";import{T as d,B as V}from"./TextField-DM8qUbe7.js";import{M as u}from"./Skeleton-Dx8YCbP9.js";import"./DataGrid-CM4g51FS.js";import"./ExcelExport-JuOC5J0r.js";import"./dayjs.min-DRyXq4ez.js";const le=()=>{const{data:m,refetch:x}=W(),{data:p,refetch:I}=$(),{enqueueSnackbar:f}=A(),[J,N]=l.useState([]);l.useEffect(()=>{p&&(N(p.result),I())},[p]);const C=(m==null?void 0:m.result)||[],[t,g]=l.useState({collectionName:"",collectionId:"",plannedCollectionId:"",plannedDesignedId:"",designId:"",poPcs:"",batchNo:"",createdBy:0,createdOn:new Date().toISOString()}),[w,H]=l.useState([]),[j,G]=l.useState([]),[T,E]=l.useState([]),[b,P]=l.useState([]),[F,L]=l.useState("1"),o=l.useCallback(async()=>{try{if(t.plannedDesignedId){const a=(await c.get(`https://gecxc.com:4041/api/PrePlanning/GetPlanningHeaderListByDesignId?designId=${t.plannedDesignedId}`)).data.result.map((i,h)=>({...i,id:h+1}));P(a),I()}}catch(n){console.error("Error fetching data:",n),P([])}},[t.plannedDesignedId]);l.useEffect(()=>{o()},[o]);const y=[{field:"collectionName",headerName:"Collection",editable:!0,flex:2},{field:"batchNo",headerName:"Batch#",flex:1,editable:!0},{field:"designNo",headerName:"Design Number",flex:1,editable:!0},{field:"Status",headerName:"Status",flex:1,editable:!0}],R=(n,a)=>{L(a)},r=async n=>{const{name:a,value:i}=n.target;if(a==="collectionId"){const h=C.find(z=>z.collectionId===parseInt(i));g({...t,collectionId:i,poPcs:h?h.poPcs:""})}else g(a==="designId"?{...t,designId:i,plannedDesignedId:i}:{...t,[a]:i})},k=async()=>{try{const n=await c.post("https://gecxc.com:4041/api/PrePlanning/SavePrePlanningHeader",t);f("Planning Batch saved successfully!",{variant:"success",autoHideDuration:5e3}),g({collectionName:"",collectionId:"",designId:"",poPcs:"",batchNo:""}),await x(),await o()}catch(n){console.error("Error saving data:",n),f("Planning Batch not saved successfully!",{variant:"error",autoHideDuration:5e3})}};return l.useEffect(()=>{(async()=>{if(t.collectionId)try{const a=await c.get(`https://gecxc.com:4041/API/DesignRegistration/GetDesignListByCollectionId?CollectionId=${t.collectionId}`);H(a.data.result)}catch(a){console.error("Error fetching design options:",a)}})()},[t.collectionId]),l.useEffect(()=>{(async()=>{try{const a=await c.get("https://gecxc.com:4041/api/PrePlanning/GetCollectionListFromPlanningHeader");G(a.data.result)}catch(a){console.error("Error fetching planned collections:",a)}})()},[]),l.useEffect(()=>{(async()=>{if(t.plannedCollectionId)try{const a=await c.get(`https://gecxc.com:4041/api/PrePlanning/GetDesignFromPlanningHeaderByCollectionId?collectionid=${t.plannedCollectionId}`);E(a.data.result)}catch(a){console.error("Error fetching planned designs:",a)}})()},[t.plannedCollectionId]),e.jsx(e.Fragment,{children:e.jsx("div",{style:{marginBottom:10,borderRadius:7,width:"auto",maxHeight:{xs:"80vh",md:"auto"},overflow:"auto",padding:5},children:e.jsxs(M,{variant:"outlined",children:[e.jsx(O,{className:"css-4rfrnx-MuiCardHeader-root",title:"Create Batch Planning",titleTypographyProps:{style:{color:"white"}}}),e.jsx(v,{sx:{width:"100%",typography:"body1"},children:e.jsxs(Q,{value:F,children:[e.jsx(v,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(X,{onChange:R,"aria-label":"lab API tabs example",children:[e.jsx(D,{icon:e.jsx(_,{}),label:"Add Collection",value:"1",sx:n=>({"& .MuiTouchRipple-child":{backgroundColor:`${n.palette.primary.main} !important`}})}),e.jsx(D,{icon:e.jsx(q,{}),label:"Search Collection",value:"2",sx:n=>({"& .MuiTouchRipple-child":{backgroundColor:`${n.palette.primary.main} !important`}})})]})}),e.jsx(B,{value:"1",children:e.jsxs(s,{container:!0,spacing:2,width:"inherit",sx:{paddingX:2},children:[e.jsx(s,{item:!0,xs:12,md:4,children:e.jsx(d,{fullWidth:!0,select:!0,label:"Select Collection",name:"collectionId",value:t.collectionId,onChange:r,size:"small",children:C.map(n=>e.jsx(u,{value:n.collectionId,children:n.collectionName},n.collectionId))})}),e.jsx(s,{item:!0,xs:12,md:4,children:e.jsx(d,{fullWidth:!0,select:!0,label:"Select Design",name:"designId",value:t.designId,onChange:r,size:"small",children:w.map(n=>e.jsx(u,{value:n.designId,children:n.designNo},n.designId))})}),e.jsx(s,{item:!0,xs:12,md:4,children:e.jsx(d,{label:"Po PCs",fullWidth:!0,size:"small",name:"poPcs",value:t.poPcs,onChange:r})}),e.jsx(s,{item:!0,xs:12,md:12,textAlign:"right",sx:{marginBottom:2},children:e.jsx(V,{variant:"contained",size:"small",onClick:k,children:"Save"})}),e.jsx(s,{item:!0,xs:12,paddingTop:1,children:e.jsx(S,{initialRows:b,ncolumns:y,formData:t,fetchData:o,refetch:x})})]})}),e.jsx(B,{value:"2",children:e.jsxs(s,{container:!0,spacing:2,width:"inherit",sx:{paddingX:2},children:[e.jsx(s,{item:!0,xs:12,md:4,children:e.jsx(d,{fullWidth:!0,select:!0,label:"Select Collection",name:"plannedCollectionId",value:t.plannedCollectionId,onChange:r,size:"small",children:j.length>0?j.map(n=>e.jsx(u,{id:"ddlCollection",value:n.collectionId,children:n.collectionName},n.planningHeaderId)):e.jsx(u,{disabled:!0,children:"No Collections Available"})})}),e.jsx(s,{item:!0,xs:12,md:4,children:e.jsx(d,{fullWidth:!0,select:!0,label:"Design",name:"plannedDesignedId",value:t.plannedDesignedId,onChange:r,size:"small",children:T.map(n=>e.jsx(u,{value:n.designId,children:n.designNo},n.planningHeaderId))})}),e.jsx(s,{item:!0,xs:12,paddingTop:1,children:e.jsx(S,{initialRows:b,ncolumns:y,formData:t,fetchData:o})})]})})]})})]})})})};export{le as default};
