import{I as ze,J as Ge,j as e,s as xe,u as ie,c as ge,G as d,b as Ie,ay as Ee,az as Fe,o as ye,C as Se,d as ve,T as oe,aA as Pe,E as Qe,t as ke,aB as qe,B as le,D as Te,ah as Ue,n as We,M as Me}from"./index-k9GWQJOu.js";import{r as t}from"./vendor-BXCbSo2_.js";import{B as ee,a as $,I as Z}from"./axios-CaswPiu6.js";import{d as Ve}from"./AddCircleOutlineOutlined-DpKzaeF_.js";import{d as $e}from"./CategoryOutlined-MdM7JIJy.js";import{u as be,D as Le,R as re,a as ue,b as pe,c as me,d as fe,B as Re}from"./ReuseableDataGrid-D6KGNruf.js";import{d as he}from"./Close-CwC_dym4.js";import{S as Be}from"./StatusChip-DQNIzaKK.js";import{d as Ne}from"./VisibilityOutlined-6VCp2fDn.js";import{T as v}from"./TextField-Bw61L3Ab.js";import{M as Y}from"./MenuItem-BJ2KxKJk.js";import{T as Xe,a as Ye,b as De,c as Ce}from"./TabPanel-CYIvsX5V.js";import"./Skeleton-C1-xTFDk.js";var je={},_e=Ge;Object.defineProperty(je,"__esModule",{value:!0});var Oe=je.default=void 0,Je=_e(ze()),Ke=e;Oe=je.default=(0,Je.default)((0,Ke.jsx)("path",{d:"M19 3H4.99c-1.11 0-1.98.9-1.98 2L3 19c0 1.1.88 2 1.99 2H19c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 12h-4c0 1.66-1.35 3-3 3s-3-1.34-3-3H4.99V5H19zm-3-5h-2V7h-4v3H8l4 4z"}),"MoveToInbox");const K=xe(v)(({theme:a})=>({"& .MuiInputBase-input":{fontSize:"0.875rem",padding:"4px 6px"},width:"auto",height:"auto",minWidth:"100px",minHeight:"30px"})),Ze=({fabrics:a,setFabrics:y,initialFormData:i,stockId:O,handleClose:G,refetchStockData:U})=>{const{user:N}=ie(),{enqueueSnackbar:D}=ge();t.useState([]);const[j,f]=t.useState({stockId:O,itpId:i.itpId,productionId:i.productionId});console.log("receiveFormData",j),t.useState({});const w=be(),T=a.filter(r=>r.itpQuantity>0);console.log("fabrics",a),console.log("fFabrics",T),console.log("initialFormData",i);const C=r=>{const{id:c,field:p,value:b}=r;console.log("Editing cell:",r),y(L=>L.map(P=>{if(P.id===c){const h={...P,[p]:b,quantity:P.itpQuantity,productName:P.fabricName,appId:N.appId,createdOn:new Date().toISOString(),createdBy:N.empId,lastUpdatedOn:new Date().toISOString(),lastUpdatedBy:N.empId};return(p==="rate"||p==="quantity")&&(h.amount=h.rate*h.quantity),(p==="tax"||p==="rate"||p==="quantity")&&(h.amountAfterTax=h.amount+h.amount*(h.tax/100)),h}return P}))};t.useEffect(()=>{f({...j,stockReceivingDetails:a.filter(r=>r.itpQuantity>0)})},[a,y]),console.log("fabrics",a);const H=[{field:"id",headerName:"Sr#"},{field:"fabricName",headerName:"Fabric"},{field:"barcode",headerName:"Barcode"},{field:"uomName",headerName:"UOM"},{field:"assignQty",headerName:"Assigned Qty",valueGetter:r=>r.toLocaleString()},{field:"itpQuantity",headerName:"itp Qty Received",valueGetter:r=>r.toLocaleString()},{field:"quantity",headerName:"add qty",renderCell:r=>e.jsx(K,{variant:"outlined",disabled:!0,size:"small",sx:{mt:1,width:"100%"},value:r.row.itpQuantity||"",onChange:c=>C({id:r.id,field:"quantity",value:Number(c.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"rate",headerName:"Rate",renderCell:r=>e.jsx(K,{variant:"outlined",size:"small",sx:{mt:1,width:"100%"},value:r.row.rate||"",onChange:c=>C({id:r.id,field:"rate",value:Number(c.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"tax",headerName:"Tax",renderCell:r=>e.jsx(K,{variant:"outlined",size:"small",sx:{mt:1,width:"100%"},value:r.row.tax||"",onChange:c=>C({id:r.id,field:"tax",value:Number(c.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"amount",headerName:"Amount",renderCell:r=>{const p=(r.row.rate*r.row.quantity||0).toLocaleString();return e.jsx(K,{variant:"outlined",size:"small",sx:{mt:1,width:"100%"},value:p,type:"text",InputProps:{style:{fontSize:"0.875rem"}}})}},{field:"amountAfterTax",headerName:"Amount After Tax",renderCell:r=>{const p=(r.row.amountAfterTax||0).toLocaleString();return e.jsx(K,{variant:"outlined",size:"small",sx:{mt:1,width:"100%"},value:p,onChange:b=>{const L=Number(b.target.value.replace(/,/g,""));C({id:r.id,field:"amountAfterTax",value:L})},type:"text",InputProps:{style:{fontSize:"0.875rem"}}})}}],l=()=>{w.current.autosizeColumns({includeHeaders:!0,includeOutliers:!0})};t.useEffect(()=>{l()});const E=async()=>{if(T.some(c=>c.rate===void 0||c.rate===0)){D("Please enter rate for all fabrics before saving!",{variant:"warning",autoHideDuration:5e3});return}try{const c=await $.post("http://100.42.177.77:8091/api/StockReceiving/SaveStockReceivingDetails",j);console.log("Save response:",c.data),c.data.success?D(`${c.data.message} !`,{variant:"success",autoHideDuration:5e3}):(D(`${c.data.message} !`,{variant:"error",autoHideDuration:5e3}),console.log("response.message",c.data.message)),U(),G()}catch(c){console.error("Error saving data:",c),D("FAILED: Unable to save",{variant:"error",autoHideDuration:5e3})}};return e.jsxs(d,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(d,{item:!0,xs:12,children:e.jsx("div",{style:{height:400,width:"100%"},children:e.jsx(Le,{rows:T,columns:H,pageSize:10,apiRef:w,disableRowSelectionOnClick:!0})})}),e.jsx(d,{item:!0,xs:12,textAlign:"right",sx:{mt:2},children:e.jsx(ee,{variant:"contained",size:"small",onClick:E,children:"Receive"})})," "]})};xe(v)(({theme:a})=>({"& .MuiInputBase-input":{fontSize:"0.875rem",padding:"4px 6px"},width:"auto",height:"auto",minWidth:"100px",minHeight:"30px"}));const et=()=>{const{enqueueSnackbar:a}=ge(),{user:y}=ie(),[i,O]=t.useState([]),[G,U]=t.useState([]);t.useState([]),be();const[N,D]=t.useState(!1),[j,f]=t.useState([]),[w,T]=t.useState([]);t.useState(!1);const[C,H]=t.useState([]),[l,E]=t.useState([]);console.log("responseData",l);const[r,c]=t.useState({productionId:0,productionHeaderId:0,processTypeId:1222,itpId:"",status:2,startDate:new Date().toISOString(),appId:y.appId,createdOn:new Date().toISOString(),createdBy:y.empId,lastUpdatedOn:new Date().toISOString(),lastUpdatedBy:y.empId}),[p,b]=t.useState({issuanceNo:i.issuanceNo||0,issuanceName:i.issuanceName||"",barcode:i.barcode||"",itpQuantity:l.itpQuantity||"",requiredQuantity:i.quantity||"",uom:l.uomName||"",issuanceDate:i.issuanceDate||"",fabricName:i.fabricName||"",rate:l.rate||"",tax:l.tax||"",amount:l.amount||"",amountAfterTax:"",remarks:"",createdOn:new Date().toISOString(),createdBy:y.empId,lastUpdatedOn:new Date().toISOString(),lastUpdatedBy:y.empId});t.useEffect(()=>{b({stockId:i.stockId||0,itpDetId:l.itpDetId,issuanceNo:i.issuanceNo||0,issuanceName:i.issuanceName||"",barcode:i.barcode||"",quantity:l.itpQuantity||"",requiredQuantity:i.quantity||"",uom:l.uomName||"",uomId:l.uomId||"",issuanceDate:i.issuanceDate||"",productName:i.fabricName||"",fabricId:i.fabricId||"",rate:l.rate||"",tax:l.tax||"",amount:l.amount||"",amountAfterTax:"",remarks:"",createdOn:new Date().toISOString(),createdBy:y.empId,lastUpdatedOn:new Date().toISOString(),lastUpdatedBy:y.empId})},[i,l]),console.log("addForm:",p);const[L,P]=t.useState([]);t.useState([]),t.useState(!1);const{data:h}=Ie();t.useEffect(()=>{if(h){const s=h.result[0];f(s.productionProcessList),T(s.vendorList)}},[h]);const[A,F]=t.useState([]),{data:z}=Ee(r.collectionId,{skip:!r.collectionId}),{data:X,refetch:Q}=Fe(r.productionHeaderId,{skip:!r.productionHeaderId});t.useEffect(()=>{if(z){const s=z.result;F(s)}},[z]);const{data:R}=ye(),[W,n]=t.useState([]);t.useEffect(()=>{R&&(R.result[0],n(R.result.map((s,u)=>({id:u+1,...s}))))},[R]),t.useEffect(()=>{X&&P(X.result.map((s,u)=>({id:u+1,...s})))},[X,Q,r.productionHeaderId]);const g=s=>{const{name:u,value:I}=s.target;if(u==="productionId"){const S=W.find(V=>V.productionId===parseInt(I));c({...r,productionId:I,productionHeaderId:S?S.productionHeaderId:""})}else if(u==="itpId"){const S=C.find(V=>V.itpId===parseInt(I));c({...r,itpId:I,noOfItems:S?S.noOfItems:"",issuanceDate:S?S.issuanceDate:"",issuanceName:S?S.issuanceName:""})}else c({...r,[u]:I}),b({...p,[u]:I})};console.log("formData",r),console.log("productioncollectionList",W),t.useEffect(()=>{const s=()=>{const J=parseFloat(p.rate)||0,ce=parseFloat(p.quantity)||0;return(J*ce).toFixed(2)},u=(J,ce)=>(J*(1+ce/100)).toFixed(2),I=s(),S=parseFloat(p.tax)||0,V=u(I,S);b(J=>({...J,amount:I,amountAfterTax:V}))},[p.rate,p.itpQuantity,p.tax]);const k=async()=>{try{const s=await $.get("http://100.42.177.77:8091/api/StockReceiving/FetchItpByAppIdList?appId=1");H(s.data.result.map((u,I)=>({id:I+1,...u})))}catch(s){console.error("Error fetching ITP:",s)}},_=async()=>{try{const s=await $.post("http://100.42.177.77:8091/api/StockReceiving/SaveStockReceivingHeader",r);console.log("Save response:",s.data),Q(),P(s.data.result.map((u,I)=>({id:I+1,...u}))),s.data.success?a(`${s.data.message} !`,{variant:"success",autoHideDuration:5e3}):(a(`${s.data.message} !`,{variant:"error",autoHideDuration:5e3}),console.log("response.message",s.data.message))}catch(s){console.error("Error saving data:",s),a("FAILED: Unable to start Process",{variant:"error",autoHideDuration:5e3})}};console.log("itps",C);const[ne,te]=t.useState(!1),[de,ae]=t.useState(!1),[o,m]=t.useState(null),[x,B]=t.useState(null),q=async s=>{O(s),m(s.stockId);try{const u=await $.get(`http://100.42.177.77:8091/api/Production/GetProductionFabricDetailByProductionHeaderId?productionHeaderId=${s.productionHeaderId}&status=2`);U(u.data.result.map((I,S)=>({id:S+1,...I})))}catch(u){console.error("Error fetching ITP:",u)}te(!0)},M=async s=>{console.log("rowdata",s);try{const u=await $.get(`http://100.42.177.77:8091/api/StockReceiving/GetStockByStatusList?productionId=${s.productionId}&status=8`);console.log("response",u);const I=u.data.result;console.log("API Data Result:",I),B(I.map((S,V)=>({id:V+1,...S})))}catch(u){console.error("Error fetching ITP:",u)}ae(!0)};console.log("stockView",x);const se=()=>{te(!1),O({})},we=()=>{ae(!1)},He=[{field:"id",headerName:"Sr#"},{field:"collectionName",headerName:"Production"},{field:"issuanceDate",headerName:"Issuance Date",valueGetter:s=>new Date(s).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"issuanceName",headerName:"ITP"},{field:"statusDesc",headerName:"Status",renderCell:s=>e.jsx(Be,{label:s.row.statusDesc,status:"Received"})},{field:"View",headerName:"View Details",renderCell:s=>e.jsx("div",{style:{display:"flex",justifyContent:"space-around"},children:e.jsxs(Re,{variant:"text",size:"small",children:[e.jsx(Z,{color:"primary",onClick:()=>q(s.row),disabled:s.row.statusId===8,children:e.jsx(Oe,{})}),e.jsx(Z,{color:"primary",onClick:()=>M(s.row),children:e.jsx(Ne,{})})]})})}],Ae=[{field:"id",headerName:"Sr#"},{field:"fabricName",headerName:"Fabric"},{field:"barcode",headerName:"Barcode"},{field:"uomName",headerName:"UOM"},{field:"quantity",headerName:"Quantity Received",valueGetter:s=>s.toLocaleString()},{field:"rate",headerName:"Rate",valueGetter:s=>s.toLocaleString()},{field:"tax",headerName:"Tax"},{field:"amount",headerName:"Amount",valueGetter:s=>s.toLocaleString()},{field:"amountAfterTax",headerName:"Amount After Tax",valueGetter:s=>s.toLocaleString()}];return e.jsxs(Se,{variant:"outlined",children:[e.jsx(ve,{className:"css-4rfrnx-MuiCardHeader-root",avatar:e.jsx(Ne,{}),title:"Fabric Receiving from ITP",titleTypographyProps:{style:{color:"white"}}}),e.jsxs(d,{container:!0,spacing:2,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(d,{item:!0,xs:12,textAlign:"right",sx:{mt:1},children:e.jsx(ee,{variant:"contained",size:"small",onClick:k,color:"success",children:"Fetch ITP"})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(v,{label:"Production",fullWidth:!0,select:!0,size:"small",name:"productionId",onChange:g,value:r.productionId,required:!0,disabled:N,InputLabelProps:{shrink:!0,sx:{color:"black"}},children:W.map(s=>e.jsx(Y,{value:s.productionId,children:s.collectionName},s.id))})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(v,{size:"small",type:"date",label:"Start Date",name:"startDate",value:r.startDate,onChange:g,fullWidth:!0,InputLabelProps:{shrink:!0,sx:{color:"black"}}})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(v,{fullWidth:!0,select:!0,label:"Issuance Name",name:"itpId",value:r.itpId,onChange:g,size:"small",InputLabelProps:{shrink:!0,sx:{color:"black"}},children:C.map(s=>e.jsx(Y,{value:s.itpId,children:s.issuanceName},s.id))})}),e.jsx(d,{item:!0,xs:12,textAlign:"right",sx:{mt:2},children:e.jsx(ee,{variant:"contained",size:"small",onClick:_,children:"start Process"})}),e.jsxs(d,{item:!0,xs:12,children:[e.jsx(re,{initialRows:L,iColumns:He,hideAction:!0}),e.jsxs(ue,{open:ne,onClose:se,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(pe,{sx:{backgroundColor:"#A11F23",color:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",paddingX:"24px",paddingY:"4px"},children:[e.jsx(oe,{variant:"h4",component:"div",color:"#ffffff",gutterBottom:!0,fontSize:20,fontWeight:2,fontStyle:"normal",children:"Save Details"}),e.jsx(Z,{onClick:se,sx:{color:"#ffffff"},children:e.jsx(he,{})})]}),e.jsxs(me,{children:[e.jsx(fe,{id:"alert-dialog-slide-description"}),e.jsx(d,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:e.jsx(d,{item:!0,xs:12,children:e.jsx(Ze,{fabrics:G,setFabrics:U,stockId:o,handleClose:se,initialFormData:i,refetchStockData:Q})})})]})]}),e.jsxs(ue,{open:de,onClose:we,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(pe,{sx:{backgroundColor:"#A11F23",color:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",paddingX:"24px",paddingY:"4px"},children:[e.jsx(oe,{variant:"h4",component:"div",color:"#ffffff",gutterBottom:!0,fontSize:20,fontWeight:2,fontStyle:"normal",children:"View Stock Receiving Details"}),e.jsx(Z,{onClick:we,sx:{color:"#ffffff"},children:e.jsx(he,{})})]}),e.jsxs(me,{children:[e.jsx(fe,{id:"alert-dialog-slide-description"}),e.jsx(d,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:e.jsx(d,{item:!0,xs:12,children:e.jsx(re,{initialRows:x,iColumns:Ae,hideAction:!0})})})]})]})]})]})]})},tt=()=>{ie(),t.useState([]),t.useState(!1);const[a,y]=t.useState({}),[i,O]=t.useState({productionId:0,processType:"",status:a==null?void 0:a.statusId,collectionName:(a==null?void 0:a.collectionName)||0,processTypeName:(a==null?void 0:a.processTypeName)||"",startDate:new Date(a==null?void 0:a.startDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})||null,statusName:(a==null?void 0:a.statusName)||"",productionHeaderId:(a==null?void 0:a.productionHeaderId)||""});t.useEffect(()=>{O({...i,collectionName:(a==null?void 0:a.collectionName)||0,processTypeName:(a==null?void 0:a.processTypeName)||"",startDate:new Date(a==null?void 0:a.startDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})||null,statusName:(a==null?void 0:a.statusName)||"",productionHeaderId:(a==null?void 0:a.productionHeaderId)||""})},[a,y]);const[G,U]=t.useState([]);t.useState(!1);const{data:N,refetch:D}=Pe({productionId:i.productionId,status:i.status},{skip:!i.productionId||!i.status}),{data:j,refetch:f}=Qe();Ie();const{data:w}=ke(),{data:T,refetch:C}=qe({productionHeaderId:i.productionHeaderId,status:i.status},{skip:!i.productionHeaderId||!i.status}),{data:H,refetch:l}=ye(),[E,r]=t.useState([]),[c,p]=t.useState([]),[b,L]=t.useState([]),[P,h]=t.useState([]);console.log("processesList",b),t.useEffect(()=>{if(w){const n=w.result.filter(g=>g.statusId===2);L(n)}},[w]),t.useEffect(()=>{T&&p(T.result.map((n,g)=>({id:g+1,...n})))},[T,C]),t.useEffect(()=>{if(H){const n=new Set,g=H.result.filter(k=>n.has(k.collectionName)?!1:(n.add(k.collectionName),!0)).map((k,_)=>({id:_+1,...k}));h(g)}},[H,l]),t.useEffect(()=>{N&&U(N.result.map((n,g)=>({id:g+1,...n})))},[N,D]),t.useEffect(()=>{j&&r(j.result.map((n,g)=>({id:g,...n})))},[j,f]),console.log("initialRows",G);const A=n=>{const{name:g,value:k}=n.target;O({...i,[g]:k})};console.log("formData",i);const[F,z]=t.useState(!1),X=n=>{y(n),z(!0)},Q=()=>{z(!1),y({})},R=[{field:"id",headerName:"Sr#"},{field:"collectionName",headerName:"Production Batch"},{field:"processTypeName",headerName:"Process Type"},{field:"orderNumber",headerName:"Order Number"},{field:"startDate",headerName:"Start Date",valueGetter:n=>new Date(n).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"statusName",headerName:"Status",renderCell:n=>e.jsx(Be,{label:n.row.statusName,status:"In Process"})},{field:"action",headerName:"Action",flex:1,renderCell:n=>e.jsx(Re,{variant:"outlined",size:"small","aria-label":"outlined primary button group",children:e.jsx(ee,{onClick:()=>X(n.row),children:"View"})}),sortable:!1,filterable:!1}],W=[{field:"id",headerName:"Sr#"},{field:"fabricName",headerName:"Fabric"},{field:"uomName",headerName:"UOM"},{field:"assignQty",headerName:"PX Assigned Qty",valueGetter:n=>n.toLocaleString()}];return e.jsxs(le,{sx:{width:"100%",typography:"body1"},children:[e.jsxs(Se,{variant:"outlined",children:[e.jsx(ve,{className:"css-4rfrnx-MuiCardHeader-root",title:"View Production Process ",titleTypographyProps:{style:{color:"white"}}}),e.jsxs(d,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(v,{fullWidth:!0,select:!0,label:"Production",name:"productionId",value:i.productionId,onChange:A,size:"small",children:P.map(n=>e.jsx(Y,{value:n.productionId,children:n.collectionName},n.productionId))})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(v,{fullWidth:!0,select:!0,label:"status",name:"status",value:i.status,onChange:A,size:"small",children:b.map(n=>e.jsx(Y,{value:n.statusId,children:n.statusDesc},n.statusId))})}),e.jsxs(d,{item:!0,xs:12,children:[e.jsx(re,{initialRows:G,iColumns:R,hideAction:!0}),e.jsxs(ue,{open:F,onClose:Q,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(pe,{sx:{backgroundColor:"#A11F23",color:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",paddingX:"24px",paddingY:"4px"},children:[e.jsx(oe,{variant:"h4",component:"div",color:"#ffffff",gutterBottom:!0,fontSize:20,fontWeight:2,fontStyle:"normal",children:"Issuance View"}),e.jsx(Z,{onClick:Q,sx:{color:"#ffffff"},children:e.jsx(he,{})})]}),e.jsxs(me,{children:[e.jsx(fe,{id:"alert-dialog-slide-description"}),e.jsxs(d,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(v,{label:"Issuance",fullWidth:!0,size:"small",name:"collectionName",onChange:A,value:i.collectionName,required:!0,disabled:!0})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(v,{label:"ProcessType",fullWidth:!0,size:"small",name:"processTypeName",onChange:A,value:i.processTypeName,required:!0,disabled:!0})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(v,{size:"small",label:"Start Date",name:"startDate",value:i.startDate,onChange:A,fullWidth:!0,disabled:!0,InputLabelProps:{shrink:!0,sx:{color:"black"}}})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(v,{label:"Status",fullWidth:!0,size:"small",name:"statusName",onChange:A,value:i.statusName,required:!0,disabled:!0})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(re,{initialRows:c,iColumns:W,hideAction:!0})})]})," "]})]})]})]})]}),e.jsx(Te,{color:"#cc8587",sx:{height:1,width:"100%",mt:2}})]})},at=xe(v)(({theme:a})=>({"& .MuiInputBase-input":{fontSize:"0.875rem",padding:"4px 6px"},width:"auto",height:"auto",minWidth:"100px",minHeight:"30px"})),xt=()=>{const{user:a}=ie();t.useState([]);const[y,i]=t.useState(!1),[O,G]=t.useState([]),[U,N]=t.useState(!1),{enqueueSnackbar:D}=ge(),j=be(),[f,w]=t.useState({productionId:0,collectionId:"",processTypeId:"",status:"",startDate:new Date().toISOString(),appId:a.appId,createdOn:new Date().toISOString(),createdBy:a.empId,lastUpdatedOn:new Date().toISOString(),lastUpdatedBy:a.empId});console.log("Form Data:",f);const[T,C]=t.useState("1"),H=(o,m)=>{C(m)},[l,E]=t.useState([]);t.useState(!1);const{data:r}=ke(),[c,p]=t.useState([]);t.useEffect(()=>{if(r){const o=Array.isArray(r.result[0])?r.result[0]:r.result;p(o)}},[r]);const{data:b}=Ie();t.useEffect(()=>{if(b){const m=b.result[0].productionProcessList.filter(x=>x.lookUpName==="Fabrication");G(m)}},[b]),Ue();const[L,P]=t.useState([]),{data:h,refetch:A}=We();t.useEffect(()=>{if(h){const o=h.result[0];P(h.result.map((m,x)=>({id:x+1,...m}))),o&&o.productionId&&w(m=>({...m,productionId:o.productionId}))}},[h,A]);const{data:F,refetch:z}=ye(),[X,Q]=t.useState([]);t.useEffect(()=>{F&&(F.result[0],Q(F.result.map((o,m)=>({id:m+1,...o}))))},[F,z]);const R=o=>{const{name:m,value:x}=o.target;if(m==="collectionId"){const B=L.find(q=>q.collectionId===parseInt(x));w({...f,collectionId:x,productionId:B?B.productionId:"",status:B?B.status:""}),W(1,x)}else w({...f,[m]:x})},W=async(o,m)=>{N(!0);try{const x=await $.get(`http://100.42.177.77:8091/api/Production/GetFabricForProductionByCollectionId?appId=${o}&collectionid=${m}`);if(x.data.success){const B=x.data.result.map((q,M)=>({...q,id:q.fabricId,sr:M+1}));E(B)}else console.error(x.data.message)}catch(x){console.error("Failed to fetch fabric for production data",x)}finally{N(!1)}},[n,g]=t.useState([]),{data:k,refetch:_}=Pe({productionId:f.productionId,status:f.ViewStatus},{skip:!f.productionId||!f.ViewStatus});t.useEffect(()=>{k&&g(k.result.map((o,m)=>({...o,id:o.productionHeaderId,sr:m+1})))},[k,_]),console.log(n);const ne=o=>{const{id:m,field:x,value:B}=o;console.log("Editing cell:",o),E(q=>q.map(M=>M.id===m?{...M,[x]:B,productionHeaderId:0,productionHeaderDetId:0,appId:a.appId,createdOn:new Date().toISOString(),createdBy:a.empId,lastUpdatedOn:new Date().toISOString(),lastUpdatedBy:a.empId}:M))};t.useEffect(()=>{w({...f,productionDetails:l})},[l,E]);const te=[{field:"sr",headerName:"Sr#"},{field:"collectionName",headerName:"Collection Name"},{field:"fabricName",headerName:"Fabric Name"},{field:"quantity",headerName:"Quantity",valueGetter:o=>o.toLocaleString(),renderCell:o=>e.jsx(oe,{sx:{fontWeight:"bold",mt:2},children:o.value})},{field:"assignQty",headerName:"Assign Quantity",renderCell:o=>e.jsx(at,{variant:"outlined",size:"small",sx:{mt:1,width:50},value:o.row.assignQty||"",onChange:m=>ne({id:o.id,field:"assignQty",value:m.target.value}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"uomName",headerName:"UOM"}];console.log("FormData:",f),console.log("Initial Rows:",l);const de=async()=>{for(let o of l)if(!o.assignQty){D("Error: Enter assign quantity!",{variant:"error",autoHideDuration:5e3});return}try{console.log("FormData:",f),console.log("Initial Rows:",l);const o=await $.post("http://100.42.177.77:8091/api/Production/StartProductionProcess",f);o.data.success?(D("Production process started successfully!",{variant:"success",autoHideDuration:5e3}),console.log("API saved successfully"),console.log("Response:",o),E([]),w({productionId:0,collectionId:"",processTypeId:"",status:"",startDate:new Date().toISOString(),appId:a.appId,createdOn:new Date().toISOString(),createdBy:a.empId,lastUpdatedOn:new Date().toISOString(),lastUpdatedBy:a.empId}),z()):(console.error(o.data.message),D("Failed to start production process",{variant:"error",autoHideDuration:5e3}))}catch(o){console.error("Error starting production process",o),D("An error occurred while starting the production process",{variant:"error",autoHideDuration:5e3})}},ae=o=>{j.current&&j.current.autosizeColumns&&j.current.autosizeColumns({includeOutliers:!0,includeHeaders:!0})};return e.jsx(Me,{style:{borderWidth:1,borderStyle:"dotted",borderColor:"#a11f23",width:"auto",maxHeight:{xs:"80vh",md:"auto"},overflow:"auto"},children:e.jsx(le,{sx:{width:"100%",typography:"body1"},children:e.jsxs(Xe,{value:T,children:[e.jsx(le,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Ye,{onChange:H,"aria-label":"lab API tabs example",children:[e.jsx(De,{icon:e.jsx($e,{}),label:"Production Process Fabrication",value:"1",sx:o=>({"& .MuiTouchRipple-child":{backgroundColor:`${o.palette.primary.main} !important`}})}),e.jsx(De,{icon:e.jsx(Ve,{}),label:"Fabric Receving",value:"2",sx:o=>({"& .MuiTouchRipple-child":{backgroundColor:`${o.palette.primary.main} !important`}})})]})}),e.jsxs(Ce,{value:"1",children:[e.jsxs(Se,{variant:"outlined",children:[e.jsx(ve,{className:"css-4rfrnx-MuiCardHeader-root",title:"Fabric Requisitions",titleTypographyProps:{style:{color:"white"}}}),e.jsxs(d,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(v,{label:"Collection",fullWidth:!0,select:!0,size:"small",name:"collectionId",onChange:R,value:f.collectionId,required:!0,disabled:y,InputLabelProps:{shrink:!0,sx:{color:"black"}},children:L.map(o=>e.jsx(Y,{value:o.collectionId,children:o.collectionName},o.collectionId))})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(v,{fullWidth:!0,select:!0,label:"Select Process",name:"processTypeId",value:f.processTypeId,onChange:R,size:"small",InputLabelProps:{shrink:!0,sx:{color:"black"}},children:O.map(o=>e.jsx(Y,{value:o.lookUpId,children:o.lookUpName},o.lookUpId))})}),e.jsx(d,{item:!0,xs:12,md:3,children:e.jsx(v,{size:"small",type:"date",label:"Start Date",name:"startDate",value:f.startDate,onChange:R,fullWidth:!0,InputLabelProps:{shrink:!0,sx:{color:"black"}}})}),e.jsx(d,{item:!0,xs:3,textAlign:"right",sx:{mt:1},children:e.jsx(ee,{variant:"contained",size:"small",onClick:de,color:"success",children:"Start Process"})}),e.jsx(d,{item:!0,xs:12,mt:1,children:e.jsx(Le,{rows:l,columns:te,getRowId:o=>o.id,disableRowSelectionOnClick:!0,apiRef:j,onStateChange:ae,sx:{"--DataGrid-rowBorderColor":"rgb(255 255 255)","& .css-1kyxv1r-MuiDataGrid-root":{color:"white",backgroundColor:"#323232"},"& .MuiDataGrid-container--top [role=row]":{color:"white",backgroundColor:"#323232"},"& .MuiDataGrid-columnSeparator":{color:"white"},"& .MuiDataGrid-iconButtonContainer":{color:"white"},"& .MuiDataGrid-sortIcon":{color:"white"},"& .css-ptiqhd-MuiSvgIcon-root ":{color:"white"},"& .MuiDataGrid-row":{"&.total-summary-row":{backgroundColor:"darkgray"}}}})})]})]}),e.jsx(Te,{color:"#cc8587",sx:{height:1,width:"100%",mt:2}}),e.jsx(tt,{})]}),e.jsx(Ce,{value:"2",children:e.jsx(et,{})})]})})})};export{xt as default};
