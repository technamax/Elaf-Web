import{s as ne,c as M,u as W,a8 as Ne,j as e,G as o,T as A,a9 as de,C as le,d as oe,P as Ce,L as Se,n as be,aa as Qe,M as De,B as z}from"./index-39l8sM5Y.js";import{r as i,R as J}from"./vendor-BXCbSo2_.js";import{d as Ge}from"./CategoryOutlined-BFUgLYEY.js";import{d as R}from"./AssignmentOutlined-gcmYWm7Z.js";import{d as Z}from"./Close-wcyf3mqg.js";import"./ReceivingDetails-CuQLLjUI.js";import{u as ce,D as Pe,R as O,B as ue,a as ee,b as te,c as ae,d as re}from"./ReuseableDataGrid-BPyget6h.js";import{S as E}from"./StatusChip-CqVTwn9e.js";import{B as me,a as Re,I as ie}from"./axios-BWUwFnln.js";import{T as g}from"./TextField-B7IP_ndE.js";import{T as we,a as Be,b as Q,c as N}from"./TabPanel-BsG9cIUb.js";import{M as se}from"./MenuItem-qJMJ5sWO.js";import"./Skeleton-_4TR0oIL.js";const C=ne(g)(({theme:d})=>({"& .MuiInputBase-input":{fontSize:"0.875rem",padding:"4px 6px"},width:"auto",height:"auto",minWidth:"100px",minHeight:"30px"})),ke=({rData:d,handleClose:D,refetch:x})=>{const[p,y]=i.useState({inspectionId:0,...d}),u=ce(),{enqueueSnackbar:m}=M(),{user:v}=W(),[s,n]=i.useState([]),{data:h,refetch:G}=Ne(d.receivingId,{skip:!d.receivingId});i.useEffect(()=>{if((h==null?void 0:h.result)===null){n([]);return}h&&n(h.result.map((a,r)=>({id:r+1,...a,gradeAQty:0,gradeBQty:0,gradeCPQty:0,others1Qty:0,rejectedQty:0,remarks:""})))},[h,G]),console.log("rData",d);const f=a=>{const{id:r,field:j,value:b}=a;console.log("Editing cell:",a),n(P=>P.map(l=>{if(l.id===r){const w=(l.issuanceQuantity*100/(100+l.shrinkage+l.wastage)).toFixed(2),B=Math.max(l.receivedQty-((l.gradeAQty||0)+(l.gradeBQty||0)+(l.gradeCPQty||0)+(l.rejectedQty||0)+(l.others1Qty||0)),0);return{...l,[j]:b,inspectionId:0,inspectiondetId:0,expectedQty:Number(w),shortageQty:Number(B),appId:v.appId,createdOn:new Date().toISOString(),createdBy:v.empId,lastUpdatedOn:new Date().toISOString(),lastUpdatedBy:v.empId}}return l}))};J.useEffect(()=>{y({...p,inspectionTransactionsDetailsModelList:s})},[s,n]),console.log("formData",p),console.log("receiveDetails",s);const S=[{field:"id",headerName:"Sr#"},{field:"designNo",headerName:"Design"},{field:"colorName",headerName:"Color"},{field:"fabricName",headerName:"Fabric"},{field:"issuanceQuantity",headerName:"Quantity Issued",valueGetter:a=>a?a.toLocaleString():"0"},{field:"receivedQty",headerName:"Received",valueGetter:a=>a?a.toLocaleString():"0"},{field:"expectedQty",headerName:"Expected",valueGetter:(a,r)=>(r.issuanceQuantity*100/(100+r.shrinkage+r.wastage)).toLocaleString()},{field:"recA",headerName:"Rec. GradeA",valueGetter:a=>a?a.toLocaleString():"0"},{field:"recB",headerName:"Rec. GradeB ",valueGetter:a=>a?a.toLocaleString():"0"},{field:"recCp",headerName:"Rec. GradeCP",valueGetter:a=>a?a.toLocaleString():"0"},{field:"recOthers1",headerName:"Rec. Others",valueGetter:a=>a?a.toLocaleString():"0"},{field:"gradeAQty",headerName:"Grade A",renderCell:a=>e.jsx(C,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:a.row.gradeAQty||0,onChange:r=>f({id:a.id,field:"gradeAQty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"gradeBQty",headerName:"Grade B",renderCell:a=>e.jsx(C,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:a.row.gradeBQty||0,onChange:r=>f({id:a.id,field:"gradeBQty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"gradeCPQty",headerName:"Cut Pc",renderCell:a=>e.jsx(C,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:a.row.gradeCPQty||0,onChange:r=>f({id:a.id,field:"gradeCPQty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"others1Qty",headerName:"Others",renderCell:a=>e.jsx(C,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:a.row.others1Qty||0,onChange:r=>f({id:a.id,field:"others1Qty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"shortageQty",headerName:"Short Stock",valueGetter:(a,r)=>{r.expectedQty,r.receivedQty;const j=r.receivedQty-((r.gradeAQty||0)+(r.gradeBQty||0)+(r.gradeCPQty||0)+(r.rejectedQty||0)+(r.others1Qty||0));return j>0?j.toLocaleString():0}},{field:"rejectedQty",headerName:"Rejected",renderCell:a=>e.jsx(C,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:a.row.rejectedQty||0,onChange:r=>f({id:a.id,field:"rejectedQty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"remarks",headerName:"Remarks",renderCell:a=>e.jsx(C,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:a.row.remarks||"",onKeyDown:r=>{console.log("Key down: ",r.key),r.stopPropagation()},onChange:r=>f({id:a.id,field:"remarks",value:r.target.value}),InputProps:{style:{fontSize:"0.875rem"}}})}],H=()=>{u.current.autosizeColumns({includeHeaders:!0,includeOutliers:!0})};J.useEffect(()=>{H()});const F=async()=>{for(let a of s)if(a.receivedQty<(a.gradeAQty||0)+(a.gradeBQty||0)+(a.gradeCPQty||0)+(a.others1Qty||0)){m("Error: Received quantity cannot be greater than issuance quantity!",{variant:"error",autoHideDuration:5e3});return}try{const a=await Re.post("http://100.42.177.77:83/api/Receiving/SaveInspection",p);a.data.success?m(`${a.data.message} !`,{variant:"success",autoHideDuration:5e3}):(m(`${a.data.message} !`,{variant:"error",autoHideDuration:5e3}),console.log("response.message",a.data.message)),x(),console.log("Save response:",a.data),D()}catch(a){console.error("Error saving data:",a),m("FAILED: Unable to start Process",{variant:"error",autoHideDuration:5e3})}};return e.jsxs("div",{children:[e.jsxs(o,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(g,{fullWidth:!0,disabled:!0,label:"IGP Number",name:"igpNumber",value:d.igpNumber,size:"small"})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(g,{fullWidth:!0,disabled:!0,label:"Process Type",name:"processTypename",value:d.processTypename,size:"small"})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(g,{fullWidth:!0,disabled:!0,label:"Vendor",name:"vendorId",value:d.vendorName,size:"small"})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(g,{size:"small",label:"IGP Creation Date ",name:"igpDate",value:new Date(d.igpDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"}),fullWidth:!0,disabled:!0,InputLabelProps:{shrink:!0,sx:{color:"black"}}})})]}),e.jsxs(o,{container:!0,spacing:2,width:"Inherit",children:[e.jsx(o,{item:!0,xs:12,children:e.jsx(A,{variant:"h2",children:"Details"})}),e.jsx(o,{item:!0,xs:12,children:e.jsx("div",{style:{height:400,width:"100%"},children:e.jsx(Pe,{rows:s,columns:S,apiRef:u,disableRowSelectionOnClick:!0})})}),e.jsx(o,{item:!0,xs:12,textAlign:"right",sx:{mt:2},children:e.jsx(me,{variant:"contained",size:"small",onClick:F,children:"Save"})})]})]})};ne(g)(({theme:d})=>({"& .MuiInputBase-input":{fontSize:"0.875rem",padding:"4px 6px"},width:"auto",height:"auto",minWidth:"100px",minHeight:"30px"}));const Te=({formData:d,handleClose:D,refetch:x})=>{ce(),M(),W();const[p,y]=i.useState([]),{data:u,refetch:m}=de({poId:d.poId,processTypename:"Dyeing",status:4},{skip:!d.poId});i.useEffect(()=>{if((u==null?void 0:u.result)===null){y([]);return}u&&y(u.result.map((s,n)=>({id:n+1,...s})))},[u,m]);const v=[{field:"id",headerName:"Sr #"},{field:"collectionName",headerName:"Collection Name"},{field:"poName",headerName:"PO"},{field:"igpNumber",headerName:"IGP Number"},{field:"igpDate",headerName:"IGP Date",valueGetter:s=>new Date(s).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"receivingDate",headerName:"Receiving Date",valueGetter:s=>new Date(s).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"receivedQty",headerName:"Received"},{field:"processTypename",headerName:"Process Type"},{field:"statusName",headerName:"Status",renderCell:s=>e.jsx(E,{label:s.value,status:s.value})},{field:"Actions",headerName:"Actions",renderCell:s=>e.jsx("div",{style:{display:"flex",justifyContent:"space-around"},children:e.jsx(ue,{variant:"text",size:"small",sx:{mt:1}})})}];return e.jsxs(le,{variant:"outlined",sx:{marginTop:2},children:[e.jsx(oe,{className:"css-4rfrnx-MuiCardHeader-root",title:"Completed Inspections",titleTypographyProps:{style:{color:"white"}}}),e.jsx(o,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:e.jsx(o,{item:!0,xs:12,children:e.jsx(O,{initialRows:p,iColumns:v,hideAction:!0})})})]})},Ve=()=>{var V,q,_;const d=Ce(),D=(V=d.state)==null?void 0:V.data,x=(_=(q=d.state)==null?void 0:q.tab)==null?void 0:_.toString();console.log("rowData",D),console.log("tab",x);const[p,y]=i.useState("1"),u=(t,c)=>{y(c),console.log("value",p)};i.useEffect(()=>{x&&y(x)},[x]),M();const{user:m}=W();i.useState([]);const[v,s]=i.useState(!1),[n,h]=i.useState({issuanceId:"",poId:"",productionId:"",appId:m.appId,createdOn:new Date().toISOString(),createdBy:m.empId,lastUpdatedOn:new Date().toISOString(),LastUpdatedBy:m.empId}),[G,f]=i.useState([]),{data:S,error:H,isLoading:F,refetch:a}=Se(n.productionId,{skip:!n.productionId}),{data:r,refetch:j}=be(),{data:b,refetch:P}=de({poId:n.poId,status:8,processTypename:"Dyeing"},{skip:!n.poId}),[l,w]=i.useState([]);i.useState(!1),console.log("initialRows",l);const[B,$]=i.useState([]);i.useEffect(()=>{b&&w(b.result.map((t,c)=>({id:c+1,...t})))},[b,P]),i.useEffect(()=>{r&&$(r.result.map((t,c)=>({id:c,...t})))},[r,j]),i.useEffect(()=>{S&&f(S.result.map((t,c)=>({id:c+1,...t})))},[S,a]);const U=t=>{const{name:c,value:L}=t.target;if(c==="poId"){const K=G.find(Ie=>Ie.poId===parseInt(L));h({...n,poId:L,issuanceId:K?K.issuanceId:""})}else h({...n,[c]:L})},[he,pe]=i.useState(!1),[k,fe]=i.useState({}),[ge,X]=i.useState({}),{data:I,refetch:xe}=Qe(k.receivingId,{skip:!k.receivingId});i.useEffect(()=>{if((I==null?void 0:I.result)===null){X([]);return}I&&X(I.result.map((t,c)=>({id:c+1,...t})))},[I,xe]);const ye=async t=>{fe(t),s(!0)},T=()=>{s(!1)},Y=()=>{pe(!1)},ve=[{field:"id",headerName:"Sr #"},{field:"collectionName",headerName:"Collection Name"},{field:"poName",headerName:"PO"},{field:"igpNumber",headerName:"IGP Number"},{field:"igpDate",headerName:"IGP Date",valueGetter:t=>new Date(t).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"receivingDate",headerName:"Receiving Date",valueGetter:t=>new Date(t).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"receivedQty",headerName:"Received",renderCell:t=>e.jsx(E,{label:t.row.receivedQty,status:"Received"})},{field:"processTypename",headerName:"Process Type"},{field:"statusName",headerName:"Status",renderCell:t=>e.jsx(E,{label:t.value,status:t.value})},{field:"Actions",headerName:"Actions",renderCell:t=>e.jsx("div",{style:{display:"flex",justifyContent:"space-around"},children:e.jsx(ue,{variant:"text",size:"small",sx:{mt:1},children:e.jsx(me,{size:"small",color:"primary",onClick:()=>ye(t.row),disabled:t.row.status===4,children:"Inspection"})})})}],je=[{field:"id",headerName:"Sr#"},{field:"designNo",headerName:"Design"},{field:"colorName",headerName:"Color"},{field:"fabricName",headerName:"Fabric"},{field:"issuanceQuantity",headerName:"Quantity Issued",valueGetter:t=>t.toLocaleString()},{field:"receivedQty",headerName:"Received",valueGetter:t=>t.toLocaleString()},{field:"gradeAQty",headerName:"Grade A",valueGetter:t=>t.toLocaleString()},{field:"gradeBQty",headerName:"Grade B",valueGetter:t=>t?t.toLocaleString():"0"},{field:"gradeCPQty",headerName:"Cut Pc",valueGetter:t=>t?t.toLocaleString():"0"},{field:"others1Qty",headerName:"Others",valueGetter:t=>t?t.toLocaleString():"0"},{field:"shortStock",headerName:"Short Stock",valueGetter:t=>t?t.toLocaleString():"0"},{field:"remarks",headerName:"Remarks"},{field:"statusName",headerName:"Status"}];return e.jsx(De,{style:{borderWidth:1,borderStyle:"dotted",borderColor:"#a11f23",width:"auto",maxHeight:{xs:"80vh",md:"auto"},overflow:"auto"},children:e.jsx(z,{sx:{width:"100%",typography:"body1"},children:e.jsxs(we,{value:p,children:[e.jsx(z,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Be,{onChange:u,children:[e.jsx(Q,{icon:e.jsx(Ge,{}),label:"Dyeing Inspection",value:"1",sx:t=>({"& .MuiTouchRipple-child":{backgroundColor:`${t.palette.primary.main} !important`}})}),e.jsx(Q,{icon:e.jsx(R,{}),label:"Embroidery Inspection",value:"2",sx:t=>({"& .MuiTouchRipple-child":{backgroundColor:`${t.palette.primary.main} !important`}})}),e.jsx(Q,{icon:e.jsx(R,{}),label:"Schiffili Inspection",value:"3",sx:t=>({"& .MuiTouchRipple-child":{backgroundColor:`${t.palette.primary.main} !important`}})}),e.jsx(Q,{icon:e.jsx(R,{}),label:"Additional Process Inspection",value:"4",sx:t=>({"& .MuiTouchRipple-child":{backgroundColor:`${t.palette.primary.main} !important`}})}),e.jsx(Q,{icon:e.jsx(R,{}),label:"Additional Services Inspection",value:"5",sx:t=>({"& .MuiTouchRipple-child":{backgroundColor:`${t.palette.primary.main} !important`}})})]})}),e.jsx(N,{value:"1",children:e.jsxs(z,{sx:{width:"100%",typography:"body1"},children:[e.jsxs(le,{variant:"outlined",children:[e.jsx(oe,{className:"css-4rfrnx-MuiCardHeader-root",title:"Pending Inspections",titleTypographyProps:{style:{color:"white"}}}),e.jsxs(o,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(g,{fullWidth:!0,select:!0,label:"Production",name:"productionId",value:n.productionId,onChange:U,size:"small",children:B.map(t=>e.jsx(se,{value:t.productionId,children:t.collectionName},t.productionId))})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(g,{fullWidth:!0,select:!0,label:"PO#",name:"poId",value:n.poId,onChange:U,size:"small",children:G.map(t=>e.jsx(se,{value:t.poId,children:t.poIdName},t.poId))})}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx(O,{initialRows:l,iColumns:ve,hideAction:!0}),e.jsxs(ee,{open:v,onClose:T,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(te,{sx:{backgroundColor:"#A11F23",color:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",paddingX:"24px",paddingY:"4px"},children:[e.jsx(A,{variant:"h4",component:"div",color:"#ffffff",gutterBottom:!0,fontSize:20,fontWeight:2,fontStyle:"normal",children:"Start Inspection"}),e.jsx(ie,{onClick:T,sx:{color:"#ffffff"},children:e.jsx(Z,{})})]}),e.jsxs(ae,{children:[e.jsx(re,{id:"alert-dialog-slide-description"}),e.jsx(ke,{rData:k,handleClose:T,refetch:P})]})]}),e.jsxs(ee,{open:he,onClose:Y,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(te,{sx:{backgroundColor:"#A11F23",color:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",paddingX:"24px",paddingY:"4px",mb:2.5},children:[e.jsx(A,{variant:"h4",component:"div",color:"#ffffff",gutterBottom:!0,fontSize:20,fontWeight:2,fontStyle:"normal",children:"View Inspection"}),e.jsx(ie,{onClick:Y,sx:{color:"#ffffff"},children:e.jsx(Z,{})})]}),e.jsxs(ae,{children:[e.jsx(re,{id:"alert-dialog-slide-description"}),e.jsx(O,{initialRows:ge,iColumns:je,hideAction:!0})]})]})]})]})]}),e.jsx(Te,{formData:n})]})}),e.jsx(N,{value:"2"}),e.jsx(N,{value:"3"}),e.jsx(N,{value:"4"}),e.jsx(N,{value:"5"}),e.jsx(N,{value:"6"})]})})})};export{Ve as default};
