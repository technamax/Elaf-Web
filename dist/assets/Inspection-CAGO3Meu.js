import{s as le,c as J,u as Z,a7 as ce,a8 as Se,j as e,G as l,T,a9 as Qe,C as ue,d as he,Q as Ne,N as be,n as De,aa as Pe,M as Ge,B as F}from"./index-k9GWQJOu.js";import{r as i,R as z}from"./vendor-BXCbSo2_.js";import{d as Re}from"./CategoryOutlined-MdM7JIJy.js";import{d as w}from"./AssignmentOutlined-DQJc0R_Q.js";import{d as $}from"./Close-CwC_dym4.js";import"./ReceivingDetails-DOjPavAN.js";import{u as me,D as ke,R as U,a as V,b as X,c as Y,d as q,B as pe}from"./ReuseableDataGrid-D6KGNruf.js";import{S as _}from"./StatusChip-DQNIzaKK.js";import{B as A,a as Be,I as K}from"./axios-CaswPiu6.js";import{T as I}from"./TextField-Bw61L3Ab.js";import we from"./Reports-BgemgIcq.js";import{T as Te,a as ze,b as G,c as N}from"./TabPanel-CYIvsX5V.js";import{M as oe}from"./MenuItem-BJ2KxKJk.js";import"./Skeleton-C1-xTFDk.js";const b=le(I)(({theme:n})=>({"& .MuiInputBase-input":{fontSize:"0.875rem",padding:"4px 6px"},width:"auto",height:"auto",minWidth:"100px",minHeight:"30px"})),Ae=({rData:n,handleClose:R,refetch:v})=>{const[h,m]=i.useState({inspectionId:0,...n}),S=me(),{enqueueSnackbar:g}=J(),{user:j}=Z(),[p,d]=i.useState([]),{data:D,refetch:C}=ce({poId:h.poId,processTypename:"Dyeing",status:4},{skip:!h.poId}),{data:x,refetch:s}=Se(n.receivingId,{skip:!n.receivingId});i.useEffect(()=>{if((x==null?void 0:x.result)===null){d([]);return}x&&d(x.result.map((a,r)=>({id:r+1,...a,gradeAQty:0,gradeBQty:0,gradeCPQty:0,others1Qty:0,rejectedQty:0,remarks:""})))},[x,s]),console.log("rData",n);const f=a=>{const{id:r,field:o,value:k}=a;console.log("Editing cell:",a),d(O=>O.map(c=>{if(c.id===r){const E=(c.issuanceQuantity*100/(100+c.shrinkage+c.wastage)).toFixed(2),B=Math.max(c.receivedQty-((c.gradeAQty||0)+(c.gradeBQty||0)+(c.gradeCPQty||0)+(c.rejectedQty||0)+(c.others1Qty||0)),0),y={...c,[o]:k,inspectionId:0,inspectiondetId:0,expectedQty:Number(E),shortageQty:B,appId:j.appId,createdOn:new Date().toISOString(),createdBy:j.empId,lastUpdatedOn:new Date().toISOString(),lastUpdatedBy:j.empId};return(o==="gradeAQty"||o==="gradeBQty"||o==="gradeCPQty"||o==="rejectedQty"||o==="others1Qty")&&(y.shortageQty=Math.max(y.receivedQty-((y.gradeAQty||0)+(y.gradeBQty||0)+(y.gradeCPQty||0)+(y.rejectedQty||0)+(y.others1Qty||0)),0)),y}return c}))};z.useEffect(()=>{m({...h,inspectionTransactionsDetailsModelList:p})},[p,d]),console.log("formData",h),console.log("receiveDetails",p);const ee=[{field:"id",headerName:"Sr#"},{field:"designNo",headerName:"Design"},{field:"colorName",headerName:"Color"},{field:"fabricName",headerName:"Fabric"},{field:"issuanceQuantity",headerName:"Quantity Issued",valueGetter:a=>a?a.toLocaleString():"0"},{field:"receivedQty",headerName:"Received",valueGetter:a=>a?a.toLocaleString():"0"},{field:"expectedQty",headerName:"Expected",valueGetter:(a,r)=>(r.issuanceQuantity*100/(100+r.shrinkage+r.wastage)).toLocaleString()},{field:"recA",headerName:"Rec. GradeA",valueGetter:a=>a?a.toLocaleString():"0"},{field:"recB",headerName:"Rec. GradeB ",valueGetter:a=>a?a.toLocaleString():"0"},{field:"recCp",headerName:"Rec. GradeCP",valueGetter:a=>a?a.toLocaleString():"0"},{field:"recOthers1",headerName:"Rec. Others",valueGetter:a=>a?a.toLocaleString():"0"},{field:"gradeAQty",headerName:"Grade A",renderCell:a=>e.jsx(b,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:a.row.gradeAQty||0,onChange:r=>f({id:a.id,field:"gradeAQty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"gradeBQty",headerName:"Grade B",renderCell:a=>e.jsx(b,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:a.row.gradeBQty||0,onChange:r=>f({id:a.id,field:"gradeBQty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"gradeCPQty",headerName:"Cut Pc",renderCell:a=>e.jsx(b,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:a.row.gradeCPQty||0,onChange:r=>f({id:a.id,field:"gradeCPQty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"others1Qty",headerName:"Others",renderCell:a=>e.jsx(b,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:a.row.others1Qty||0,onChange:r=>f({id:a.id,field:"others1Qty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"shortageQty",headerName:"Short Stock",valueGetter:(a,r)=>{r.expectedQty,r.receivedQty;const o=r.receivedQty-((r.gradeAQty||0)+(r.gradeBQty||0)+(r.gradeCPQty||0)+(r.rejectedQty||0)+(r.others1Qty||0));return o>0?o.toLocaleString():0},valueSetter:(a,r)=>{r.expectedQty,r.receivedQty;const o=r.receivedQty-((r.gradeAQty||0)+(r.gradeBQty||0)+(r.gradeCPQty||0)+(r.rejectedQty||0)+(r.others1Qty||0));return o>0?o.toLocaleString():0}},{field:"rejectedQty",headerName:"Rejected",renderCell:a=>e.jsx(b,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:a.row.rejectedQty||0,onChange:r=>f({id:a.id,field:"rejectedQty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"remarks",headerName:"Remarks",renderCell:a=>e.jsx(b,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:a.row.remarks||"",onKeyDown:r=>{console.log("Key down: ",r.key),r.stopPropagation()},onChange:r=>f({id:a.id,field:"remarks",value:r.target.value}),InputProps:{style:{fontSize:"0.875rem"}}})}],L=()=>{S.current.autosizeColumns({includeHeaders:!0,includeOutliers:!0})};z.useEffect(()=>{L()});const P=async()=>{for(let a of p)if(a.receivedQty<(a.gradeAQty||0)+(a.gradeBQty||0)+(a.gradeCPQty||0)+(a.rejectedQty||0)+(a.others1Qty||0)){g("Error: Received quantity cannot be greater than issuance quantity!",{variant:"error",autoHideDuration:5e3});return}try{const a=await Be.post("http://100.42.177.77:8091/api/Receiving/SaveInspection",h);a.data.success?g(`${a.data.message} !`,{variant:"success",autoHideDuration:5e3}):(g(`${a.data.message} !`,{variant:"error",autoHideDuration:5e3}),console.log("response.message",a.data.message)),v(),C(),console.log("Save response:",a.data),R()}catch(a){console.error("Error saving data:",a),g("FAILED: Unable to start Process",{variant:"error",autoHideDuration:5e3})}};return e.jsxs("div",{children:[e.jsxs(l,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(I,{fullWidth:!0,disabled:!0,label:"IGP Number",name:"igpNumber",value:n.igpNumber,size:"small"})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(I,{fullWidth:!0,disabled:!0,label:"Process Type",name:"processTypename",value:n.processTypename,size:"small"})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(I,{fullWidth:!0,disabled:!0,label:"Vendor",name:"vendorId",value:n.vendorName,size:"small"})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(I,{size:"small",label:"IGP Creation Date ",name:"igpDate",value:new Date(n.igpDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"}),fullWidth:!0,disabled:!0,InputLabelProps:{shrink:!0,sx:{color:"black"}}})})]}),e.jsxs(l,{container:!0,spacing:2,width:"Inherit",children:[e.jsx(l,{item:!0,xs:12,children:e.jsx(T,{variant:"h2",children:"Details"})}),e.jsx(l,{item:!0,xs:12,children:e.jsx("div",{style:{height:400,width:"100%"},children:e.jsx(ke,{rows:p,columns:ee,apiRef:S,disableRowSelectionOnClick:!0})})}),e.jsx(l,{item:!0,xs:12,textAlign:"right",sx:{mt:2},children:e.jsx(A,{variant:"contained",size:"small",onClick:P,children:"Save"})})]})]})};le(I)(({theme:n})=>({"& .MuiInputBase-input":{fontSize:"0.875rem",padding:"4px 6px"},width:"auto",height:"auto",minWidth:"100px",minHeight:"30px"}));const Le=({formData:n,refetch:R})=>{me(),J(),Z();const[v,h]=i.useState([]),{data:m,refetch:S}=Qe(n.poId,{skip:!n.poId});i.useEffect(()=>{if((m==null?void 0:m.result)===null){h([]);return}m&&h(m.result.map((s,f)=>({id:f+1,...s})))},[m,S]);const[g,j]=z.useState(!1),[p,d]=z.useState(!1),D=async s=>{d(s),j(!0)},C=()=>{j(!1)};console.log("iss",p);const x=[{field:"id",headerName:"Sr #"},{field:"collectionName",headerName:"Collection Name"},{field:"poName",headerName:"PO"},{field:"igpNumber",headerName:"IGP Number"},{field:"igpDate",headerName:"IGP Date",valueGetter:s=>new Date(s).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"receivingDate",headerName:"Receiving Date",valueGetter:s=>new Date(s).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"receivedQty",headerName:"Received"},{field:"processTypename",headerName:"Process Type"},{field:"statusName",headerName:"Status",renderCell:s=>e.jsx(_,{label:s.value,status:s.value})},{field:"Actions",headerName:"Actions",renderCell:s=>e.jsx("div",{style:{display:"flex",justifyContent:"space-around"},children:e.jsx(pe,{variant:"text",size:"small",sx:{mt:1},children:e.jsx(A,{size:"small",color:"primary",onClick:()=>D(s.row),children:"Inspection"})})})}];return e.jsxs(ue,{variant:"outlined",sx:{marginTop:2},children:[e.jsx(he,{className:"css-4rfrnx-MuiCardHeader-root",title:"Completed Inspections",titleTypographyProps:{style:{color:"white"}}}),e.jsx(l,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:e.jsxs(l,{item:!0,xs:12,children:[e.jsx(U,{initialRows:v,iColumns:x,hideAction:!0}),e.jsxs(V,{open:g,onClose:C,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(X,{sx:{backgroundColor:"#A11F23",color:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",paddingX:"24px",paddingY:"4px",mb:2.5},children:[e.jsx(T,{variant:"h4",component:"div",color:"#ffffff",gutterBottom:!0,fontSize:20,fontWeight:2,fontStyle:"normal",children:"Inspection"}),e.jsx(K,{onClick:C,sx:{color:"#ffffff"},children:e.jsx($,{})})]}),e.jsxs(Y,{children:[e.jsx(q,{id:"alert-dialog-slide-description"}),e.jsx(we,{rId:17,inspection:{ParamInspectionId:p.inspectionId}})]})]})]})})]})},Je=()=>{var ie,se,ne;const n=Ne(),R=(ie=n.state)==null?void 0:ie.data,v=(ne=(se=n.state)==null?void 0:se.tab)==null?void 0:ne.toString();console.log("rowData",R),console.log("tab",v);const[h,m]=i.useState("1"),S=(t,u)=>{m(u),console.log("value",h)};i.useEffect(()=>{v&&m(v)},[v]),J();const{user:g}=Z();i.useState([]);const[j,p]=i.useState(!1),[d,D]=i.useState({issuanceId:"",poId:"",productionId:"",appId:g.appId,createdOn:new Date().toISOString(),createdBy:g.empId,lastUpdatedOn:new Date().toISOString(),LastUpdatedBy:g.empId}),[C,x]=i.useState([]),{data:s,error:f,isLoading:ee,refetch:L}=be(d.productionId,{skip:!d.productionId}),{data:P,refetch:a}=De(),{data:r,refetch:o}=ce({poId:d.poId,status:8,processTypename:"Dyeing"},{skip:!d.poId}),[k,O]=i.useState([]);i.useState(!1),console.log("initialRows",k);const[c,E]=i.useState([]);i.useEffect(()=>{r&&O(r.result.map((t,u)=>({id:u+1,...t})))},[r,o]),i.useEffect(()=>{P&&E(P.result.map((t,u)=>({id:u,...t})))},[P,a]),i.useEffect(()=>{s&&x(s.result.map((t,u)=>({id:u+1,...t})))},[s,L]);const B=t=>{const{name:u,value:H}=t.target;if(u==="poId"){const de=C.find(Ce=>Ce.poId===parseInt(H));D({...d,poId:H,issuanceId:de?de.issuanceId:""})}else D({...d,[u]:H})},[y,fe]=i.useState(!1),[W,te]=i.useState({}),[ge,ae]=i.useState({}),{data:Q,refetch:xe}=Pe(W.receivingId,{skip:!W.receivingId});i.useEffect(()=>{if((Q==null?void 0:Q.result)===null){ae([]);return}Q&&ae(Q.result.map((t,u)=>({id:u+1,...t})))},[Q,xe]);const ye=async t=>{te(t),p(!0)},ve=async t=>{te(t)},M=()=>{p(!1)},re=()=>{fe(!1)},je=[{field:"id",headerName:"Sr #"},{field:"collectionName",headerName:"Collection Name"},{field:"poName",headerName:"PO"},{field:"igpNumber",headerName:"IGP Number"},{field:"igpDate",headerName:"IGP Date",valueGetter:t=>new Date(t).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"receivingDate",headerName:"Receiving Date",valueGetter:t=>new Date(t).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"receivedQty",headerName:"Received",renderCell:t=>e.jsx(_,{label:t.row.receivedQty,status:"Received"})},{field:"processTypename",headerName:"Process Type"},{field:"statusName",headerName:"Status",renderCell:t=>e.jsx(_,{label:t.value,status:t.value})},{field:"Actions",headerName:"Actions",renderCell:t=>e.jsx("div",{style:{display:"flex",justifyContent:"space-around"},children:e.jsxs(pe,{variant:"text",size:"small",sx:{mt:1},children:[e.jsx(A,{size:"small",color:"primary",onClick:()=>ye(t.row),disabled:t.row.status===4,children:"Inspection"}),e.jsx(A,{size:"small",color:"primary",onClick:()=>ve(t.row),children:"View"})]})})}],Ie=[{field:"id",headerName:"Sr#"},{field:"designNo",headerName:"Design"},{field:"colorName",headerName:"Color"},{field:"fabricName",headerName:"Fabric"},{field:"issuanceQuantity",headerName:"Quantity Issued",valueGetter:t=>t.toLocaleString()},{field:"receivedQty",headerName:"Received",valueGetter:t=>t.toLocaleString()},{field:"gradeAQty",headerName:"Grade A",valueGetter:t=>t.toLocaleString()},{field:"gradeBQty",headerName:"Grade B",valueGetter:t=>t?t.toLocaleString():"0"},{field:"gradeCPQty",headerName:"Cut Pc",valueGetter:t=>t?t.toLocaleString():"0"},{field:"others1Qty",headerName:"Others",valueGetter:t=>t?t.toLocaleString():"0"},{field:"shortStock",headerName:"Short Stock",valueGetter:t=>t?t.toLocaleString():"0"},{field:"remarks",headerName:"Remarks"},{field:"statusName",headerName:"Status"}];return e.jsx(Ge,{style:{borderWidth:1,borderStyle:"dotted",borderColor:"#a11f23",width:"auto",maxHeight:{xs:"80vh",md:"auto"},overflow:"auto"},children:e.jsx(F,{sx:{width:"100%",typography:"body1"},children:e.jsxs(Te,{value:h,children:[e.jsx(F,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(ze,{onChange:S,children:[e.jsx(G,{icon:e.jsx(Re,{}),label:"Dyeing Inspection",value:"1",sx:t=>({"& .MuiTouchRipple-child":{backgroundColor:`${t.palette.primary.main} !important`}})}),e.jsx(G,{icon:e.jsx(w,{}),label:"Embroidery Inspection",value:"2",sx:t=>({"& .MuiTouchRipple-child":{backgroundColor:`${t.palette.primary.main} !important`}})}),e.jsx(G,{icon:e.jsx(w,{}),label:"Schiffili Inspection",value:"3",sx:t=>({"& .MuiTouchRipple-child":{backgroundColor:`${t.palette.primary.main} !important`}})}),e.jsx(G,{icon:e.jsx(w,{}),label:"Additional Process Inspection",value:"4",sx:t=>({"& .MuiTouchRipple-child":{backgroundColor:`${t.palette.primary.main} !important`}})}),e.jsx(G,{icon:e.jsx(w,{}),label:"Additional Services Inspection",value:"5",sx:t=>({"& .MuiTouchRipple-child":{backgroundColor:`${t.palette.primary.main} !important`}})})]})}),e.jsx(N,{value:"1",children:e.jsxs(F,{sx:{width:"100%",typography:"body1"},children:[e.jsxs(ue,{variant:"outlined",children:[e.jsx(he,{className:"css-4rfrnx-MuiCardHeader-root",title:"Pending Inspections",titleTypographyProps:{style:{color:"white"}}}),e.jsxs(l,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(I,{fullWidth:!0,select:!0,label:"Production",name:"productionId",value:d.productionId,onChange:B,size:"small",children:c.map(t=>e.jsx(oe,{value:t.productionId,children:t.collectionName},t.productionId))})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(I,{fullWidth:!0,select:!0,label:"PO#",name:"poId",value:d.poId,onChange:B,size:"small",children:C.map(t=>e.jsx(oe,{value:t.poId,children:t.poIdName},t.poId))})}),e.jsxs(l,{item:!0,xs:12,children:[e.jsx(U,{initialRows:k,iColumns:je,height:!0,hideAction:!0}),e.jsxs(V,{open:j,onClose:M,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(X,{sx:{backgroundColor:"#A11F23",color:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",paddingX:"24px",paddingY:"4px"},children:[e.jsx(T,{variant:"h4",component:"div",color:"#ffffff",gutterBottom:!0,fontSize:20,fontWeight:2,fontStyle:"normal",children:"Start Inspection"}),e.jsx(K,{onClick:M,sx:{color:"#ffffff"},children:e.jsx($,{})})]}),e.jsxs(Y,{children:[e.jsx(q,{id:"alert-dialog-slide-description"}),e.jsx(Ae,{rData:W,handleClose:M,refetch:o})]})]}),e.jsxs(V,{open:y,onClose:re,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(X,{sx:{backgroundColor:"#A11F23",color:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",paddingX:"24px",paddingY:"4px",mb:2.5},children:[e.jsx(T,{variant:"h4",component:"div",color:"#ffffff",gutterBottom:!0,fontSize:20,fontWeight:2,fontStyle:"normal",children:"View Inspection"}),e.jsx(K,{onClick:re,sx:{color:"#ffffff"},children:e.jsx($,{})})]}),e.jsxs(Y,{children:[e.jsx(q,{id:"alert-dialog-slide-description"}),e.jsx(U,{initialRows:ge,iColumns:Ie,hideAction:!0})]})]})]})]})]}),e.jsx(Le,{formData:d})]})}),e.jsx(N,{value:"2"}),e.jsx(N,{value:"3"}),e.jsx(N,{value:"4"}),e.jsx(N,{value:"5"}),e.jsx(N,{value:"6"})]})})})};export{Je as default};
