import{s as he,c as ie,u as se,K as me,j as e,G as l,T as M,L as pe,N as fe,O as ge,M as xe,B as W,C as ye,d as ve,e as je}from"./index-BQnKJm_U.js";import{r as s,R as Y}from"./vendor-BXCbSo2_.js";import{B,a as ne,I as _}from"./axios-CIHeZEXI.js";import{d as be}from"./CategoryOutlined-Bcv7mrwf.js";import{d as P}from"./AssignmentOutlined-CvXohB2J.js";import{d as J}from"./Close-BQnbGXeb.js";import"./ReceivingDetails-COipxSuI.js";import{u as Ie,D as Ce,R as Z,a as ee,b as te,c as ae,d as re,B as Se}from"./ReuseableDataGrid-DM_ExMFu.js";import{T as g}from"./TextField-B9bDqCXW.js";import{T as Ne,a as Qe,b as S,c as j}from"./TabPanel-eD93EyWL.js";import{M as De}from"./MenuItem-CqoynPPu.js";import"./Skeleton-B93ZyZJN.js";const b=he(g)(({theme:d})=>({"& .MuiInputBase-input":{fontSize:"0.875rem",padding:"4px 6px"},width:"auto",height:"auto",minWidth:"100px",minHeight:"30px"})),Ge=({rData:d,handleClose:z,refetch:x})=>{const[y,N]=s.useState({inspectionId:0,...d}),Q=Ie(),{enqueueSnackbar:u}=ie(),{user:h}=se(),[m,p]=s.useState([]),{data:o,refetch:D}=me(d.receivingId,{skip:!d.receivingId});s.useEffect(()=>{if((o==null?void 0:o.result)===null){p([]);return}o&&p(o.result.map((a,r)=>({id:r+1,...a})))},[o,D]),console.log("rData",d);const c=a=>{const{id:r,field:f,value:A}=a;console.log("Editing cell:",a),p(G=>G.map(i=>{if(i.id===r){const T=(i.issuanceQuantity*100/(100+i.shrinkage+i.wastage)).toFixed(2),k=Math.max(i.receivedQty-((i.gradeAQty||0)+(i.gradeBQty||0)+(i.gradeCPQty||0)+(i.rejectedQty||0)+(i.others1Qty||0)),0);return{...i,[f]:A,inspectionId:0,inspectiondetId:0,expectedQty:Number(T),shortageQty:Number(k),appId:h.appId,createdOn:new Date().toISOString(),createdBy:h.empId,lastUpdatedOn:new Date().toISOString(),lastUpdatedBy:h.empId}}return i}))};Y.useEffect(()=>{N({...y,inspectionTransactionsDetailsModelList:m})},[m,p]),console.log("formData",y),console.log("receiveDetails",m);const L=[{field:"id",headerName:"Sr#"},{field:"designNo",headerName:"Design"},{field:"colorName",headerName:"Color"},{field:"fabricName",headerName:"Fabric"},{field:"issuanceQuantity",headerName:"Quantity Issued",valueGetter:a=>a?a.toLocaleString():"0"},{field:"receivedQty",headerName:"Received",valueGetter:a=>a?a.toLocaleString():"0"},{field:"expectedQty",headerName:"Expected",valueGetter:(a,r)=>(r.issuanceQuantity*100/(100+r.shrinkage+r.wastage)).toLocaleString()},{field:"recA",headerName:"Rec. GradeA",valueGetter:a=>a?a.toLocaleString():"0"},{field:"recB",headerName:"Rec. GradeB ",valueGetter:a=>a?a.toLocaleString():"0"},{field:"recCp",headerName:"Rec. GradeCP",valueGetter:a=>a?a.toLocaleString():"0"},{field:"recOthers1",headerName:"Rec. Others",valueGetter:a=>a?a.toLocaleString():"0"},{field:"gradeAQty",headerName:"Grade A",renderCell:a=>e.jsx(b,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:a.row.gradeAQty||0,onChange:r=>c({id:a.id,field:"gradeAQty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"gradeBQty",headerName:"Grade B",renderCell:a=>e.jsx(b,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:a.row.gradeBQty||0,onChange:r=>c({id:a.id,field:"gradeBQty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"gradeCPQty",headerName:"Cut Pc",renderCell:a=>e.jsx(b,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:a.row.gradeCPQty||0,onChange:r=>c({id:a.id,field:"gradeCPQty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"others1Qty",headerName:"Others",renderCell:a=>e.jsx(b,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:a.row.others1Qty||0,onChange:r=>c({id:a.id,field:"others1Qty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"shortageQty",headerName:"Short Stock",valueGetter:(a,r)=>{r.expectedQty,r.receivedQty;const f=r.receivedQty-((r.gradeAQty||0)+(r.gradeBQty||0)+(r.gradeCPQty||0)+(r.rejectedQty||0)+(r.others1Qty||0));return f>0?f.toLocaleString():0}},{field:"rejectedQty",headerName:"Rejected",renderCell:a=>e.jsx(b,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:a.row.rejectedQty||0,onChange:r=>c({id:a.id,field:"rejectedQty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"remarks",headerName:"Remarks",renderCell:a=>e.jsx(b,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:a.row.remarks||"",onKeyDown:r=>{console.log("Key down: ",r.key),r.stopPropagation()},onChange:r=>c({id:a.id,field:"remarks",value:r.target.value}),InputProps:{style:{fontSize:"0.875rem"}}})}],I=()=>{Q.current.autosizeColumns({includeHeaders:!0,includeOutliers:!0})};Y.useEffect(()=>{I()});const F=async()=>{for(let a of m)if(a.receivedQty<(a.gradeAQty||0)+(a.gradeBQty||0)+(a.gradeCPQty||0)+(a.others1Qty||0)){u("Error: Received quantity cannot be greater than issuance quantity!",{variant:"error",autoHideDuration:5e3});return}try{const a=await ne.post("http://100.42.177.77:83/api/Receiving/SaveInspection",y);a.data.success?u(`${a.data.message} !`,{variant:"success",autoHideDuration:5e3}):(u(`${a.data.message} !`,{variant:"error",autoHideDuration:5e3}),console.log("response.message",a.data.message)),x(),console.log("Save response:",a.data),z()}catch(a){console.error("Error saving data:",a),u("FAILED: Unable to start Process",{variant:"error",autoHideDuration:5e3})}};return e.jsxs("div",{children:[e.jsxs(l,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(g,{fullWidth:!0,disabled:!0,label:"IGP Number",name:"igpNumber",value:d.igpNumber,size:"small"})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(g,{fullWidth:!0,disabled:!0,label:"Process Type",name:"processTypename",value:d.processTypename,size:"small"})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(g,{fullWidth:!0,disabled:!0,label:"Vendor",name:"vendorId",value:d.vendorName,size:"small"})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(g,{size:"small",label:"IGP Creation Date ",name:"igpDate",value:new Date(d.igpDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"}),fullWidth:!0,disabled:!0,InputLabelProps:{shrink:!0,sx:{color:"black"}}})})]}),e.jsxs(l,{container:!0,spacing:2,width:"Inherit",children:[e.jsx(l,{item:!0,xs:12,children:e.jsx(M,{variant:"h2",children:"Details"})}),e.jsx(l,{item:!0,xs:12,children:e.jsx("div",{style:{height:400,width:"100%"},children:e.jsx(Ce,{rows:m,columns:L,apiRef:Q,disableRowSelectionOnClick:!0})})}),e.jsx(l,{item:!0,xs:12,textAlign:"right",sx:{mt:2},children:e.jsx(B,{variant:"contained",size:"small",onClick:F,children:"Save"})})]})]})},Me=()=>{var K,V,X;const d=pe(),z=(K=d.state)==null?void 0:K.data,x=(X=(V=d.state)==null?void 0:V.tab)==null?void 0:X.toString();console.log("rowData",z),console.log("tab",x);const[y,N]=s.useState("1"),Q=(t,n)=>{N(n),console.log("value",y)};s.useEffect(()=>{x&&N(x)},[x]);const{enqueueSnackbar:u}=ie(),{user:h}=se();s.useState([]);const[m,p]=s.useState(!1),[o,D]=s.useState({issuanceId:"",poId:"",appId:h.appId,createdOn:new Date().toISOString(),createdBy:h.empId,lastUpdatedOn:new Date().toISOString(),LastUpdatedBy:h.empId}),[c,L]=s.useState([]),{data:I,error:F,isLoading:a,refetch:r}=fe(),[f,A]=s.useState([]);s.useState(!1),console.log("initialRows",f),s.useEffect(()=>{I&&L(I.result.map((t,n)=>({id:n+1,...t})))},[I,r]);const G=t=>{const{name:n,value:C}=t.target;if(n==="poId"){const w=c.find(E=>E.poId===parseInt(C));D({...o,poId:C,issuanceId:w?w.issuanceId:""})}else D({...o,[n]:C})},i=async()=>{if(o.issuanceId)try{const t=await ne.get("http://100.42.177.77:83/api/Receiving/GetReceivingHeader",{params:{issuanceId:o.issuanceId,processTypename:"Dyeing"}});console.log("API response:",t.data);const n=t.data.result;if(Array.isArray(n)){const C=n.map((w,E)=>({...w,id:E+1}));A(C),u("Data fetched successfully!",{variant:"success"})}else throw new Error("Unexpected data format")}catch(t){console.error("Error fetching data:",t),u("Failed to fetch data!",{variant:"error"})}else u("Please enter an issuance ID!",{variant:"warning"})},[T,k]=s.useState(!1),[R,H]=s.useState({}),[le,$]=s.useState({}),{data:v,refetch:U}=ge(R.receivingId,{skip:!R.receivingId});s.useEffect(()=>{if((v==null?void 0:v.result)===null){$([]);return}v&&$(v.result.map((t,n)=>({id:n+1,...t})))},[v,U]);const oe=async t=>{H(t),p(!0)},O=()=>{p(!1)},de=async t=>{k(!0),H(t),U()},q=()=>{k(!1)},ce=[{field:"id",headerName:"Sr #"},{field:"collectionName",headerName:"Collection Name"},{field:"poName",headerName:"PO"},{field:"ogpNumber",headerName:"OGP Number",renderCell:t=>{t.value}},{field:"igpNumber",headerName:"IGP Number"},{field:"igpDate",headerName:"IGP Date",valueGetter:t=>new Date(t).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"receivingDate",headerName:"Receiving Date",valueGetter:t=>new Date(t).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"receivedQty",headerName:"Received"},{field:"processTypename",headerName:"Process Type"},{field:"statusName",headerName:"Status",renderCell:t=>{const n="primary.dark";if(t.value!==null)return e.jsx(je,{label:t.value,sx:{backgroundColor:n,color:"white"},color:void 0})}},{field:"Actions",headerName:"Actions",renderCell:t=>e.jsx("div",{style:{display:"flex",justifyContent:"space-around"},children:e.jsxs(Se,{variant:"text",size:"small",sx:{mt:1},children:[e.jsx(B,{size:"small",color:"primary",onClick:()=>oe(t.row),disabled:t.row.status===4,children:"Inspection"}),e.jsx(B,{size:"small",color:"primary",onClick:()=>de(t.row),children:"View"})]})})}],ue=[{field:"id",headerName:"Sr#"},{field:"designNo",headerName:"Design"},{field:"colorName",headerName:"Color"},{field:"fabricName",headerName:"Fabric"},{field:"issuanceQuantity",headerName:"Quantity Issued",valueGetter:t=>t.toLocaleString()},{field:"receivedQty",headerName:"Received",valueGetter:t=>t.toLocaleString()},{field:"gradeAQty",headerName:"Grade A",valueGetter:t=>t.toLocaleString()},{field:"gradeBQty",headerName:"Grade B",valueGetter:t=>t?t.toLocaleString():"0"},{field:"gradeCPQty",headerName:"Cut Pc",valueGetter:t=>t?t.toLocaleString():"0"},{field:"others1Qty",headerName:"Others",valueGetter:t=>t?t.toLocaleString():"0"},{field:"shortStock",headerName:"Short Stock",valueGetter:t=>t?t.toLocaleString():"0"},{field:"remarks",headerName:"Remarks"},{field:"statusName",headerName:"Status"}];return e.jsx(xe,{style:{borderWidth:1,borderStyle:"dotted",borderColor:"#a11f23",width:"auto",maxHeight:{xs:"80vh",md:"auto"},overflow:"auto"},children:e.jsx(W,{sx:{width:"100%",typography:"body1"},children:e.jsxs(Ne,{value:y,children:[e.jsx(W,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Qe,{onChange:Q,children:[e.jsx(S,{icon:e.jsx(be,{}),label:"Dyeing Inspection",value:"1",sx:t=>({"& .MuiTouchRipple-child":{backgroundColor:`${t.palette.primary.main} !important`}})}),e.jsx(S,{icon:e.jsx(P,{}),label:"Embroidery Inspection",value:"2",sx:t=>({"& .MuiTouchRipple-child":{backgroundColor:`${t.palette.primary.main} !important`}})}),e.jsx(S,{icon:e.jsx(P,{}),label:"Schiffili Inspection",value:"3",sx:t=>({"& .MuiTouchRipple-child":{backgroundColor:`${t.palette.primary.main} !important`}})}),e.jsx(S,{icon:e.jsx(P,{}),label:"Additional Process Inspection",value:"4",sx:t=>({"& .MuiTouchRipple-child":{backgroundColor:`${t.palette.primary.main} !important`}})}),e.jsx(S,{icon:e.jsx(P,{}),label:"Additional Services Inspection",value:"5",sx:t=>({"& .MuiTouchRipple-child":{backgroundColor:`${t.palette.primary.main} !important`}})})]})}),e.jsx(j,{value:"1",children:e.jsx(W,{sx:{width:"100%",typography:"body1"},children:e.jsxs(ye,{variant:"outlined",children:[e.jsx(ve,{className:"css-4rfrnx-MuiCardHeader-root",title:"Inspection",titleTypographyProps:{style:{color:"white"}}}),e.jsxs(l,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(g,{fullWidth:!0,select:!0,label:"PO#",name:"poId",value:o.poId,onChange:G,size:"small",children:c.map(t=>e.jsx(De,{value:t.poId,children:t.poName},t.poId))})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(g,{label:"Enter Issuance Number",type:"number",fullWidth:!0,size:"small",name:"issuanceId",onChange:G,onKeyDown:t=>{t.key==="Enter"&&i()},value:o.issuanceId,required:!0})}),e.jsx(l,{item:!0,xs:12,md:3,sx:{mt:.5},children:e.jsx(B,{variant:"contained",size:"small",onClick:i,children:"Search"})}),e.jsxs(l,{item:!0,xs:12,children:[e.jsx(Z,{initialRows:f,iColumns:ce,hideAction:!0}),e.jsxs(ee,{open:m,onClose:O,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(te,{sx:{backgroundColor:"#A11F23",color:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",paddingX:"24px",paddingY:"4px"},children:[e.jsx(M,{variant:"h4",component:"div",color:"#ffffff",gutterBottom:!0,fontSize:20,fontWeight:2,fontStyle:"normal",children:"Start Inspection"}),e.jsx(_,{onClick:O,sx:{color:"#ffffff"},children:e.jsx(J,{})})]}),e.jsxs(ae,{children:[e.jsx(re,{id:"alert-dialog-slide-description"}),e.jsx(Ge,{rData:R,handleClose:O,refetch:i})]})]}),e.jsxs(ee,{open:T,onClose:q,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(te,{sx:{backgroundColor:"#A11F23",color:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",paddingX:"24px",paddingY:"4px",mb:2.5},children:[e.jsx(M,{variant:"h4",component:"div",color:"#ffffff",gutterBottom:!0,fontSize:20,fontWeight:2,fontStyle:"normal",children:"View Inspection"}),e.jsx(_,{onClick:q,sx:{color:"#ffffff"},children:e.jsx(J,{})})]}),e.jsxs(ae,{children:[e.jsx(re,{id:"alert-dialog-slide-description"}),e.jsx(Z,{initialRows:le,iColumns:ue,hideAction:!0})]})]})]})]})]})})}),e.jsx(j,{value:"2"}),e.jsx(j,{value:"3"}),e.jsx(j,{value:"4"}),e.jsx(j,{value:"5"}),e.jsx(j,{value:"6"})]})})})};export{Me as default};
