import{u as ue,c as ce,af as he,b as Ue,j as e,G as o,T as Z,s as _e,S as Xe,ag as Ye,ah as we,ai as Je,aj as Ke,ak as Ze,al as et,am as tt,B as P,C as le,d as oe,D as st,M as me,L as at}from"./index-BQnKJm_U.js";import{r as i,R as de}from"./vendor-BXCbSo2_.js";import{d as fe}from"./CategoryOutlined-Bcv7mrwf.js";import{d as G}from"./AssignmentOutlined-CvXohB2J.js";import{I as pe,B as ee,a as nt}from"./axios-CIHeZEXI.js";import{d as xe}from"./Close-BQnbGXeb.js";import{d as it}from"./VisibilityOutlined-DhBBgDuL.js";import{R as ge,a as Ie,b as ye,c as be,d as je,B as ve,u as rt,D as lt}from"./ReuseableDataGrid-DM_ExMFu.js";import{D as ot}from"./DyeingIssuanceView-HBd52KnQ.js";import dt from"./Reports-hRs1Vcia.js";import{T as h}from"./TextField-B9bDqCXW.js";import{M as ut}from"./MenuItem-CqoynPPu.js";import{T as Se,a as Ce,b as k,c as C}from"./TabPanel-eD93EyWL.js";import"./Skeleton-B93ZyZJN.js";const ct=({po:a,handleClose:v,refetchIssuanceData:I})=>{ue();const[l,y]=i.useState({poId:a||0,issuanceId:""});ce();const[p,c]=i.useState([]),[b,N]=i.useState([]),[m,B]=i.useState([]),{data:S,refetch:T}=he({poId:l==null?void 0:l.poId,issuanceId:l==null?void 0:l.issuanceId},{skip:!(l!=null&&l.poId)||!(l!=null&&l.issuanceId)}),{data:Q,refetch:s}=Ue();i.useEffect(()=>{if((S==null?void 0:S.result)===null){c([]);return}S&&c(S.result.map((u,x)=>({id:x+1,...u})))},[S,T]),i.useEffect(()=>{Q&&(N(Q.result[0].destination.map((u,x)=>({id:x+1,...u}))),B(Q.result[0].dispatchFrom.map((u,x)=>({id:x+1,...u}))))},[Q,T]),console.log("formData",l),console.log("destinantionsList",b),console.log("dispatchFromList",m);const j=u=>{const{name:x,value:O}=u.target;y({...l,[x]:O})},[F,H]=de.useState(!1),[te,E]=de.useState(!1),se=async u=>{E(!0),H(u)},z=()=>{E(!1)},A=[{field:"id",headerName:"Sr#"},{field:"ogpNumber",headerName:"OGP"},{field:"issuanceId",headerName:"Issuance"},{field:"vendorName",headerName:"Vendor"},{field:"issuanceQuantity",headerName:"Issuance"},{field:"dispatchedQuantity",headerName:"Dispatch"},{field:"issuanceDate",headerName:"Issuance Date",valueGetter:u=>new Date(u).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"expectedReturnDate",headerName:"Expected Return Date",valueGetter:u=>new Date(u).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"fabricCount",headerName:"Fabrics"},{field:"ogpStatus",headerName:"Status"},{field:"Actions",headerName:"Actions",renderCell:u=>e.jsx("div",{style:{display:"flex",justifyContent:"space-around"},children:e.jsx(ve,{variant:"text",size:"small",sx:{marginTop:1},children:e.jsx(ee,{size:"small",color:"primary",onClick:()=>se(u.row),children:"OGP"})})})}];return e.jsxs("div",{children:[e.jsx(o,{container:!0,spacing:1,width:"Inherit",children:e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(h,{fullWidth:!0,label:"Issuance Id",name:"issuanceId",value:l.issuanceId,onChange:j,size:"small"})})}),e.jsx(o,{container:!0,spacing:2,width:"Inherit",children:e.jsxs(o,{item:!0,xs:12,children:[e.jsx(ge,{initialRows:p,iColumns:A,hideAction:!0}),e.jsxs(Ie,{open:te,onClose:z,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(ye,{sx:{backgroundColor:"#A11F23",color:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",paddingX:"24px",paddingY:"4px",mb:2.5},children:[e.jsx(Z,{variant:"h4",component:"div",color:"#ffffff",gutterBottom:!0,fontSize:20,fontWeight:2,fontStyle:"normal",children:"Create OGP"}),e.jsx(pe,{onClick:z,sx:{color:"#ffffff"},children:e.jsx(xe,{})})]}),e.jsxs(be,{children:[e.jsx(je,{id:"alert-dialog-slide-description"}),e.jsx(dt,{rId:13,paramIssuanceId:F.issuanceId,ogpNumber:F.ogpNumber})]})]})]})})]})},ht=_e(h)(({theme:a})=>({"& .MuiInputBase-input":{fontSize:"0.875rem",padding:"4px 6px"},width:"auto",height:"auto",minWidth:"100px",minHeight:"30px"})),mt=({rowData:a})=>{const[v,I]=i.useState([]),l=rt(),{enqueueSnackbar:y}=ce(),{user:p}=ue(),[c,b]=i.useState([]),[N,m]=i.useState([]),[B,S]=i.useState([]),T=c.reduce((t,n)=>t+(n.quantity??0),0).toFixed(2);console.log("Quantity",T);const Q=c.reduce((t,n)=>t+(n.issuanceQuantity??0),0).toFixed(2);console.log("quantities",N);const[s,j]=i.useState({issuanceId:0,poId:(a==null?void 0:a.poId)||0,productionId:(a==null?void 0:a.productionId)||"",issuanceDate:(a==null?void 0:a.issuanceDate)||null,expectedReturnDate:(a==null?void 0:a.expectedReturnDate)||"",processTypeId:1223,fabricId:(a==null?void 0:a.fabricId)||"",fabricName:(a==null?void 0:a.fabricName)||"",vendorId:(a==null?void 0:a.vendorId)||"",vendorName:(a==null?void 0:a.vendorName)||"",shrinkage:(a==null?void 0:a.shrinkage)||"",wastage:(a==null?void 0:a.wastage)||"",locationId:(a==null?void 0:a.locationId)||"",fullLocation:(a==null?void 0:a.fullLocation)||"",poQuantity:0,assignQuantity:0,stockReceived:0,remainingQuantity:0,quantity:0,balance:0,remarks:"",appId:p.appId,createdOn:new Date().toISOString(),createdBy:p.empId,lastUpdatedOn:new Date().toISOString(),LastUpdatedBy:p.empId}),[F,H]=i.useState([]),[te,E]=i.useState([]),[se,z]=i.useState([]),[A,u]=i.useState([]),[x,O]=i.useState([]),[ae,Ne]=i.useState("1"),ke=(t,n)=>{Ne(n),console.log("value",ae)},{data:M,refetch:Qe}=Xe(),{data:d,refetch:Le}=Ye(s.poId,{skip:!s.poId}),{data:L,refetch:ne}=we(s.poId,{skip:!s.poId}),{data:V,refetch:W}=Je(s.poId,{skip:!s.poId}),{data:$,refetch:pt}=Ke(),{data:U,refetch:Re}=Ze(s.productionId,{skip:!s.productionId}),{data:_,refetch:De}=et(s.fabricId,{skip:!s.fabricId}),{data:X,refetch:Ge}=tt({productionId:s.productionId,fabricId:s.fabricId},{skip:!s.fabricId||!s.productionId}),{data:R,refetch:Pe}=he({poId:s.poId,issuanceId:s.issuanceId},{skip:!s.poId||!s.issuanceId});i.useEffect(()=>{j(t=>({...t,remainingQuantity:t.quantity-t.issuanceQty||0}))},[a,c,d]),i.useEffect(()=>{j(t=>({...t,balance:t.remainingQuantity-Q||0}))},[a,c,d,s.remainingQuantity]);const[Y,Be]=i.useState([]);i.useEffect(()=>{d&&j({...s,shrinkage:d.result[0].shrinkage,productionId:d.result[0].productionId,productionHeaderId:d.result[0].productionHeaderId,issuanceDate:d.result[0].issuanceDate,expectedReturnDate:d.result[0].expectedReturnDate,fabricId:d.result[0].fabricId,vendorId:d.result[0].vendorId,locationId:d.result[0].locationId,fullLocation:d.result[0].fullLocation,fabricName:d.result[0].fabricName,vendorName:d.result[0].vendorName,wastage:d.result[0].wastage,issuanceQty:d.result[0].issuanceQty,stockInHandQty:d.result[0].stockInHandQty,quantity:d.result[0].quantity})},[d,Le]),i.useEffect(()=>{if((R==null?void 0:R.result)===null){O([]);return}R&&O(R.result.map((t,n)=>({id:n+1,...t})))},[R,Pe]),i.useEffect(()=>{if((L==null?void 0:L.result)===null){b([]);return}L&&b(L.result.map((t,n)=>({id:n+1,...t})))},[L,ne]),i.useEffect(()=>{V&&u(V.result.map((t,n)=>({id:n+1,...t})))},[V,W]),i.useEffect(()=>{U&&H(U.result.map((t,n)=>({id:n+1,...t})))},[U,Re]),i.useEffect(()=>{X&&m(X.result[0])},[X,Ge]),i.useEffect(()=>{_&&E(_.result.map((t,n)=>({id:n+1,...t})))},[_,De]),i.useEffect(()=>{$&&z($.result.map((t,n)=>({id:n+1,...t})))},[$]),i.useEffect(()=>{M&&Be(M.result.map((t,n)=>({id:n,...t})))},[M,Qe]),console.log("quantities",N);const f=t=>{const{name:n,value:g}=t.target;if(n==="poId"){const r=Y.find(J=>J.poId===parseInt(g));j({...s,poId:g,shrinkage:r?r.shrinkage:"",productionId:r?r.productionId:"",issuanceDate:r?r.issuanceDate:null,expectedReturnDate:r?r.expectedReturnDate:"",fabricId:r?r.fabricId:"",vendorId:r?r.vendorId:"",locationId:r?r.locationId:"",fullLocation:r?r.fullLocation:"",fabricName:r?r.fabricName:"",vendorName:r?r.vendorName:"",wastage:r?r.wastage:""})}else j({...s,[n]:g})},Te=async()=>{if(v.length===0){y("Please select at least one row before saving!",{variant:"warning",autoHideDuration:5e3});return}for(let t of c)if(t.issuanceQuantity>t.remaining){y("Error:Iissuance quantity cannot be greater than remaining quantity!",{variant:"error",autoHideDuration:5e3});return}console.log("formData",s);try{const t=await nt.post("http://100.42.177.77:83/api/Issuance/IssuanceToVendor",s);console.log("Save response:",t.data),y("Data saved successfully!",{variant:"success"}),S(n=>[...n,...s.issuanceTransactionDetails]),W(),ne()}catch(t){console.error("Error saving data:",t),y("Error saving data!",{variant:"error"})}};console.log("formData",s),console.log("productions",Y);const ie=i.useCallback(t=>{const{id:n,field:g,value:r}=t;b(J=>J.map(D=>{if(D.id===n){const Ve=D.quantity-D.assignQuantity,$e={...D,[g]:r,issuanceId:0,issuanceDetId:0,remaining:Number(Ve),appId:p.appId,createdOn:new Date().toISOString(),createdBy:p.empId,lastUpdatedOn:new Date().toISOString(),lastUpdatedBy:p.empId};return g==="issuanceQuantity"&&r>0&&I(K=>K.includes(n)?K:[...K,n]),$e}return D}))},[b,I,p.appId,p.empId]);i.useEffect(()=>{j(t=>({...s}))},[ie]);const Ee=[{field:"id",headerName:"Sr#"},{field:"designNo",headerName:"Design"},{field:"colorName",headerName:"Color"},{field:"quantity",headerName:"Total Qty",valueGetter:t=>t.toLocaleString()},{field:"assignQuantity",headerName:"Assigned Quantity",valueGetter:t=>t.toLocaleString()},{field:"remaining",headerName:"Remaining",valueGetter:(t,n)=>n.quantity-n.assignQuantity},{field:"issuanceQuantity",headerName:"Issuance Qty",renderCell:t=>e.jsx(ht,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:t.row.issuanceQuantity||"",onChange:n=>ie({id:t.id,field:"issuanceQuantity",value:Number(n.target.value)}),type:"number",disabled:t.row.quantity===t.row.assignQuantity,InputProps:{style:{fontSize:"0.875rem"}}})}],ze=()=>{l.current.autosizeColumns({includeHeaders:!0,includeOutliers:!0})};i.useEffect(()=>{ze()});const[xt,Oe]=i.useState([]),We=i.useCallback(t=>{I(t);const n=t.map(g=>{const r=l.current.getRow(g);return console.log("rowData",r),r?{...r}:null}).filter(g=>g!==null);console.log("selectedDesigns",n),Oe(n)},[l]);i.useEffect(()=>{const t=c.filter(n=>v.includes(n.id));j(n=>({...n,issuanceTransactionDetails:t}))},[c,v]),console.log("poDetails",c),i.useEffect(()=>{l.current&&console.log("API ref is ready:",l.current)},[l]);const[qe,re]=i.useState(!1);i.useState(!1);const[Fe,He]=i.useState(!1),Ae=async t=>{He(t),re(!0)},w=()=>{re(!1)},q=t=>t==null||isNaN(t)?"":new Intl.NumberFormat().format(t),Me=[{field:"id",headerName:"Sr#"},{field:"issuanceId",headerName:"Issuance"},{field:"vendorName",headerName:"Vendor"},{field:"issuanceQuantity",headerName:"Issuance"},{field:"dispatchedQuantity",headerName:"Dispatch"},{field:"issuanceDate",headerName:"Issuance Date",valueGetter:t=>new Date(t).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"expectedReturnDate",headerName:"Expected Return Date",valueGetter:t=>new Date(t).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"fabricCount",headerName:"Fabrics"},{field:"statusName",headerName:"Status"},{field:"Actions",headerName:"Actions",renderCell:t=>e.jsx("div",{style:{display:"flex",justifyContent:"space-around"},children:e.jsx(ve,{variant:"text",size:"small",sx:{marginTop:1},children:e.jsx(ee,{size:"small",color:"primary",onClick:()=>Ae(t.row),children:"Generate OGP"})})})}];return e.jsxs(P,{sx:{width:"100%",typography:"body1"},children:[e.jsxs(le,{variant:"outlined",children:[e.jsx(oe,{className:"css-4rfrnx-MuiCardHeader-root",title:"Dyeing Issuance",titleTypographyProps:{style:{color:"white"}}}),e.jsxs(o,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(h,{fullWidth:!0,select:!0,label:"Production",name:"poId",value:s.poId,onChange:f,size:"small",children:Y.map(t=>e.jsx(ut,{value:t.poId,children:t.poIdName},t.poId))})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(h,{size:"small",label:"Issuance Date",disabled:!0,name:"issuanceDate",value:s.issuanceDate?new Date(s.issuanceDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"}):null,onChange:f,fullWidth:!0,InputLabelProps:{shrink:!0,sx:{color:"black"}}})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(h,{size:"small",disabled:!0,label:"Planning Date",name:"expectedReturnDate",value:s.issuanceDate?new Date(s.expectedReturnDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"}):null,onChange:f,fullWidth:!0,InputLabelProps:{shrink:!0,sx:{color:"black"}}})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(h,{fullWidth:!0,disabled:!0,label:"Select Fabric",name:"fabricName",value:s.fabricName,onChange:f,size:"small"})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(h,{label:"Vendor",disabled:!0,fullWidth:!0,size:"small",name:"vendorName",onChange:f,value:s.vendorName,required:!0})}),e.jsx(o,{item:!0,xs:12,md:1.5,children:e.jsx(h,{label:"Shrinkage",fullWidth:!0,disabled:!0,size:"small",name:"shrinkage",onChange:f,value:s.shrinkage,required:!0})}),e.jsx(o,{item:!0,xs:12,md:1.5,children:e.jsx(h,{label:"Wastage",fullWidth:!0,disabled:!0,size:"small",name:"wastage",onChange:f,value:s.wastage,required:!0})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(h,{fullWidth:!0,disabled:!0,label:"Select Location",name:"fullLocation",value:s.fullLocation,onChange:f,size:"small"})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(h,{fullWidth:!0,label:"PO Quantity",name:"quantity",value:q(s.quantity),onChange:f,size:"small",disabled:!0})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(h,{fullWidth:!0,label:"Issued Quantity",name:"issuanceQty",value:q(s.issuanceQty),onChange:f,size:"small",disabled:!0})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(h,{fullWidth:!0,label:"Remaining Quantity",name:"remainingQuantity",value:q(s.remainingQuantity),onChange:f,size:"small",disabled:!0})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(h,{fullWidth:!0,label:"Stock InHAnd",name:"stockInHandQty",value:q(s.stockInHandQty),onChange:f,size:"small",disabled:!0})}),e.jsx(o,{item:!0,xs:3,textAlign:"right",children:e.jsxs(Z,{variant:"overline",sx:{display:"block",fontWeight:"bold",fontSize:15},children:["Balance : ",s.balance]})}),e.jsx(o,{item:!0,xs:12,children:e.jsx(h,{label:"Remarks",fullWidth:!0,size:"small",multiline:!0,maxRows:3,name:"remarks",onChange:f,value:s.remarks,required:!0})}),e.jsx(o,{item:!0,xs:12,children:e.jsx(lt,{rows:c,columns:Ee,apiRef:l,disableRowSelectionOnClick:!0,checkboxSelection:!0,isRowSelectable:t=>t.row.quantity!==t.row.assignQuantity,onRowSelectionModelChange:We,rowSelectionModel:v})}),e.jsx(o,{item:!0,xs:12,textAlign:"right",sx:{mt:2},children:e.jsx(ee,{variant:"contained",size:"small",onClick:Te,children:"Save"})})]})]}),e.jsx(st,{color:"#cc8587",sx:{height:1,width:"100%",mt:2}}),e.jsxs(le,{variant:"outlined",children:[e.jsx(oe,{className:"css-4rfrnx-MuiCardHeader-root",avatar:e.jsx(it,{}),title:"View Issuance",titleTypographyProps:{style:{color:"white"}}}),e.jsx(me,{style:{borderWidth:1,borderStyle:"dotted",borderColor:"#a11f23",width:"auto",maxHeight:{xs:"80vh",md:"auto"},overflow:"auto"},children:e.jsx(P,{sx:{width:"100%",typography:"body1"},children:e.jsxs(Se,{value:ae,children:[e.jsx(P,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Ce,{onChange:ke,children:[e.jsx(k,{icon:e.jsx(fe,{}),label:"Issuance",value:"1",sx:t=>({"& .MuiTouchRipple-child":{backgroundColor:`${t.palette.primary.main} !important`}})}),e.jsx(k,{icon:e.jsx(G,{}),label:"OGP",value:"2",sx:t=>({"& .MuiTouchRipple-child":{backgroundColor:`${t.palette.primary.main} !important`}})})]})}),e.jsx(C,{value:"1",children:e.jsx(o,{container:!0,spacing:2,width:"Inherit",children:e.jsxs(o,{item:!0,xs:12,children:[e.jsx(ge,{initialRows:A,iColumns:Me,hideAction:!0,refetchIssuanceData:W}),e.jsxs(Ie,{open:qe,onClose:w,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(ye,{sx:{backgroundColor:"#A11F23",color:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",paddingX:"24px",paddingY:"4px"},children:[e.jsx(Z,{variant:"h4",component:"div",color:"#ffffff",gutterBottom:!0,fontSize:20,fontWeight:2,fontStyle:"normal",children:"View Issuance Details"}),e.jsx(pe,{onClick:w,sx:{color:"#ffffff"},children:e.jsx(xe,{})})]}),e.jsxs(be,{children:[e.jsx(je,{id:"alert-dialog-slide-description"}),e.jsx(ot,{iss:Fe,handleClose:w,refetchData:W})]})]})]})})}),e.jsx(C,{value:"2",children:e.jsx(ct,{po:s.poId})})]})})})]})]})},ft=()=>e.jsx("div",{children:e.jsx("h1",{children:"SSRS Report Viewer"})}),Gt=()=>{var c,b,N;const a=at(),v=(c=a.state)==null?void 0:c.data,I=(N=(b=a.state)==null?void 0:b.tab)==null?void 0:N.toString();console.log("rowData",v),console.log("tab",I);const[l,y]=i.useState("1"),p=(m,B)=>{y(B),console.log("value",l)};return i.useEffect(()=>{I&&y(I)},[I]),e.jsx(me,{style:{borderWidth:1,borderStyle:"dotted",borderColor:"#a11f23",width:"auto",maxHeight:{xs:"80vh",md:"auto"},overflow:"auto"},children:e.jsx(P,{sx:{width:"100%",typography:"body1"},children:e.jsxs(Se,{value:l,children:[e.jsx(P,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Ce,{onChange:p,children:[e.jsx(k,{icon:e.jsx(fe,{}),label:"Dyeing Issuance",value:"1",sx:m=>({"& .MuiTouchRipple-child":{backgroundColor:`${m.palette.primary.main} !important`}})}),e.jsx(k,{icon:e.jsx(G,{}),label:"Embroidery Issuance",value:"2",sx:m=>({"& .MuiTouchRipple-child":{backgroundColor:`${m.palette.primary.main} !important`}})}),e.jsx(k,{icon:e.jsx(G,{}),label:"Schiffili Issuance",value:"3",sx:m=>({"& .MuiTouchRipple-child":{backgroundColor:`${m.palette.primary.main} !important`}})}),e.jsx(k,{icon:e.jsx(G,{}),label:"Additional Process Issuance",value:"4",sx:m=>({"& .MuiTouchRipple-child":{backgroundColor:`${m.palette.primary.main} !important`}})}),e.jsx(k,{icon:e.jsx(G,{}),label:"Additional Services Issuance",value:"5",sx:m=>({"& .MuiTouchRipple-child":{backgroundColor:`${m.palette.primary.main} !important`}})})]})}),e.jsx(C,{value:"1",children:e.jsx(mt,{rowData:v})}),e.jsx(C,{value:"2",children:e.jsx(ft,{})}),e.jsx(C,{value:"3"}),e.jsx(C,{value:"4"}),e.jsx(C,{value:"5"}),e.jsx(C,{value:"6"})]})})})};export{Gt as default};
