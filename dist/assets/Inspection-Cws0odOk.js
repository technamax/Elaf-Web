import{s as ne,c as K,u as Z,H as le,j as e,G as n,T as O,I as oe,J as de,M as ce,B as L,C as ue,d as he,e as me}from"./index-D1tX9wrp.js";import{r as s,R as $}from"./vendor-BXCbSo2_.js";import{B as R,a as ee,I as U}from"./axios-Cxh9UTPd.js";import{d as fe}from"./CategoryOutlined-BxyD4p3X.js";import{d as G}from"./AssignmentOutlined-DGXH1XTh.js";import{d as q}from"./Close-tPnCrOwd.js";import"./ReceivingDetails-A53riUMj.js";import{u as pe,D as ge,R as V,a as X,b as Y,c as _,d as J,B as xe}from"./ReuseableDataGrid-Dv91oMQ6.js";import{T as b}from"./TextField-DuUhpNBk.js";import{T as ye,a as ve,b as S,c as v}from"./TabPanel-CY2eq3Z6.js";import"./MenuItem-DQgeQNjY.js";import"./Skeleton-CzlzLFeS.js";const j=ne(b)(({theme:l})=>({"& .MuiInputBase-input":{fontSize:"0.875rem",padding:"4px 6px"},width:"auto",height:"auto",minWidth:"100px",minHeight:"30px"})),je=({rData:l,handleClose:k,refetch:x})=>{const[y,I]=s.useState({inspectionId:0,...l}),N=pe(),{enqueueSnackbar:u}=K(),{user:f}=Z(),[p,g]=s.useState([]),{data:d,refetch:w}=le(l.receivingId,{skip:!l.receivingId});s.useEffect(()=>{if((d==null?void 0:d.result)===null){g([]);return}d&&g(d.result.map((t,r)=>({id:r+1,...t})))},[d,w]),console.log("rData",l);const c=t=>{const{id:r,field:h,value:Q}=t;console.log("Editing cell:",t),g(z=>z.map(i=>{if(i.id===r){const m=(i.issuanceQuantity*100/(100+i.shrinkage+i.wastage)).toFixed(2),D=Math.max(i.receivedQty-((i.gradeAQty||0)+(i.gradeBQty||0)+(i.gradeCPQty||0)+(i.rejectedQty||0)+(i.others1Qty||0)),0);return{...i,[h]:Q,inspectionId:0,inspectiondetId:0,expectedQty:Number(m),shortageQty:Number(D),appId:f.appId,createdOn:new Date().toISOString(),createdBy:f.empId,lastUpdatedOn:new Date().toISOString(),lastUpdatedBy:f.empId}}return i}))};$.useEffect(()=>{I({...y,inspectionTransactionsDetailsModelList:p})},[p,g]),console.log("formData",y),console.log("receiveDetails",p);const P=[{field:"id",headerName:"Sr#"},{field:"designNo",headerName:"Design"},{field:"colorName",headerName:"Color"},{field:"fabricName",headerName:"Fabric"},{field:"issuanceQuantity",headerName:"Quantity Issued",valueGetter:t=>t?t.toLocaleString():"0"},{field:"receivedQty",headerName:"Received",valueGetter:t=>t?t.toLocaleString():"0"},{field:"expectedQty",headerName:"Expected",valueGetter:(t,r)=>(r.issuanceQuantity*100/(100+r.shrinkage+r.wastage)).toLocaleString()},{field:"recA",headerName:"Rec. GradeA",valueGetter:t=>t?t.toLocaleString():"0"},{field:"recB",headerName:"Rec. GradeB ",valueGetter:t=>t?t.toLocaleString():"0"},{field:"recCp",headerName:"Rec. GradeCP",valueGetter:t=>t?t.toLocaleString():"0"},{field:"recOthers1",headerName:"Rec. Others",valueGetter:t=>t?t.toLocaleString():"0"},{field:"gradeAQty",headerName:"Grade A",renderCell:t=>e.jsx(j,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:t.row.gradeAQty||0,onChange:r=>c({id:t.id,field:"gradeAQty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"gradeBQty",headerName:"Grade B",renderCell:t=>e.jsx(j,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:t.row.gradeBQty||0,onChange:r=>c({id:t.id,field:"gradeBQty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"gradeCPQty",headerName:"Cut Pc",renderCell:t=>e.jsx(j,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:t.row.gradeCPQty||0,onChange:r=>c({id:t.id,field:"gradeCPQty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"others1Qty",headerName:"Others",renderCell:t=>e.jsx(j,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:t.row.others1Qty||0,onChange:r=>c({id:t.id,field:"others1Qty",value:Number(r.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"shortageQty",headerName:"Short Stock",valueGetter:(t,r)=>{r.expectedQty,r.receivedQty;const h=r.receivedQty-((r.gradeAQty||0)+(r.gradeBQty||0)+(r.gradeCPQty||0)+(r.rejectedQty||0)+(r.others1Qty||0));return h>0?h.toLocaleString():0}},{field:"rejectedQty",headerName:"Rejected",renderCell:t=>e.jsx(j,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:t.row.rejectedQty||"",onChange:r=>c({id:t.id,field:"rejectedQty",value:r.target.value}),InputProps:{style:{fontSize:"0.875rem"}}})},{field:"remarks",headerName:"Remarks",renderCell:t=>e.jsx(j,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:t.row.remarks||"",onChange:r=>c({id:t.id,field:"remarks",value:r.target.value}),InputProps:{style:{fontSize:"0.875rem"}}})}],B=()=>{N.current.autosizeColumns({includeHeaders:!0,includeOutliers:!0})};$.useEffect(()=>{B()});const C=async()=>{for(let t of p)if(t.receivedQty<(t.gradeAQty||0)+(t.gradeBQty||0)+(t.gradeCPQty||0)+(t.others1Qty||0)){u("Error: Received quantity cannot be greater than issuance quantity!",{variant:"error",autoHideDuration:5e3});return}try{const t=await ee.post("http://100.42.177.77:83/api/Receiving/SaveInspection",y);t.data.success?u(`${t.data.message} !`,{variant:"success",autoHideDuration:5e3}):(u(`${t.data.message} !`,{variant:"error",autoHideDuration:5e3}),console.log("response.message",t.data.message)),x(),console.log("Save response:",t.data),k()}catch(t){console.error("Error saving data:",t),u("FAILED: Unable to start Process",{variant:"error",autoHideDuration:5e3})}};return e.jsxs("div",{children:[e.jsxs(n,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(n,{item:!0,xs:12,md:3,children:e.jsx(b,{fullWidth:!0,disabled:!0,label:"IGP Number",name:"igpNumber",value:l.igpNumber,size:"small"})}),e.jsx(n,{item:!0,xs:12,md:3,children:e.jsx(b,{fullWidth:!0,disabled:!0,label:"Process Type",name:"processTypename",value:l.processTypename,size:"small"})}),e.jsx(n,{item:!0,xs:12,md:3,children:e.jsx(b,{fullWidth:!0,disabled:!0,label:"Vendor",name:"vendorId",value:l.vendorName,size:"small"})}),e.jsx(n,{item:!0,xs:12,md:3,children:e.jsx(b,{size:"small",label:"IGP Creation Date ",name:"igpDate",value:new Date(l.igpDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"}),fullWidth:!0,disabled:!0,InputLabelProps:{shrink:!0,sx:{color:"black"}}})})]}),e.jsxs(n,{container:!0,spacing:2,width:"Inherit",children:[e.jsx(n,{item:!0,xs:12,children:e.jsx(O,{variant:"h2",children:"Details"})}),e.jsx(n,{item:!0,xs:12,children:e.jsx("div",{style:{height:400,width:"100%"},children:e.jsx(ge,{rows:p,columns:P,apiRef:N,disableRowSelectionOnClick:!0})})}),e.jsx(n,{item:!0,xs:12,textAlign:"right",sx:{mt:2},children:e.jsx(R,{variant:"contained",size:"small",onClick:C,children:"Save"})})]})]})},Be=()=>{var F,H,M;const l=oe(),k=(F=l.state)==null?void 0:F.data,x=(M=(H=l.state)==null?void 0:H.tab)==null?void 0:M.toString();console.log("rowData",k),console.log("tab",x);const[y,I]=s.useState("1"),N=(a,o)=>{I(o),console.log("value",y)};s.useEffect(()=>{x&&I(x)},[x]);const{enqueueSnackbar:u}=K(),{user:f}=Z();s.useState([]);const[p,g]=s.useState(!1),[d,w]=s.useState({issuanceId:"",appId:f.appId,createdOn:new Date().toISOString(),createdBy:f.empId,lastUpdatedOn:new Date().toISOString(),LastUpdatedBy:f.empId}),[c,P]=s.useState([]);s.useState(!1),console.log("initialRows",c);const B=a=>{const{name:o,value:T}=a.target;w({...d,[o]:T})},C=async()=>{if(d.issuanceId)try{const a=await ee.get("http://100.42.177.77:83/api/Receiving/GetReceivingHeader",{params:{issuanceId:d.issuanceId,processTypename:"Dyeing"}});console.log("API response:",a.data);const o=a.data.result;if(Array.isArray(o)){const T=o.map((ie,se)=>({...ie,id:se+1}));P(T),u("Data fetched successfully!",{variant:"success"})}else throw new Error("Unexpected data format")}catch(a){console.error("Error fetching data:",a),u("Failed to fetch data!",{variant:"error"})}else u("Please enter an issuance ID!",{variant:"warning"})},[t,r]=s.useState(!1),[h,Q]=s.useState({}),[z,i]=s.useState({}),{data:m,refetch:D}=de(h.receivingId,{skip:!h.receivingId});s.useEffect(()=>{if((m==null?void 0:m.result)===null){i([]);return}m&&i(m.result.map((a,o)=>({id:o+1,...a})))},[m,D]);const E=async a=>{Q(a),g(!0)},A=()=>{g(!1)},te=async a=>{r(!0),Q(a),D()},W=()=>{r(!1)},ae=[{field:"id",headerName:"Sr #"},{field:"collectionName",headerName:"Collection Name"},{field:"poName",headerName:"PO"},{field:"ogpNumber",headerName:"OGP Number",renderCell:a=>{a.value}},{field:"igpNumber",headerName:"IGP Number"},{field:"igpDate",headerName:"IGP Date",valueGetter:a=>new Date(a).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"receivingDate",headerName:"Receiving Date",valueGetter:a=>new Date(a).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"})},{field:"receivedQty",headerName:"Received"},{field:"processTypename",headerName:"Process Type"},{field:"statusName",headerName:"Status",renderCell:a=>{const o="primary.dark";if(a.value!==null)return e.jsx(me,{label:a.value,sx:{backgroundColor:o,color:"white"},color:void 0})}},{field:"Actions",headerName:"Actions",renderCell:a=>e.jsx("div",{style:{display:"flex",justifyContent:"space-around"},children:e.jsxs(xe,{variant:"text",size:"small",sx:{mt:1},children:[e.jsx(R,{size:"small",color:"primary",onClick:()=>E(a.row),disabled:a.row.status===4,children:"Inspection"}),e.jsx(R,{size:"small",color:"primary",onClick:()=>te(a.row),children:"View"})]})})}],re=[{field:"id",headerName:"Sr#"},{field:"designNo",headerName:"Design"},{field:"colorName",headerName:"Color"},{field:"fabricName",headerName:"Fabric"},{field:"issuanceQuantity",headerName:"Quantity Issued",valueGetter:a=>a.toLocaleString()},{field:"receivedQty",headerName:"Received",valueGetter:a=>a.toLocaleString()},{field:"gradeAQty",headerName:"Grade A",valueGetter:a=>a.toLocaleString()},{field:"gradeBQty",headerName:"Grade B",valueGetter:a=>a?a.toLocaleString():"0"},{field:"gradeCPQty",headerName:"Cut Pc",valueGetter:a=>a?a.toLocaleString():"0"},{field:"others1Qty",headerName:"Others",valueGetter:a=>a?a.toLocaleString():"0"},{field:"shortStock",headerName:"Short Stock",valueGetter:a=>a?a.toLocaleString():"0"},{field:"remarks",headerName:"Remarks"},{field:"statusName",headerName:"Status"}];return e.jsx(ce,{style:{borderWidth:1,borderStyle:"dotted",borderColor:"#a11f23",width:"auto",maxHeight:{xs:"80vh",md:"auto"},overflow:"auto"},children:e.jsx(L,{sx:{width:"100%",typography:"body1"},children:e.jsxs(ye,{value:y,children:[e.jsx(L,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(ve,{onChange:N,children:[e.jsx(S,{icon:e.jsx(fe,{}),label:"Dyeing Inspection",value:"1",sx:a=>({"& .MuiTouchRipple-child":{backgroundColor:`${a.palette.primary.main} !important`}})}),e.jsx(S,{icon:e.jsx(G,{}),label:"Embroidery Inspection",value:"2",sx:a=>({"& .MuiTouchRipple-child":{backgroundColor:`${a.palette.primary.main} !important`}})}),e.jsx(S,{icon:e.jsx(G,{}),label:"Schiffili Inspection",value:"3",sx:a=>({"& .MuiTouchRipple-child":{backgroundColor:`${a.palette.primary.main} !important`}})}),e.jsx(S,{icon:e.jsx(G,{}),label:"Additional Process Inspection",value:"4",sx:a=>({"& .MuiTouchRipple-child":{backgroundColor:`${a.palette.primary.main} !important`}})}),e.jsx(S,{icon:e.jsx(G,{}),label:"Additional Services Inspection",value:"5",sx:a=>({"& .MuiTouchRipple-child":{backgroundColor:`${a.palette.primary.main} !important`}})})]})}),e.jsx(v,{value:"1",children:e.jsx(L,{sx:{width:"100%",typography:"body1"},children:e.jsxs(ue,{variant:"outlined",children:[e.jsx(he,{className:"css-4rfrnx-MuiCardHeader-root",title:"Inspection",titleTypographyProps:{style:{color:"white"}}}),e.jsxs(n,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(n,{item:!0,xs:12,md:3,children:e.jsx(b,{label:"Enter Issuance Number",type:"number",fullWidth:!0,size:"small",name:"issuanceId",onChange:B,onKeyDown:a=>{a.key==="Enter"&&C()},value:d.issuanceId,required:!0})}),e.jsx(n,{item:!0,xs:12,md:3,sx:{mt:.5},children:e.jsx(R,{variant:"contained",size:"small",onClick:C,children:"Search"})}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx(V,{initialRows:c,iColumns:ae,hideAction:!0}),e.jsxs(X,{open:p,onClose:A,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(Y,{sx:{backgroundColor:"#A11F23",color:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",paddingX:"24px",paddingY:"4px"},children:[e.jsx(O,{variant:"h4",component:"div",color:"#ffffff",gutterBottom:!0,fontSize:20,fontWeight:2,fontStyle:"normal",children:"Start Inspection"}),e.jsx(U,{onClick:A,sx:{color:"#ffffff"},children:e.jsx(q,{})})]}),e.jsxs(_,{children:[e.jsx(J,{id:"alert-dialog-slide-description"}),e.jsx(je,{rData:h,handleClose:A,refetch:C})]})]}),e.jsxs(X,{open:t,onClose:W,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(Y,{sx:{backgroundColor:"#A11F23",color:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",paddingX:"24px",paddingY:"4px",mb:2.5},children:[e.jsx(O,{variant:"h4",component:"div",color:"#ffffff",gutterBottom:!0,fontSize:20,fontWeight:2,fontStyle:"normal",children:"View Inspection"}),e.jsx(U,{onClick:W,sx:{color:"#ffffff"},children:e.jsx(q,{})})]}),e.jsxs(_,{children:[e.jsx(J,{id:"alert-dialog-slide-description"}),e.jsx(V,{initialRows:z,iColumns:re,hideAction:!0})]})]})]})]})]})})}),e.jsx(v,{value:"2"}),e.jsx(v,{value:"3"}),e.jsx(v,{value:"4"}),e.jsx(v,{value:"5"}),e.jsx(v,{value:"6"})]})})})};export{Be as default};
