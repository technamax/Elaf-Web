import{s as z,c as B,u as G,v as k,j as t,G as i,T as E}from"./index-BQnKJm_U.js";import{r as h,R as Q}from"./vendor-BXCbSo2_.js";import{u as A,D as O}from"./ReuseableDataGrid-DM_ExMFu.js";import{B as T,a as L}from"./axios-CIHeZEXI.js";import{T as u}from"./TextField-B9bDqCXW.js";const o=z(u)(({theme:r})=>({"& .MuiInputBase-input":{fontSize:"0.875rem",padding:"4px 6px"},width:"auto",height:"auto",minWidth:"100px",minHeight:"30px"})),M=({iss:r,handleClose:b,refetchIssuanceData:I})=>{const[y,D]=h.useState({receivingId:0,...r}),v=A(),{enqueueSnackbar:g}=B(),{user:p}=G(),[s,c]=h.useState([]),{data:n,refetch:x}=k(r.issuanceId,{skip:!r.issuanceId});h.useEffect(()=>{if((n==null?void 0:n.result)===null){c([]);return}n&&c(n.result.map((e,a)=>({id:a+1,...e})))},[n,x]),console.log("iss",r);const d=e=>{const{id:a,field:m,value:P}=e;console.log("Editing cell:",e),c(R=>R.map(f=>{if(f.id===a){const l={...f,[m]:P,receivingId:0,receivingDetId:0,appId:p.appId,createdOn:new Date().toISOString(),createdBy:p.empId,lastUpdatedOn:new Date().toISOString(),lastUpdatedBy:p.empId};return(m==="gradeAQty"||m==="gradeBQty"||m==="gradeCPQty"||m==="others1Qty")&&(l.receivedQty=(l.gradeAQty||0)+(l.gradeBQty||0)+(l.gradeCPQty||0)+(l.others1Qty||0)),l}return f}))};Q.useEffect(()=>{D({...y,receivingTransactionsDetailsModelList:s})},[s,c]),console.log("formData",y),console.log("issuanceDetails",s);const j=[{field:"id",headerName:"Sr#"},{field:"colorName",headerName:"Color"},{field:"fabricName",headerName:"Fabric"},{field:"issuanceQuantity",headerName:"Quantity Issued",valueGetter:e=>e.toLocaleString()},{field:"uomName",headerName:"UOM"},{field:"lastReceivedQty",headerName:"Overall Received",valueGetter:(e,a)=>e-a.shortageQty},{field:"receivedQty",headerName:"Received qty",renderCell:e=>t.jsx(o,{variant:"outlined",disabled:!0,size:"small",sx:{mt:1,width:"50px"},value:(e.row.gradeAQty||0)+(e.row.gradeBQty||0)+(e.row.gradeCPQty||0)+(e.row.others1Qty||0),onChange:a=>d({id:e.id,field:"receivedQty",value:Number(a.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"gradeAQty",headerName:"Grade A",renderCell:e=>t.jsx(o,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:e.row.gradeAQty||0,defaultValue:10,onChange:a=>d({id:e.id,field:"gradeAQty",value:Number(a.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"gradeBQty",headerName:"Grade B",renderCell:e=>t.jsx(o,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:e.row.gradeBQty||0,onChange:a=>d({id:e.id,field:"gradeBQty",value:Number(a.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"gradeCPQty",headerName:"Cut Pc",renderCell:e=>t.jsx(o,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:e.row.gradeCPQty||0,onChange:a=>d({id:e.id,field:"gradeCPQty",value:Number(a.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"others1Qty",headerName:"Others",renderCell:e=>t.jsx(o,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:e.row.others1Qty||0,onChange:a=>d({id:e.id,field:"others1Qty",value:Number(a.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"remarks",headerName:"Remarks",renderCell:e=>t.jsx(o,{variant:"outlined",size:"small",sx:{mt:1,width:"100%"},value:e.row.remarks||"",onKeyDown:a=>{a.stopPropagation()},onChange:a=>d({id:e.id,field:"remarks",value:a.target.value}),InputProps:{style:{fontSize:"0.875rem"}}})}],w=()=>{v.current.autosizeColumns({includeHeaders:!0,includeOutliers:!0})};Q.useEffect(()=>{w()});const[C,S]=h.useState(!1);h.useEffect(()=>{for(let e of s)e.issuanceQuantity===e.lastReceivedQty&&S(!0)},[s,c]);const N=async()=>{for(let e of s)if(e.receivedQty>e.issuanceQuantity||e.issuanceQuantity===e.lastReceivedQty){g("Error: Received quantity cannot be greater than issuance quantity!",{variant:"error",autoHideDuration:5e3});return}try{const e=await L.post("http://100.42.177.77:83/api/Receiving/SaveReceiving",y);I(),e.data.success?g(`${e.data.message} !`,{variant:"success",autoHideDuration:5e3}):(g(`${e.data.message} !`,{variant:"error",autoHideDuration:5e3}),console.log("response.message",e.data.message)),console.log("Save response:",e.data),b(),x()}catch(e){console.error("Error saving data:",e),g("FAILED: Unable to start Process",{variant:"error",autoHideDuration:5e3})}};return t.jsxs("div",{children:[t.jsxs(i,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[t.jsx(i,{item:!0,xs:12,md:3,children:t.jsx(u,{fullWidth:!0,disabled:!0,label:"Production",name:"productionId",value:r.collectionName,size:"small"})}),t.jsx(i,{item:!0,xs:12,md:3,children:t.jsx(u,{fullWidth:!0,disabled:!0,label:"Process Type",name:"productionId",value:r.processTypeName,size:"small"})}),t.jsx(i,{item:!0,xs:12,md:3,children:t.jsx(u,{size:"small",label:"Issuance Date",name:"issuanceDate",value:new Date(r.issuanceDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"}),fullWidth:!0,disabled:!0,InputLabelProps:{shrink:!0,sx:{color:"black"}}})}),t.jsx(i,{item:!0,xs:12,md:3,children:t.jsx(u,{size:"small",label:"ExpectedReturn Date",name:"expectedReturnDate",value:new Date(r.expectedReturnDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"}),fullWidth:!0,disabled:!0,InputLabelProps:{shrink:!0,sx:{color:"black"}}})}),t.jsx(i,{item:!0,xs:12,md:3,children:t.jsx(u,{fullWidth:!0,disabled:!0,label:"Vendor",name:"vendorId",value:r.vendorName,size:"small"})})]}),t.jsxs(i,{container:!0,spacing:2,width:"Inherit",children:[t.jsx(i,{item:!0,xs:12,children:t.jsx(E,{variant:"h2",children:"Details"})}),t.jsx(i,{item:!0,xs:12,children:t.jsx("div",{style:{height:400,width:"100%"},children:t.jsx(O,{rows:s,columns:j,apiRef:v,disableRowSelectionOnClick:!0})})}),t.jsx(i,{item:!0,xs:12,textAlign:"right",sx:{mt:2},children:t.jsx(T,{variant:"contained",size:"small",onClick:N,disabled:C,children:"Generate IGP"})})]})]})};export{M as R};
