import{u as E,c as P,x as U,b as w,y as B,z as O,j as e,G as s,T as H}from"./index-39l8sM5Y.js";import{r as l}from"./vendor-BXCbSo2_.js";import{R as q}from"./ReuseableDataGrid-BPyget6h.js";import{B as A,a as M}from"./axios-BWUwFnln.js";import{S as V}from"./StatusChip-CqVTwn9e.js";import{T as r}from"./TextField-B7IP_ndE.js";import{M as m}from"./MenuItem-qJMJ5sWO.js";const te=({iss:a,handleClose:j,refetchData:y,isRejected:v})=>{const{user:b}=E(),[i,g]=l.useState({poId:a.poId,issuanceId:a.issuanceId,rejectionId:a.rejectionId||null,processTypeId:a.processTypeId||1223,dispatchedQuantity:"",dispatchFrom:"",destination:"",isRejectedOGP:v?"Y":"N",remarks:"",truckId:"",driverId:"",createdBy:b.empId}),{enqueueSnackbar:c}=P(),[k,x]=l.useState([]),[f,Q]=l.useState([]),[D,N]=l.useState([]),[L,z]=l.useState([]),[G,R]=l.useState([]),{data:u,refetch:I}=U({poId:a.poId,issuanceId:a.issuanceId},{skip:!a.poId||!a.issuanceId}),{data:o,refetch:Y}=w(),{data:h,refetch:S}=B(),{data:p,refetch:T}=O();l.useEffect(()=>{if((u==null?void 0:u.result)===null){x([]);return}u&&x(u.result.map((t,n)=>({id:n+1,...t})))},[u,I]),l.useEffect(()=>{h&&z(h.result.map((t,n)=>({id:n+1,...t})))},[h,S]),l.useEffect(()=>{p&&R(p.result.map((t,n)=>({id:n+1,...t})))},[p,T]),l.useEffect(()=>{o&&(Q(o.result[0].destination.map((t,n)=>({id:n+1,...t}))),N(o.result[0].dispatchFrom.map((t,n)=>({id:n+1,...t}))))},[o,I]),console.log("iss",a),console.log("formData",i),console.log("destinantionsList",f),console.log("dispatchFromList",D);const d=t=>{const{name:n,value:F}=t.target;g({...i,[n]:F})},W=[{field:"id",headerName:"Sr#"},{field:"fabricName",headerName:"Fabric"},{field:"colorName",headerName:"Color"},{field:"issuanceQuantity",headerName:"Issuance Quantity",renderCell:t=>e.jsx(V,{label:t.row.issuanceQuantity,status:"Issued"})},{field:"rate",headerName:"Rate"},{field:"uomName",headerName:"UOM"}],C=async()=>{if(i.dispatchedQuantity>a.issuanceQuantity-a.dispatchedQuantity){c("Error: DisPatched quantity cannot be greater than issuance quantity!",{variant:"error",autoHideDuration:5e3});return}try{const t=await M.post("http://100.42.177.77:83/api/Issuance/GenerateOGP",i);y(),t.data.success?c(`${t.data.message} !`,{variant:"success",autoHideDuration:5e3}):(c(`${t.data.message} !`,{variant:"error",autoHideDuration:5e3}),console.log("response.message",t.data.message)),console.log("Save response:",t.data),j()}catch(t){console.error("Error saving data:",t),c("FAILED: Unable to start Process",{variant:"error",autoHideDuration:5e3})}};return e.jsxs("div",{children:[e.jsxs(s,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[e.jsx(s,{item:!0,xs:12,md:3,children:e.jsx(r,{fullWidth:!0,disabled:!0,label:"Production",name:"productionId",value:a.collectionName,size:"small"})}),e.jsx(s,{item:!0,xs:12,md:1.5,children:e.jsx(r,{fullWidth:!0,disabled:!0,label:"Vendor",name:"vendorId",value:a.vendorName,size:"small"})}),e.jsx(s,{item:!0,xs:12,md:1.5,children:e.jsx(r,{fullWidth:!0,disabled:!0,label:"Process Type",name:"processTypeName",value:a.processTypeName,size:"small"})}),e.jsx(s,{item:!0,xs:12,md:3,children:e.jsx(r,{size:"small",type:a.issuanceDate?null:"Date",label:"Issuance Date",name:"issuanceDate",value:a.issuanceDate?new Date(a.issuanceDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"}):i.issuanceDate,fullWidth:!0,disabled:a.issuanceDate,InputLabelProps:{shrink:!0,sx:{color:"black"}}})}),e.jsx(s,{item:!0,xs:12,md:3,children:e.jsx(r,{size:"small",type:a.issuanceDate?null:"Date",label:"ExpectedReturn Date",name:"expectedReturnDate",value:a.expectedReturnDate?new Date(a.expectedReturnDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"}):i.expectedReturnDate,fullWidth:!0,disabled:a.expectedReturnDate,InputLabelProps:{shrink:!0,sx:{color:"black"}}})}),e.jsx(s,{item:!0,xs:12,md:3,children:e.jsx(r,{fullWidth:!0,select:!0,label:"Dispatch From",name:"dispatchFrom",value:i.dispatchFrom,onChange:d,size:"small",children:D.map(t=>e.jsx(m,{value:t.lookUpId,children:t.lookUpName},t.lookUpId))})}),e.jsx(s,{item:!0,xs:12,md:3,children:e.jsx(r,{fullWidth:!0,select:!0,label:"Destination",name:"destination",value:i.destination,onChange:d,size:"small",children:f.map(t=>e.jsx(m,{value:t.lookUpId,children:t.lookUpName},t.lookUpId))})}),e.jsx(s,{item:!0,xs:12,md:3,children:e.jsx(r,{fullWidth:!0,select:!0,label:"Drivers",name:"driverId",value:i.driverId,onChange:d,size:"small",children:L.map(t=>e.jsx(m,{value:t.driverId,children:t.driverName},t.driverId))})}),e.jsx(s,{item:!0,xs:12,md:3,children:e.jsx(r,{fullWidth:!0,select:!0,label:"Trucks",name:"truckId",value:i.truckId,onChange:d,size:"small",children:G.map(t=>e.jsx(m,{value:t.truckId,children:t.truckNumber},t.truckId))})}),e.jsx(s,{item:!0,xs:12,md:3,children:e.jsx(r,{fullWidth:!0,label:"Remarks",name:"remarks",value:i.remarks,onChange:d,size:"small"})}),e.jsx(s,{item:!0,xs:12,md:1.5,children:e.jsx(r,{fullWidth:!0,disabled:!0,label:"Issuance Quantity",name:"issuanceQuantity",value:a.issuanceQuantity||a.rejectedQty,size:"small"})}),e.jsx(s,{item:!0,xs:12,md:1.5,children:e.jsx(r,{fullWidth:!0,disabled:!0,label:"Remaining Quantity",name:"issuanceQuantity",value:a.issuanceQuantity-a.dispatchedQuantity,size:"small"})}),e.jsx(s,{item:!0,xs:12,md:1.5,children:e.jsx(r,{fullWidth:!0,type:"Number",label:"DispatchedQuantity",name:"dispatchedQuantity",value:i.dispatchedQuantity,onChange:d,size:"small"})})]}),e.jsxs(s,{container:!0,spacing:2,width:"Inherit",children:[e.jsx(s,{item:!0,xs:12,children:e.jsx(H,{variant:"h2",children:"Details"})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(q,{initialRows:k,iColumns:W,hideAction:!0})}),e.jsx(s,{item:!0,xs:12,textAlign:"right",sx:{mt:2},children:e.jsx(A,{variant:"contained",size:"small",onClick:C,children:"Generate OGP"})})]})]})};export{te as D};
