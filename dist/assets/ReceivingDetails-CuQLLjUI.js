import{s as E,u as L,c as A,v as O,w as T,j as t,G as r,T as W}from"./index-39l8sM5Y.js";import{r as l,R as b}from"./vendor-BXCbSo2_.js";import{u as H,D as F}from"./ReuseableDataGrid-BPyget6h.js";import{B as M,a as U}from"./axios-BWUwFnln.js";import{T as d}from"./TextField-B7IP_ndE.js";import{M as q}from"./MenuItem-qJMJ5sWO.js";const m=E(d)(({theme:i})=>({"& .MuiInputBase-input":{fontSize:"0.875rem",padding:"4px 6px"},width:"auto",height:"auto",minWidth:"100px",minHeight:"30px"})),_=({iss:i,handleClose:D,refetchIssuanceData:j})=>{const{user:f}=L(),[h,p]=l.useState({receivingId:0,locationId:"",createdBy:f.empId,...i}),I=H(),{enqueueSnackbar:y}=A(),[s,g]=l.useState([]),{data:x,refetch:V}=O(),{data:o,refetch:Q}=T(i.issuanceId,{skip:!i.issuanceId}),[w,C]=l.useState([]);l.useEffect(()=>{x&&C(x.result.map((e,a)=>({id:a+1,...e})))},[x]),l.useEffect(()=>{if((o==null?void 0:o.result)===null){g([]);return}o&&g(o.result.map((e,a)=>({id:a+1,...e})))},[o,Q]),console.log("iss",i);const S=e=>{const{name:a,value:n}=e.target;p({...h,[a]:n})},u=e=>{const{id:a,field:n,value:G}=e;console.log("Editing cell:",e),g(k=>k.map(v=>{if(v.id===a){const c={...v,[n]:G,receivingId:0,receivingDetId:0,appId:f.appId,createdOn:new Date().toISOString(),createdBy:f.empId,lastUpdatedOn:new Date().toISOString(),lastUpdatedBy:f.empId};return(n==="gradeAQty"||n==="gradeBQty"||n==="gradeCPQty"||n==="others1Qty")&&(c.receivedQty=(c.gradeAQty||0)+(c.gradeBQty||0)+(c.gradeCPQty||0)+(c.others1Qty||0)),c}return v}))};b.useEffect(()=>{p({...h,receivingTransactionsDetailsModelList:s})},[s,g]),console.log("formData",h),console.log("issuanceDetails",s);const N=[{field:"id",headerName:"Sr#"},{field:"colorName",headerName:"Color"},{field:"designNo",headerName:"Design"},{field:"fabricName",headerName:"Fabric"},{field:"issuanceQuantity",headerName:"Quantity",valueGetter:e=>e.toLocaleString()},{field:"uomName",headerName:"UOM"},{field:"lastReceivedQty",headerName:"Overall Received",valueGetter:(e,a)=>e-a.shortageQty},{field:"receivedQty",headerName:"Received qty",renderCell:e=>t.jsx(m,{variant:"outlined",disabled:!0,size:"small",sx:{mt:1,width:"50px"},value:(e.row.gradeAQty||0)+(e.row.gradeBQty||0)+(e.row.gradeCPQty||0)+(e.row.others1Qty||0),onChange:a=>u({id:e.id,field:"receivedQty",value:Number(a.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"gradeAQty",headerName:"Grade A",renderCell:e=>t.jsx(m,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:e.row.gradeAQty||0,defaultValue:10,onChange:a=>u({id:e.id,field:"gradeAQty",value:Number(a.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"gradeBQty",headerName:"Grade B",renderCell:e=>t.jsx(m,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:e.row.gradeBQty||0,onChange:a=>u({id:e.id,field:"gradeBQty",value:Number(a.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"gradeCPQty",headerName:"Cut Pc",renderCell:e=>t.jsx(m,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:e.row.gradeCPQty||0,onChange:a=>u({id:e.id,field:"gradeCPQty",value:Number(a.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"others1Qty",headerName:"Others",renderCell:e=>t.jsx(m,{variant:"outlined",size:"small",sx:{mt:1,width:"50px"},value:e.row.others1Qty||0,onChange:a=>u({id:e.id,field:"others1Qty",value:Number(a.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"remarks",headerName:"Remarks",renderCell:e=>t.jsx(m,{variant:"outlined",size:"small",sx:{mt:1,width:"100%"},value:e.row.remarks||"",onKeyDown:a=>{a.stopPropagation()},onChange:a=>u({id:e.id,field:"remarks",value:a.target.value}),InputProps:{style:{fontSize:"0.875rem"}}})}],z=()=>{I.current.autosizeColumns({includeHeaders:!0,includeOutliers:!0})};b.useEffect(()=>{z()});const[P,R]=l.useState(!1);l.useEffect(()=>{for(let e of s)e.issuanceQuantity===e.lastReceivedQty&&R(!0)},[s,g]);const B=async()=>{for(let e of s)if(e.receivedQty>e.issuanceQuantity||e.issuanceQuantity===e.lastReceivedQty){y("Error: Received quantity cannot be greater than issuance quantity!",{variant:"error",autoHideDuration:5e3});return}try{const e=await U.post("http://100.42.177.77:83/api/Receiving/SaveReceiving",h);j(),e.data.success?y(`${e.data.message} !`,{variant:"success",autoHideDuration:5e3}):(y(`${e.data.message} !`,{variant:"error",autoHideDuration:5e3}),console.log("response.message",e.data.message)),console.log("Save response:",e.data),D(),Q()}catch(e){console.error("Error saving data:",e),y("FAILED: Unable to start Process",{variant:"error",autoHideDuration:5e3})}};return t.jsxs("div",{children:[t.jsxs(r,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[t.jsx(r,{item:!0,xs:12,md:3,children:t.jsx(d,{fullWidth:!0,disabled:!0,label:"Production",name:"productionId",value:i.collectionName,size:"small"})}),t.jsx(r,{item:!0,xs:12,md:3,children:t.jsx(d,{fullWidth:!0,disabled:!0,label:"Process Type",name:"productionId",value:i.processTypeName,size:"small"})}),t.jsx(r,{item:!0,xs:12,md:3,children:t.jsx(d,{size:"small",label:"Issuance Date",name:"issuanceDate",value:new Date(i.issuanceDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"}),fullWidth:!0,disabled:!0,InputLabelProps:{shrink:!0,sx:{color:"black"}}})}),t.jsx(r,{item:!0,xs:12,md:3,children:t.jsx(d,{size:"small",label:"ExpectedReturn Date",name:"expectedReturnDate",value:new Date(i.expectedReturnDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"}),fullWidth:!0,disabled:!0,InputLabelProps:{shrink:!0,sx:{color:"black"}}})}),t.jsx(r,{item:!0,xs:12,md:3,children:t.jsx(d,{fullWidth:!0,disabled:!0,label:"Vendor",name:"vendorId",value:i.vendorName,size:"small"})}),t.jsx(r,{item:!0,xs:12,md:3,children:t.jsx(d,{fullWidth:!0,select:!0,label:"Select Location",name:"locationId",value:h.locationId,onChange:S,size:"small",children:w.map(e=>t.jsx(q,{value:e.locationId,children:e.section+"."+e.aisle+"."+e.rack+"."+e.bin},e.locationId))})})]}),t.jsxs(r,{container:!0,spacing:2,width:"Inherit",children:[t.jsx(r,{item:!0,xs:12,children:t.jsx(W,{variant:"h2",children:"Details"})}),t.jsx(r,{item:!0,xs:12,children:t.jsx("div",{style:{height:400,width:"100%"},children:t.jsx(F,{rows:s,columns:N,apiRef:I,disableRowSelectionOnClick:!0})})}),t.jsx(r,{item:!0,xs:12,textAlign:"right",sx:{mt:2},children:t.jsx(M,{variant:"contained",size:"small",onClick:B,disabled:P,children:"Generate IGP"})})]})]})};export{_ as R};
