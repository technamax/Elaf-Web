import{s as N,c as Q,u as P,w as R,j as t,G as i,T as k}from"./index-CFVVvMCv.js";import{r as x,R as v}from"./vendor-BXCbSo2_.js";import{u as G,D as B}from"./ReuseableDataGrid-CFuFh_7m.js";import{B as E,a as O}from"./axios-qW6zj_I1.js";import{T as d}from"./TextField-BrYEIcy4.js";const l=N(d)(({theme:r})=>({"& .MuiInputBase-input":{fontSize:"0.875rem",padding:"4px 6px"},width:"auto",height:"auto",minWidth:"100px",minHeight:"30px"})),U=({iss:r,handleClose:f,refetchIssuanceData:y})=>{const[c,I]=x.useState({receivingId:0,...r}),g=G(),{enqueueSnackbar:m}=Q(),{user:h}=P(),[o,u]=x.useState([]),{data:s,refetch:b}=R(r.issuanceId,{skip:!r.issuanceId});x.useEffect(()=>{if((s==null?void 0:s.result)===null){u([]);return}s&&u(s.result.map((e,a)=>({id:a+1,...e})))},[s,b]),console.log("iss",r);const n=e=>{const{id:a,field:S,value:z}=e;console.log("Editing cell:",e),u(C=>C.map(p=>p.id===a?{...p,[S]:z,receivingId:0,receivingDetId:0,appId:h.appId,createdOn:new Date().toISOString(),createdBy:h.empId,lastUpdatedOn:new Date().toISOString(),lastUpdatedBy:h.empId}:p))};v.useEffect(()=>{I({...c,receivingTransactionsDetailsModelList:o})},[o,u]),console.log("formData",c),console.log("issuanceDetails",o);const D=[{field:"id",headerName:"Sr#"},{field:"fabricName",headerName:"Fabric"},{field:"issuanceQuantity",headerName:"Quantity Issued",valueGetter:e=>e.toLocaleString()},{field:"uomName",headerName:"UOM"},{field:"receivedQty",headerName:"Received qty",renderCell:e=>t.jsx(l,{variant:"outlined",size:"small",sx:{mt:1,width:"100%"},value:e.row.receivedQty||0,onChange:a=>n({id:e.id,field:"receivedQty",value:Number(a.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"gradeAQty",headerName:"Grade A",renderCell:e=>t.jsx(l,{variant:"outlined",size:"small",sx:{mt:1,width:"100%"},value:e.row.gradeAQty||0,onChange:a=>n({id:e.id,field:"gradeAQty",value:Number(a.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"gradeBQty",headerName:"Grade B",renderCell:e=>t.jsx(l,{variant:"outlined",size:"small",sx:{mt:1,width:"100%"},value:e.row.gradeBQty||0,onChange:a=>n({id:e.id,field:"gradeBQty",value:Number(a.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"gradeCPQty",headerName:"Cut Pc",renderCell:e=>t.jsx(l,{variant:"outlined",size:"small",sx:{mt:1,width:"100%"},value:e.row.gradeCPQty||0,onChange:a=>n({id:e.id,field:"gradeCPQty",value:Number(a.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"others1Qty",headerName:"Others",renderCell:e=>t.jsx(l,{variant:"outlined",size:"small",sx:{mt:1,width:"100%"},value:e.row.others1Qty||0,onChange:a=>n({id:e.id,field:"others1Qty",value:Number(a.target.value)}),type:"number",InputProps:{style:{fontSize:"0.875rem"}}})},{field:"remarks",headerName:"Remarks",renderCell:e=>t.jsx(l,{variant:"outlined",size:"small",sx:{mt:1,width:"100%"},value:e.row.remarks||"",onChange:a=>n({id:e.id,field:"remarks",value:a.target.value}),InputProps:{style:{fontSize:"0.875rem"}}})}],j=()=>{g.current.autosizeColumns({includeHeaders:!0,includeOutliers:!0})};v.useEffect(()=>{j()});const w=async()=>{try{const e=await O.post("http://100.42.177.77:81/api/Receiving/SaveReceiving",c);y(),e.data.success?m(`${e.data.message} !`,{variant:"success",autoHideDuration:5e3}):(m(`${e.data.message} !`,{variant:"error",autoHideDuration:5e3}),console.log("response.message",e.data.message)),console.log("Save response:",e.data),f()}catch(e){console.error("Error saving data:",e),m("FAILED: Unable to start Process",{variant:"error",autoHideDuration:5e3})}};return t.jsxs("div",{children:[t.jsxs(i,{container:!0,spacing:1,width:"Inherit",sx:{paddingY:2,paddingX:2},children:[t.jsx(i,{item:!0,xs:12,md:3,children:t.jsx(d,{fullWidth:!0,disabled:!0,label:"Production",name:"productionId",value:r.collectionName,size:"small"})}),t.jsx(i,{item:!0,xs:12,md:3,children:t.jsx(d,{fullWidth:!0,disabled:!0,label:"Process Type",name:"productionId",value:r.processTypeName,size:"small"})}),t.jsx(i,{item:!0,xs:12,md:3,children:t.jsx(d,{size:"small",label:"Issuance Date",name:"issuanceDate",value:new Date(r.issuanceDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"}),fullWidth:!0,disabled:!0,InputLabelProps:{shrink:!0,sx:{color:"black"}}})}),t.jsx(i,{item:!0,xs:12,md:3,children:t.jsx(d,{size:"small",label:"ExpectedReturn Date",name:"expectedReturnDate",value:new Date(r.expectedReturnDate).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"2-digit"}),fullWidth:!0,disabled:!0,InputLabelProps:{shrink:!0,sx:{color:"black"}}})}),t.jsx(i,{item:!0,xs:12,md:3,children:t.jsx(d,{fullWidth:!0,disabled:!0,label:"Vendor",name:"vendorId",value:r.vendorName,size:"small"})})]}),t.jsxs(i,{container:!0,spacing:2,width:"Inherit",children:[t.jsx(i,{item:!0,xs:12,children:t.jsx(k,{variant:"h2",children:"Details"})}),t.jsx(i,{item:!0,xs:12,children:t.jsx("div",{style:{height:400,width:"100%"},children:t.jsx(B,{rows:o,columns:D,apiRef:g,disableRowSelectionOnClick:!0})})}),t.jsx(i,{item:!0,xs:12,textAlign:"right",sx:{mt:2},children:t.jsx(E,{variant:"contained",size:"small",onClick:w,children:"Generate IGP"})})]})]})};export{U as R};
