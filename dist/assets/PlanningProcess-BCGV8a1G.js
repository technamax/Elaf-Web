import{r as i,j as e,_ as pe,e as se,a as ue,f as ne,g as me,h as xe,i as ge,k as he,l as fe,M as oe,F as re,G as a,T as G,D as ie,m as be,n as Ie,B as _}from"./index-CBw2d3eb.js";import{a as $}from"./axios-CSRHvA_j.js";import{S as je,a as ve,b as Se,F as Ce}from"./Fabrication-DUbaujOE.js";import{A as Pe,C as ye,F as ce}from"./EditAbleDataGrid-D0kJdA_7.js";import{B as W,T as n,P as Ne}from"./TextField-ClGwskUy.js";import{M as j}from"./Skeleton-DxKBGV_v.js";let de=!1;const Fe=i.forwardRef(function(d,k){return de||(console.warn(["MUI: The Autocomplete component was moved from the lab to the core.","","You should use `import { Autocomplete } from '@mui/material'`","or `import Autocomplete from '@mui/material/Autocomplete'`"].join(`
`)),de=!0),e.jsx(Pe,pe({ref:k},d))}),ke=()=>{const[t,d]=i.useState({designId:"",batchNo:"",componentId:"",fabricId:"",vendorId:"",poPcs:"",baseColorId:"",baseColorName:"",colorId:"",availableQty:"",noOfHeads:"",repeats:"",cuttingSize:"",itemsPerRepeat:"",totalPcs:"",totalAmount:"",threadStitches:"",threadRate:"",threadAmount:"",tillaStitches:"",tillaRate:"",tillaAmount:"",sequenceStitches:"",sequenceRate:"",sequenceAmount:"",isSolving:!1,solvingLayers:"",solvingInMeters:"",solvingRate:"",solvingAmount:"",additional:"",costPerComponent:"",createdOn:new Date().toISOString(),createdBy:0,lastUpdatedOn:new Date().toISOString(),LastUpdatedBy:0}),{data:k}=se(),[z,M]=i.useState(""),{data:P}=ue(),{data:A,refetch:J}=ne(z,{skip:!z}),{data:O,refetch:X}=me(t.designId,{skip:!t.designId}),{data:N}=xe({batchNo:t.batchNo,componentId:t.componentId},{skip:!t.batchNo||!t.componentId}),{data:R}=ge({batchNo:t.batchNo,componentId:t.componentId,fabricId:t.fabricId},{skip:!t.batchNo||!t.componentId||!t.fabricId}),{data:U,refetch:q}=he(t.batchNo,{skip:!t.batchNo}),{data:T}=fe(t.batchNo,{skip:!t.batchNo});console.log("colorData",R);const[B,E]=i.useState([]),[w,p]=i.useState([]),[C,V]=i.useState([]),[L,o]=i.useState([]),[D,v]=i.useState([]),[K,ee]=i.useState([]),[te,y]=i.useState([]),[r,b]=i.useState([]);i.useEffect(()=>{A&&E(A.result)},[A]),i.useEffect(()=>{O&&p(O.result)},[O]),i.useEffect(()=>{N&&V(N.result)},[N]),i.useEffect(()=>{R&&ee(N.result)},[R]),i.useEffect(()=>{T&&b(T.result)},[T]),i.useEffect(()=>{U&&y(U.result.map((s,c)=>({id:c,...s})))},[U]),i.useEffect(()=>{if(P){const s=P.result[0];o(s.vendorList),v(s.noOfHeadsList)}},[P]);const u=(k==null?void 0:k.result)||[];i.useEffect(()=>{const s=()=>{const h=parseFloat(t.repeats)||0,F=parseFloat(t.itemsPerRepeat)||0;return h*F};d(h=>({...h,totalPcs:s()}));const c=()=>{const h=parseFloat(t.threadStitches)||0,F=parseFloat(t.threadRate)||0,Q=parseFloat(t.noOfHeads)||0,Z=parseFloat(t.repeats)||0;return h/1e3*(F*Z*Q)};d(h=>({...h,threadAmount:c()}));const g=()=>{const h=parseFloat(t.tillaStitches)||0,F=parseFloat(t.tillaRate)||0,Q=parseFloat(t.noOfHeads)||0,Z=parseFloat(t.repeats)||0;return h/1e3*(F*Z*Q)};d(h=>({...h,tillaAmount:g()}));const f=()=>{const h=parseFloat(t.sequenceStitches)||0,F=parseFloat(t.sequenceRate)||0,Q=parseFloat(t.noOfHeads)||0,Z=parseFloat(t.repeats)||0;return h/1e3*(F*Z*Q)};d(h=>({...h,sequenceAmount:f()}));const S=()=>{const h=parseFloat(t.repeats)||0,F=parseFloat(t.noOfHeads)||0,Q=parseFloat(t.solvingLayers)||0;return h*F*13/39.37*Q};d(h=>({...h,solvingInMeters:S()}));const le=()=>{const h=parseFloat(t.solvingInMeters)||0,F=parseFloat(t.solvingRate)||0;return parseFloat(t.solvingLayers),h*F};d(h=>({...h,solvingAmount:le()}));const H=()=>{const h=parseFloat(t.threadAmount)||0,F=parseFloat(t.tillaAmount)||0,Q=parseFloat(t.sequenceAmount)||0,Z=parseFloat(t.solvingAmount)||0;return h+F+Q+Z};d(h=>({...h,totalAmount:H()}));const Y=()=>{const h=parseFloat(t.totalAmount)||0,F=parseFloat(t.totalPcs)||0;return h/F};d(h=>({...h,costPerComponent:Y()}))},[t.threadAmount,t.totalAmount,t.sequenceAmount,t.solvingAmount,t.repeats,t.tillaAmount,t.itemsPerRepeat,t.threadRate,t.threadStitches,t.noOfHeads,t.tillaRate,t.tillaStitches,t.sequenceRate,t.sequenceStitches,t.solvingLayers,t.solvingInMeters,t.solvingRate]);const m=s=>{const{name:c,checked:g}=s.target;d(f=>({...f,[c]:g}))},l=s=>{const{name:c,value:g}=s.target;if(c==="collectionId"){const f=u.find(S=>S.collectionId===parseInt(g));M(g),d({...t,collectionId:g,poPcs:f?f.poPcs:""})}else if(c==="designId"){const f=B.find(S=>S.designId===parseInt(g));d({...t,designId:g,baseColorId:f?f.colorId:"",baseColorName:f?f.colorName:""})}else if(c==="batchNo"){const f=w.find(S=>S.batchNo===g);d({...t,batchNo:g,planningHeaderId:f?f.planningHeaderId:""})}else if(c==="fabricId"){const f=C.find(S=>S.fabricId===g);d({...t,fabricId:g,quantity:f?f.total:""})}else d({...t,[c]:g})},x=[{field:"designId",headerName:"Design",editable:!0,flex:1,type:"singleSelect",valueOptions:B.map(s=>({value:s.designId,label:s.designNo}))},{field:"poPcs",headerName:"PO. Pieces",flex:1,editable:!0},{field:"quantity",headerName:"Quantity",flex:1,editable:!0},{field:"rate",headerName:"Rate",editable:!0,flex:1},{field:"vendorId",headerName:"Vendor",editable:!0,flex:1,type:"singleSelect",valueOptions:L.map(s=>({value:s.lookUpId,label:s.lookUpName}))},{field:"total",headerName:"Total",flex:1,editable:!0,valueSetter:(s,c)=>{const g=c.quantity??0,f=c.rate??0,S=g*f;return console.log("total",S),{...c,total:S}}},{field:"unitPrice",headerName:"Unit Price",flex:1,editable:!0,valueSetter:(s,c)=>{const g=c.total??0,f=c.poPcs??0,S=g/f;return console.log("unitPrice",S),{...c,unitPrice:S}}},{field:"gst",headerName:"GST",flex:1,editable:!0},{field:"totalInclGst",headerName:"Total Inc. GST",flex:1,editable:!0,valueSetter:(s,c)=>{const g=c.total??0,f=c.gst??0,S=g*(1+f/100);return console.log("totalInclGst",S),{...c,totalInclGst:S}}}],I=async()=>{try{const s=await $.post("https://gecxc.com:4041/api/Fabrication/SaveFabrication",t);console.log("Save response:",s.data),d({designId:"",batchNo:"",baseColorId:"",baseColorName:"",fabricId:"",poPcs:"",quantity:"",rate:"",uomId:"string",total:"",unitPrice:"",gst:"",totalInclGst:"",createdOn:"2024-05-29T09:56:23.916Z",createdBy:0,lastUpdatedOn:"2024-05-29T09:56:23.916Z",LastUpdatedBy:0})}catch(s){console.error("Error saving data:",s)}};return console.log("formData",t),e.jsxs(oe,{style:{borderWidth:2,borderStyle:"dotted",borderColor:"#a11f23",width:"auto",maxHeight:{xs:"80vh",md:"auto"},overflow:"auto"},children:[e.jsx(re,{children:e.jsxs(a,{container:!0,spacing:2,width:"Inherit",children:[e.jsx(a,{item:!0,xs:9,md:9,children:e.jsx(G,{variant:"h3",gutterBottom:!0,children:"Embroidery"})}),e.jsx(a,{item:!0,xs:3,textAlign:"right",children:e.jsx(W,{variant:"contained",size:"small",onClick:I,children:"Save"})}),e.jsxs(a,{item:!0,xs:12,md:3,children:[e.jsx(n,{fullWidth:!0,select:!0,label:"Select Collection",name:"collectionId",value:z,onChange:l,size:"small",children:u.map(s=>e.jsx(j,{value:s.collectionId,children:s.collectionName},s.collectionId))})," "]}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{fullWidth:!0,select:!0,label:"Select Design",name:"designId",value:t.designId,onChange:l,size:"small",children:B.map(s=>e.jsx(j,{value:s.designId,children:s.designNo},s.designId))})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{label:"Base Color",fullWidth:!0,size:"small",name:"baseColorName",value:t.baseColorName,onChange:l,disabled:!0})}),e.jsxs(a,{item:!0,xs:12,md:3,children:[e.jsx(n,{fullWidth:!0,select:!0,label:"Batch No.",name:"batchNo",value:t.batchNo,onChange:l,size:"small",children:w.map(s=>e.jsx(j,{value:s.batchNo,children:s.batchNo},s.batchNo))})," "]}),e.jsxs(a,{item:!0,xs:12,md:3,children:[e.jsx(n,{fullWidth:!0,select:!0,label:"Components",name:"componentId",value:t.componentId,onChange:l,size:"small",children:r.map(s=>e.jsx(j,{value:s.componentId,children:s.componentName},s.componentId))})," "]}),e.jsx(a,{item:!0,xs:12,md:12,children:e.jsx(ie,{color:"#cc8587",sx:{height:2,width:"100%"}})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{fullWidth:!0,select:!0,label:"Select Fabric",defaultValue:"",size:"small",name:"fabricId",value:t.fabricId,onChange:l,children:C.map(s=>e.jsx(j,{value:s.fabricId,children:s.fabric},s.fabricId))})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{fullWidth:!0,select:!0,label:"Vendors",defaultValue:"",size:"small",name:"vendorId",value:t.vendorId,onChange:l,children:L.map(s=>e.jsx(j,{value:s.lookUpId,children:s.lookUpName},s.lookUpId))})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{label:"Po Pcs",fullWidth:!0,size:"small",name:"poPcs",value:t.poPcs,onChange:l})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{fullWidth:!0,select:!0,label:"Color",size:"small",name:"colorId",value:t.colorId,onChange:l,children:K.map(s=>e.jsx(j,{value:s.colorId,children:s.color},s.colorId))})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{label:"Available Quantity",fullWidth:!0,size:"small",name:"availableQty",value:t.availableQty,onChange:l})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{label:"Repeats",fullWidth:!0,size:"small",name:"repeats",value:t.repeats,onChange:l})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{fullWidth:!0,select:!0,label:"Heads",defaultValue:"",size:"small",name:"noOfHeads",value:t.noOfHeads,onChange:l,children:D.map(s=>e.jsx(j,{value:s.lookUpId,children:s.lookUpName},s.lookUpId))})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{label:"Cutting Size",fullWidth:!0,size:"small",name:"cuttingSize",value:t.cuttingSize,onChange:l})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{label:"itemsPerRepeat",fullWidth:!0,size:"small",name:"itemsPerRepeat",value:t.itemsPerRepeat,onChange:l})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{label:"total Pcs.",fullWidth:!0,size:"small",name:"totalPcs",value:t.totalPcs,onChange:l})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{label:"Total Amount",fullWidth:!0,size:"small",name:"totalAmount",value:t.totalAmount,onChange:l})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{label:"Cost Per Component",fullWidth:!0,size:"small",name:"costPerComponent",value:t.costPerComponent,onChange:l})}),e.jsx(a,{item:!0,xs:12,md:12,children:e.jsx(be,{control:e.jsx(ye,{checked:t.isSolving,onChange:m,name:"isSolving"}),label:"isSolving"})}),e.jsx(a,{item:!0,xs:12,md:6,children:e.jsxs(a,{container:!0,spacing:1,width:"Inherit",children:[e.jsx(a,{item:!0,xs:12,md:12,children:e.jsx(G,{variant:"h5",gutterBottom:!0,children:"Thread"})})," ",e.jsx(a,{item:!0,xs:12,md:4,children:e.jsx(n,{label:"Stitches",fullWidth:!0,size:"small",name:"threadStitches",value:t.threadStitches,onChange:l})}),e.jsx(a,{item:!0,xs:12,md:4,children:e.jsx(n,{label:"Rate",fullWidth:!0,size:"small",name:"threadRate",value:t.threadRate,onChange:l})}),e.jsx(a,{item:!0,xs:12,md:4,children:e.jsx(n,{label:"Amount",fullWidth:!0,size:"small",name:"threadAmount",value:t.threadAmount,onChange:l})})]})}),e.jsx(a,{item:!0,xs:12,md:6,children:e.jsxs(a,{container:!0,spacing:1,width:"Inherit",children:[e.jsx(a,{item:!0,xs:12,md:12,children:e.jsx(G,{variant:"h5",gutterBottom:!0,children:"Tilla"})})," ",e.jsx(a,{item:!0,xs:12,md:4,children:e.jsx(n,{label:"Stitches",fullWidth:!0,size:"small",name:"tillaStitches",value:t.tillaStitches,onChange:l})}),e.jsx(a,{item:!0,xs:12,md:4,children:e.jsx(n,{label:"Rate",fullWidth:!0,size:"small",name:"tillaRate",value:t.tillaRate,onChange:l})}),e.jsx(a,{item:!0,xs:12,md:4,children:e.jsx(n,{label:"Amount",fullWidth:!0,size:"small",name:"tillaAmount",value:t.tillaAmount,onChange:l})})]})}),e.jsx(a,{item:!0,xs:12,md:6,children:e.jsxs(a,{container:!0,spacing:1,width:"Inherit",children:[e.jsx(a,{item:!0,xs:12,md:12,children:e.jsx(G,{variant:"h5",gutterBottom:!0,children:"Sequence"})})," ",e.jsx(a,{item:!0,xs:12,md:4,children:e.jsx(n,{label:"Stitches",fullWidth:!0,size:"small",name:"sequenceStitches",value:t.sequenceStitches,onChange:l})}),e.jsx(a,{item:!0,xs:12,md:4,children:e.jsx(n,{label:"Rate",fullWidth:!0,size:"small",name:"sequenceRate",value:t.sequenceRate,onChange:l})}),e.jsx(a,{item:!0,xs:12,md:4,children:e.jsx(n,{label:"Amount",fullWidth:!0,size:"small",name:"sequenceAmount",value:t.sequenceAmount,onChange:l})})]})}),t.isSolving?e.jsx(a,{item:!0,xs:12,md:6,children:e.jsxs(a,{container:!0,spacing:1,width:"Inherit",children:[e.jsx(a,{item:!0,xs:12,md:12,children:e.jsx(G,{variant:"h5",gutterBottom:!0,children:"Solving"})})," ",e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{label:"Layers",fullWidth:!0,size:"small",name:"solvingLayers",value:t.solvingLayers,onChange:l})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{label:"Meters",fullWidth:!0,size:"small",name:"solvingInMeters",value:t.solvingInMeters,onChange:l})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{label:"Rate",fullWidth:!0,size:"small",name:"solvingRate",value:t.solvingRate,onChange:l})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{label:"Amount",fullWidth:!0,size:"small",name:"solvingAmount",value:t.solvingAmount,onChange:l})})]})}):null]})}),e.jsx(a,{container:!0,spacing:2,width:"Inherit",children:e.jsx(a,{sx:{marginTop:2},item:!0,xs:12,children:e.jsx(ce,{ncolumns:x,initialRows:te,formData:t,disableAddRecord:!0})})})]})},ze=ke,Oe=()=>{const{data:t}=se(),[d,k]=i.useState(""),{data:z,refetch:M}=ne(d,{skip:!d}),[P,A]=i.useState([]);i.useEffect(()=>{z&&(A(z.result),M())},[z]),console.log("designList",P),console.log("collectionData",t);const J=(t==null?void 0:t.result)||[],[O,X]=i.useState([]),[N,R]=i.useState([]),[U,q]=i.useState([]),[T,B]=i.useState([]),[E,w]=i.useState([]),[p,C]=i.useState([]),[V,L]=i.useState([]),[o,D]=i.useState({collectionId:"",baseColorId:"",baseColorName:"",noOfDesigns:"",noOfColors:"",planningHeaderId:"",designId:"",batchNo:"",componentId:"",cuttingSize:"",colorId:"",fabricId:"",noOfHeads:"",repeats:"",repeatSize:"",uomId:"",totalFabric:"",shrinkage:"",wastage:"",total:"",appId:1,createdOn:new Date().toISOString(),createdBy:0,lastUpdatedBy:0,lastUpdatedOn:new Date().toISOString()});i.useEffect(()=>{(async()=>{try{const u=(await $.get("https://gecxc.com:4041/API/Common/GetPrePlanningLookUp?appID=1")).data.result[0];X(u.componentList),q(u.colorList),R(u.fabricList),w(u.noOfHeadsList),B(u.uom)}catch(b){console.error("Error fetching pre-planning lookup data:",b)}})()},[]),i.useEffect(()=>{const r=async u=>{try{const m=await $.get(`https://gecxc.com:4041/api/PrePlanning/GetPrePlanningHeaderByDesignId?designId=${u}`);console.log(m.data),C(m.data.result)}catch(m){console.error("Error fetching pre-planning lookup data:",m)}},b=async u=>{try{const m=await $.get(`https://gecxc.com:4041/api/PrePlanning/GetPrePlanningByPlanningHeaderId?planningHeaderId=${u}`);console.log("GetPrePlanningByPlanningHeaderI",m.data.result),L(m.data.result.map((l,x)=>({...l,id:x})))}catch(m){console.error("Error fetching pre-planning lookup data:",m)}};o.designId&&r(o.designId),o.designId&&b(o.planningHeaderId)},[o.designId,o.planningHeaderId]),i.useEffect(()=>{const r=()=>{const u=parseFloat(o.repeats)||0,m=parseFloat(o.repeatSize)||0;return u*m};D(u=>({...u,totalFabric:r()}));const b=()=>{const u=parseFloat(o.totalFabric)||0,m=parseFloat(o.shrinkage)||0,l=parseFloat(o.wastage)||0;return u*(100+(m+l))/100};D(u=>({...u,total:b()}))},[o.repeats,o.repeatSize,o.totalFabric,o.shrinkage,o.wastage]);const v=r=>{const{name:b,value:u}=r.target;if(b==="collectionId"){const m=J.find(l=>l.collectionId===parseInt(u));k(u),D({...o,collectionId:u,noOfDesigns:m?m.noOfDesigns:"",noOfColors:m?m.noOfColors:""})}else if(b==="designId"){const m=P.find(l=>l.designId===parseInt(u));D({...o,designId:u,baseColorId:m?m.colorId:"",baseColorName:m?m.colorName:""})}else if(b==="batchNo"){const m=p.find(l=>l.batchNo===u);D({...o,batchNo:u,planningHeaderId:m?m.planningHeaderId:""})}else D({...o,[b]:u})},K=async()=>{try{const r=await $.post("https://gecxc.com:4041/api/PrePlanning/SavePrePlanning",{designId:parseInt(o.designId),planningHeaderId:parseInt(o.planningHeaderId),componentId:parseInt(o.componentId),colorId:parseInt(o.colorId),batchNo:o.batchNo,baseColorId:parseInt(o.baseColorId),cuttingSize:parseFloat(o.cuttingSize),fabricId:parseInt(o.fabricId),noOfHeads:parseInt(o.noOfHeads),repeats:parseFloat(o.repeats),repeatSize:parseFloat(o.repeatSize),uomId:parseInt(o.uomId),totalFabric:parseFloat(o.totalFabric),shrinkage:parseFloat(o.shrinkage),wastage:parseFloat(o.wastage),total:parseFloat(o.total),appId:o.appId,createdOn:o.createdOn,createdBy:o.createdBy,lastUpdatedBy:o.lastUpdatedBy,lastUpdatedOn:o.lastUpdatedOn});console.log("Data saved successfully:",r.data),D({collectionId:"",baseColorId:"",baseColorName:"",noOfDesigns:"",noOfColors:"",planningHeaderId:"",designId:"",batchNo:"",componentId:"",cuttingSize:"",colorId:"",fabricId:"",noOfHeads:"",repeats:"",repeatSize:"",uomId:"",totalFabric:"",shrinkage:"",wastage:"",total:"",appId:1,createdOn:new Date().toISOString(),createdBy:0,lastUpdatedBy:0,lastUpdatedOn:new Date().toISOString()}),L([])}catch(r){console.error("Error saving data:",r)}},ee=[{field:"componentId",headerName:"Component",editable:!0,flex:1,type:"singleSelect",valueOptions:O.map(r=>({value:r.lookUpId,label:r.lookUpName}))},{field:"colorId",headerName:"Color",editable:!0,flex:1,type:"singleSelect",valueOptions:U.map(r=>({value:r.lookUpId,label:r.lookUpName}))},{field:"cuttingSize",headerName:"Cutting Size",flex:1,editable:!0},{field:"fabricId",headerName:"Fabrication",editable:!0,flex:1,type:"singleSelect",valueOptions:N.map(r=>({value:r.lookUpId,label:r.lookUpName}))},{field:"noOfHeads",headerName:"No. Of Heads",editable:!0,flex:1,type:"singleSelect",valueOptions:E.map(r=>({value:r.lookUpId,label:r.lookUpName}))},{field:"repeats",headerName:"Repeats",flex:1,editable:!0},{field:"repeatSize",headerName:"Repeat Size",flex:1,editable:!0},{field:"totalFabric",headerName:"Total Fabric",flex:1,editable:!0,valueSetter:(r,b)=>{const u=b.repeats??0,m=b.repeatSize??0,l=u*m;return console.log("totalFabric",l),{...b,totalFabric:l}}},{field:"uomId",headerName:"UOM",editable:!0,flex:1,type:"singleSelect",valueOptions:T.map(r=>({value:r.lookUpId,label:r.lookUpName}))},{field:"shrinkage",headerName:"Shrinkage",flex:1,editable:!0},{field:"wastage",headerName:"Wastage",flex:1,editable:!0},{field:"total",headerName:"Total",flex:1,editable:!0,valueSetter:(r,b)=>{const u=b.shrinkage??0,m=b.wastage??0,l=b.totalFabric??0,x=l*(100-(u+m))/100;return console.log("totalFabric",l),{...b,total:x}}}];return console.log("batchList:",p),e.jsxs(oe,{style:{borderWidth:2,borderStyle:"dotted",borderColor:"#a11f23",width:"auto",maxHeight:{xs:"80vh",md:"auto"},overflow:"auto"},children:[e.jsx(re,{children:e.jsxs(a,{container:!0,spacing:2,width:"Inherit",children:[e.jsx(a,{item:!0,xs:9,md:9,children:e.jsx(G,{variant:"h3",gutterBottom:!0,children:"Pre Planning"})}),e.jsx(a,{item:!0,xs:3,textAlign:"right",children:e.jsx(W,{variant:"contained",size:"small",onClick:K,children:"Save"})}),e.jsxs(a,{item:!0,xs:12,md:4,children:[e.jsx(n,{fullWidth:!0,select:!0,label:"Select Collection",name:"collectionId",value:o.collectionId,onChange:v,size:"small",children:J.map(r=>e.jsx(j,{value:r.collectionId,children:r.collectionName},r.collectionId))})," "]}),e.jsx(a,{item:!0,xs:12,md:4,children:e.jsx(n,{label:"No of Design",fullWidth:!0,size:"small",name:"noOfDesigns",value:o.noOfDesigns,onChange:v,disabled:!0})}),e.jsx(a,{item:!0,xs:12,md:4,children:e.jsx(n,{label:"No of Color",fullWidth:!0,size:"small",name:"noOfColors",value:o.noOfColors,onChange:v,disabled:!0})}),e.jsx(a,{item:!0,xs:12,md:4,children:e.jsx(n,{fullWidth:!0,select:!0,label:"Select Design",name:"designId",value:o.designId,onChange:v,size:"small",children:P.map(r=>e.jsx(j,{value:r.designId,children:r.designNo},r.designId))})}),e.jsx(a,{item:!0,xs:12,md:4,children:e.jsx(n,{label:"Base Color",fullWidth:!0,size:"small",name:"baseColorName",value:o.baseColorName,onChange:v,disabled:!0})}),e.jsxs(a,{item:!0,xs:12,md:4,children:[e.jsx(n,{fullWidth:!0,select:!0,label:"Batch No.",name:"batchNo",value:o.batchNo,onChange:v,size:"small",children:p.map(r=>e.jsx(j,{value:r.batchNo,children:r.batchNo},r.batchNo))})," "]}),e.jsx(a,{item:!0,xs:12,md:12,children:e.jsx(ie,{color:"#cc8587",sx:{height:2,width:"100%"}})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{fullWidth:!0,select:!0,label:"Select Component",defaultValue:"",size:"small",name:"componentId",value:o.componentId,onChange:v,children:O.map(r=>e.jsx(j,{value:r.lookUpId,children:r.lookUpName},r.lookUpId))})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{label:"Color",fullWidth:!0,select:!0,size:"small",name:"colorId",value:o.colorId,onChange:v,children:U.map(r=>e.jsx(j,{value:r.lookUpId,children:r.lookUpName},r.lookUpId))})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{label:"Cutting Size",fullWidth:!0,size:"small",name:"cuttingSize",value:o.cuttingSize,onChange:v})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{fullWidth:!0,select:!0,label:"Fabrication",defaultValue:"",size:"small",name:"fabricId",value:o.fabricId,onChange:v,children:N.map(r=>e.jsx(j,{value:r.lookUpId,children:r.lookUpName},r.lookUpId))})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{fullWidth:!0,select:!0,label:"No of Heads",defaultValue:"",size:"small",name:"noOfHeads",value:o.noOfHeads,onChange:v,children:E.map(r=>e.jsx(j,{value:r.lookUpId,children:r.lookUpName},r.lookUpId))})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{label:"Repeats",fullWidth:!0,size:"small",name:"repeats",value:o.repeats,onChange:v})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{label:"Repeat Size",fullWidth:!0,size:"small",name:"repeatSize",value:o.repeatSize,onChange:v})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{label:"Total Fabric",fullWidth:!0,size:"small",name:"totalFabric",value:o.totalFabric,onChange:v})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{fullWidth:!0,select:!0,label:"UOM",defaultValue:"",size:"small",name:"uomId",value:o.uomId,onChange:v,children:T.map(r=>e.jsx(j,{value:r.lookUpId,children:r.lookUpName},r.lookUpId))})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{label:"Shrinkage %",fullWidth:!0,size:"small",name:"shrinkage",value:o.shrinkage,onChange:v})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{label:"Wastage %",fullWidth:!0,size:"small",name:"wastage",value:o.wastage,onChange:v})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{label:"Total",fullWidth:!0,size:"small",name:"total",value:o.total,onChange:v})})]})}),e.jsx(a,{container:!0,spacing:2,width:"Inherit",children:e.jsx(a,{sx:{marginTop:2},item:!0,xs:12,children:e.jsx(ce,{ncolumns:ee,initialRows:V,formData:o,editAPi:"https://gecxc.com:4041/api/PrePlanning/SavePrePlanning",deleteApi:"https://gecxc.com:4041/api/PrePlanning/DeletePreplanningByPlanningId?PlanningId=",deleteBy:"planningId",disableAddRecord:!0})})})]})},Ue=Oe,De=()=>{const[t,d]=i.useState({DPId:"",designId:"",batchNo:"",fabricId:"",ColorId:"",color:"",vendorId:"",processType:"",AvailableQty:"",Shrinkage:"",Wastage:"",OutputQty:"",UOM:"",RatePerUOM:"",UnitRatePerPo:"",TotalExclGst:"",GST:"0",GSTAmount:"",TotalIncludingGst:"",createdBy:0,poPcs:""});console.log("Dyeing form data to send",t);const{data:k}=se(),[z,M]=i.useState(""),{data:P}=ue(),{data:A,refetch:J}=ne(z,{skip:!z}),{data:O,refetch:X}=me(t.designId,{skip:!t.designId}),{data:N}=Ie(t.batchNo,{skip:!t.batchNo}),{data:R,refetch:U}=he(t.batchNo,{skip:!t.batchNo}),[q,T]=i.useState([]),[B,E]=i.useState([]),[w,p]=i.useState([]),[C,V]=i.useState([]),[L,o]=i.useState([]),[D,v]=i.useState([]),[K,ee]=i.useState([]);i.useEffect(()=>{A&&T(A.result)},[A]),i.useEffect(()=>{O&&E(O.result)},[O]),i.useEffect(()=>{N&&p(N.result)},[N]),i.useEffect(()=>{P&&ee(P.result[0].vendorList)},[N]),console.log(K),i.useEffect(()=>{R&&o(R.result.map((l,x)=>({id:x,...l})))},[R]),i.useEffect(()=>{if(P){const l=P.result[0];V(l.uomList)}},[P]);const te=(k==null?void 0:k.result)||[],y=l=>{const{name:x,value:I}=l.target;if(x==="collectionId"){const s=te.find(c=>c.collectionId===parseInt(I));M(I),d({...t,collectionId:I,poPcs:s?s.poPcs:""})}else if(x==="designId"){const s=q.find(c=>c.designId===parseInt(I));d({...t,designId:I,baseColorId:s?s.colorId:"",baseColorName:s?s.colorName:""})}else if(x==="batchNo"){const s=B.find(c=>c.batchNo===I);d({...t,batchNo:I,planningHeaderId:s?s.planningHeaderId:""})}else if(x==="fabricId"){const s=w.find(c=>c.fabricId===I);console.log("Selected Fabric:",w),d({...t,fabricId:I,OutputQty:s?s.total:""}),r(I)}else d(x==="processType"?{...t,processType:I}:x==="vendorId"?{...t,vendorId:I}:{...t,[x]:I})},r=async l=>{try{const I=(await $.get(`https://gecxc.com:4041/api/DyeingPrinting/GetFabricColorFromPrePlanningByFabricId?fabricId=${l}`)).data.result;if(console.log("Dyeing Color Data",I),I.length>0){const c=I[0];d(g=>({...g,Shrinkage:c.shrinkage.toFixed(2),Wastage:c.wastage.toFixed(2),UOM:c.uom,AvailableQty:c.total.toString()}))}const s=I.map(c=>({label:c.color,value:c.colorId}));if(v(s),s.length>0){const c=s[0];d(g=>({...g,ColorId:c.value,color:c.label}))}}catch(x){console.error("Error fetching fabric color data:",x)}};i.useEffect(()=>{const l=()=>{const H=parseFloat(t.AvailableQty)||0,Y=parseFloat(t.Shrinkage)||0,h=parseFloat(t.Wastage)||0;return H*(100-(Y+h))/100},x=()=>{const H=parseFloat(t.AvailableQty)||0,Y=parseFloat(t.RatePerUOM)||0;return H*Y},I=(H,Y)=>H*(1+Y/100),s=l(),c=x(),g=parseFloat(t.GST)||0,f=I(c,g),S=parseFloat(t.poPcs)||0,le=S?f/S:0;d(H=>({...H,OutputQty:s,TotalExclGst:c.toFixed(2),TotalIncludingGst:f.toFixed(2),UnitRatePerPo:le.toFixed(2)}))},[t.AvailableQty,t.Shrinkage,t.Wastage,t.RatePerUOM,t.GST,t.poPcs]);const b=async()=>{console.log("Form Data:",t);const l={dpId:parseInt(t.DPId)||0,designId:parseInt(t.designId),batchNo:t.batchNo,fabricId:parseInt(t.fabricId),colorId:parseInt(t.ColorId)||0,vendorId:t.vendorId||0,processType:t.processType,availableQty:parseFloat(t.AvailableQty)||0,shrinkage:parseFloat(t.Shrinkage)||0,wastage:parseFloat(t.Wastage)||0,outputQty:parseFloat(t.OutputQty)||0,uomId:parseInt(t.UOM)||0,ratePerUOM:parseFloat(t.RatePerUOM)||0,unitRatePerPo:parseFloat(t.UnitRatePerPo)||0,totalExclGst:parseFloat(t.TotalExclGst)||0,gst:parseFloat(t.GST)||0,gstAmount:parseFloat(t.GSTAmount)||0,totalIncludingGst:parseFloat(t.TotalIncludingGst)||0,createdBy:t.createdBy};console.log("Payload:",l);try{const x=await $.post("https://gecxc.com:4041/api/DyeingPrinting/SaveDyeingPrinting",l);x.status===200?(console.log("Data saved successfully:",x.data),d({DPId:"",designId:"",batchNo:"",fabricId:"",ColorId:"",color:"",vendorId:"",processType:"",AvailableQty:"",Shrinkage:"",Wastage:"",OutputQty:"",UOM:"",RatePerUOM:"",UnitRatePerPo:"",TotalExclGst:"",GST:"0",GSTAmount:"",TotalIncludingGst:"",createdBy:0,poPcs:""})):console.error("Failed to save data:",x.data)}catch(x){console.error("Error saving data:",x)}},u=[{field:"name",headerName:"Order Number",editable:!0,flex:2},{field:"DesignId",headerName:"Design",type:"number",flex:1,align:"left",headerAlign:"left",editable:!0},{field:"FabricId",headerName:"Fabric",type:"date",flex:1,editable:!0},{field:"ProcessType",headerName:"Process",flex:1,editable:!0},{field:"ColorId",headerName:"Color",flex:1,editable:!0},{field:"role",headerName:"Po Pcs",flex:1,editable:!0},{field:"AvailableQty",headerName:"Qty",flex:1,editable:!0},{field:"UOM",headerName:"UOM",flex:1,editable:!0},{field:"RatePerUOM",headerName:"Rate",flex:1,editable:!0},{field:"UnitRatePerPo",headerName:"Unit Price",flex:1,editable:!0},{field:"TotalIncludingGst",headerName:"Total W/ GST",flex:1,editable:!0}],m=[{value:"D",label:"Dyeing"},{value:"P",label:"Printing"}];return e.jsx(oe,{style:{borderWidth:1,borderStyle:"dotted",borderColor:"#a11f23",width:"auto",maxHeight:{xs:"80vh",md:"auto"},overflow:"auto"},children:e.jsx(re,{children:e.jsxs(a,{container:!0,spacing:2,width:"Inherit",children:[e.jsx(a,{item:!0,xs:9,md:9,children:e.jsx(G,{variant:"h3",gutterBottom:!0,children:"Dyeing/Printing"})}),e.jsx(a,{item:!0,xs:3,md:3,textAlign:"right",children:e.jsx(W,{variant:"contained",color:"primary",size:"small",onClick:b,children:"Save"})}),e.jsxs(a,{item:!0,xs:12,md:3,children:[e.jsx(n,{fullWidth:!0,select:!0,label:"Select Collection",name:"collectionId",value:z,onChange:y,size:"small",children:te.map(l=>e.jsx(j,{value:l.collectionId,children:l.collectionName},l.collectionId))})," "]}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{fullWidth:!0,select:!0,label:"Select Design",name:"designId",value:t.designId,onChange:y,size:"small",children:q.map(l=>e.jsx(j,{value:l.designId,children:l.designNo},l.designId))})}),e.jsxs(a,{item:!0,xs:12,md:3,children:[e.jsx(n,{fullWidth:!0,select:!0,label:"Batch No.",name:"batchNo",value:t.batchNo,onChange:y,size:"small",children:B.map(l=>e.jsx(j,{value:l.batchNo,children:l.batchNo},l.batchNo))})," "]}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{fullWidth:!0,select:!0,label:"Select Fabric",defaultValue:"",size:"small",name:"fabricId",value:t.fabricId,onChange:y,children:w.map(l=>e.jsx(j,{value:l.fabricId,children:l.fabric},l.fabricId))})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(Fe,{fullWidth:!0,options:D,getOptionLabel:l=>l.label||"",renderInput:l=>e.jsx(n,{...l,label:"Color",name:"ColorId",size:"small"}),value:D.find(l=>l.value===t.ColorId)||null,onChange:(l,x)=>{d(I=>({...I,ColorId:x?x.value:""}))}})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{fullWidth:!0,select:!0,label:"Vendor Name",size:"small",name:"vendorId",value:t.vendorId,onChange:y,children:K.map(l=>e.jsx(j,{value:l.lookUpId,children:l.lookUpName},l.lookUpId))})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{fullWidth:!0,size:"small",name:"baseColorName",value:t.baseColorName,onChange:y,disabled:!0,focused:!0})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{fullWidth:!0,select:!0,label:"Process Type",size:"small",name:"processType",value:t.processType,onChange:y,children:m.map(l=>e.jsx(j,{value:l.value,children:l.label},l.value))})}),e.jsx(a,{item:!0,xs:12,md:3,children:e.jsx(n,{label:"Po Pcs",fullWidth:!0,size:"small",name:"poPcs",value:t.poPcs,onChange:y})}),e.jsx(a,{item:!0,xs:12,md:1.5,children:e.jsx(n,{label:"UOM",fullWidth:!0,size:"small",name:"UOM",value:t.UOM})}),e.jsx(a,{item:!0,xs:12,md:1.5,children:e.jsx(n,{label:"AvailableQty",fullWidth:!0,size:"small",name:"AvailableQty",value:t.AvailableQty})}),e.jsx(a,{item:!0,xs:12,md:1.5,children:e.jsx(n,{label:"Shrinkage%",fullWidth:!0,size:"small",name:"Shrinkage",value:t.Shrinkage})}),e.jsx(a,{item:!0,xs:12,md:1.5,children:e.jsx(n,{label:"Wastage%",fullWidth:!0,size:"small",name:"Wastage",value:t.Wastage})}),e.jsx(a,{item:!0,xs:12,md:1.5,children:e.jsx(n,{label:"Output Qty",fullWidth:!0,size:"small",name:"OutputQty",value:t.OutputQty})}),e.jsx(a,{item:!0,xs:12,md:1.5,children:e.jsx(n,{label:"Rate",fullWidth:!0,size:"small",name:"RatePerUOM",value:t.RatePerUOM,onChange:y})}),e.jsx(a,{item:!0,xs:12,md:1.5,children:e.jsx(n,{label:"Total Excluding GST",fullWidth:!0,size:"small",name:"TotalExclGst",value:t.TotalExclGst,onChange:y})}),e.jsxs(a,{item:!0,xs:12,md:1.5,children:[e.jsx(n,{label:"GST",fullWidth:!0,size:"small",name:"GST",value:t.GST,onChange:y})," "]}),e.jsx(a,{item:!0,xs:12,md:1.5,children:e.jsx(n,{label:"Total:Including Gst",fullWidth:!0,size:"small",name:"TotalExclGst",value:t.TotalIncludingGst,onChange:y})}),e.jsx(a,{item:!0,xs:12,md:1.5,children:e.jsx(n,{label:"Unit P: T/Po PC's",fullWidth:!0,size:"small",name:"UnitRatePerPo",value:t.UnitRatePerPo,onChange:y})}),e.jsx(ie,{color:"#cc8587",sx:{height:2,width:"100%",mt:2}}),e.jsx(a,{item:!0,xs:12,md:12,paddingTop:1,children:e.jsx(ce,{initialRows:L,ncolumns:u})})]})})})},We=De,ae=["Pre Planning","Fabrication","Dyeing/Printing  ","Embroidery ","Schiffli","name6","name7","name8"];function Le(){const[t,d]=i.useState(0),[k,z]=i.useState(new Set),[M,P]=i.useState(null),[A,J]=i.useState([]),O=p=>{P(p.currentTarget)},X=()=>{P(null)},N=!!M,R=N?"simple-popover":void 0,U=p=>p===1,q=p=>k.has(p),T=()=>{let p=k;q(t)&&(p=new Set(p.values()),p.delete(t)),d(C=>C+1),z(p)},B=()=>{d(p=>p-1)},E=()=>{if(!U(t))throw new Error("You can't skip a step that isn't optional.");d(p=>p+1),z(p=>{const C=new Set(p.values());return C.add(t),C})},w=()=>{d(0)};return i.useEffect(()=>{(async()=>{try{const C=await $.get("https://gecxc.com:4041/api/Common/GetLookUpDomains?appId=1");console.log("LookupData",C),J(C.data.result)}catch(C){console.error("Error fetching design options:",C)}console.log("LookupData",response)})()},[]),e.jsxs(_,{sx:{width:"100%"},children:[e.jsxs(a,{container:!0,spacing:1,width:"Inherit",children:[e.jsx(a,{item:!0,sm:6,children:e.jsx(G,{variant:"h2",gutterBottom:!0,children:"Planning Process"})}),e.jsxs(a,{item:!0,sm:6,textAlign:"right",children:[e.jsx(W,{"aria-describedby":R,variant:"outlined",size:"small",onClick:O,children:"+Lookup"}),e.jsx(Ne,{id:"mouse-over-popover",open:N,anchorEl:M,onClose:X,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},sx:{".MuiPopover-paper":{width:"300px",padding:"16px"}},children:e.jsxs(a,{container:!0,spacing:3,width:"Inherit",children:[e.jsx(a,{item:!0,sm:12,children:e.jsx(n,{fullWidth:!0,id:"outlined-select-currency",select:!0,label:"Select Design",size:"small",children:A.map(p=>e.jsx(j,{value:p.lookUpDomain,children:p.lookUpDomain},p.lookUpDomain))})}),e.jsx(a,{item:!0,sm:12,children:e.jsx(n,{fullWidth:!0,label:"Add Lookup Description",size:"small"})}),e.jsx(a,{item:!0,sm:3,textAlign:"right",children:e.jsx(W,{variant:"contained",size:"small",children:"Save"})})]})})]})]}),e.jsx(je,{activeStep:t,children:ae.map((p,C)=>{const V={},L={};return U(C)&&(L.optional=e.jsx(G,{variant:"caption",children:"Optional"})),q(C)&&(V.completed=!1),e.jsx(ve,{...V,children:e.jsx(Se,{...L,children:p})},p)})}),e.jsxs(_,{sx:{display:"flex",flexDirection:"row",pt:2},children:[e.jsx(W,{color:"inherit",disabled:t===0,onClick:B,sx:{mr:1},children:"Back"}),e.jsx(_,{sx:{flex:"1 1 auto"}}),U(t)&&e.jsx(W,{color:"inherit",onClick:E,sx:{mr:1},children:"Skip"}),e.jsx(W,{onClick:T,children:t===ae.length-1?"Finish":"Next"})]}),t===ae.length?e.jsxs(i.Fragment,{children:[e.jsx(G,{sx:{mt:2,mb:1},children:"All steps completed - you're finished"}),e.jsxs(_,{sx:{display:"flex",flexDirection:"row",pt:2},children:[e.jsx(_,{sx:{flex:"1 1 auto"}}),e.jsx(W,{onClick:w,children:"Reset"})]})]}):e.jsxs(i.Fragment,{children:[e.jsxs(G,{sx:{mt:2,mb:1},children:["Step ",t+1]}),t===0&&e.jsx(Ue,{}),t===1&&e.jsx(Ce,{}),t===2&&e.jsx(We,{}),t===3&&e.jsx(ze,{}),e.jsxs(_,{sx:{display:"flex",flexDirection:"row",pt:2},children:[e.jsx(W,{color:"inherit",disabled:t===0,onClick:B,sx:{mr:1},children:"Back"}),e.jsx(_,{sx:{flex:"1 1 auto"}}),U(t)&&e.jsx(W,{color:"inherit",onClick:E,sx:{mr:1},children:"Skip"}),e.jsx(W,{onClick:T,children:t===ae.length-1?"Finish":"Next"})]})]})]})}export{Le as default};
